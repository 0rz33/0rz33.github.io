<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="4ckU">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="0rz33"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="0rz33"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>page - 0rz33</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Searching-->
<div class="search-bg">
    <div class="search-container">
            <div class="alpha-search">
                <form class="site-search-form">
                    <input type="text" id="local-search-input" class="st-search-input" />
                </form>
                <div id="local-search-result">
                </div>
            </div>
        </div>
    </div>
</div> 

<!--Hamburger Icon-->
<search>
    <a href="#search"></a>
</search>
<nav>
    <a href="#menu"></a>
</nav>

<!-- 执行本地搜索脚本 -->
<script>
    var inputArea = document.querySelector("#local-search-input");
    var getSearchFile = function(){
        var path = "/search.xml";
        searchFunc(path, 'local-search-input', 'local-search-result');
    }
    inputArea.onfocus = function(){ getSearchFile() }
    inputArea.onkeydown = function(){ if(event.keyCode==13) return false}
</script>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">0rz33</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/linux/">
                Linux命令
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/Linux/">Linux</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#1">系统管理及ICP资源管理 (uname hostnamectl getconf uname sar arch date ipcs ulimit)</a></li>
<li><a href="#2">文件及目录管理 (cat less tail find grep sed awk rmdir ln which locate tail dmesg journalctl rsync)</a></li>
<li><a href="#3">管道 |</a></li>
<li><a href="#4">远程拷贝 (scp tar zip unzip gzip gunzip bzip bunzip)</a></li>
<li><a href="#5">磁盘管理 (df du fdisk mount)</a></li>
<li><a href="#6">进程管理 (ps top pgrep kill lsof pmap bg ctrl+z ctrl+c &amp; jobs nohup)</a></li>
<li><a href="#7">性能监控 (top sar free watch)</a></li>
<li><a href="#8">网络工具 (netstat lsof route ping host wget sftp scp traceroute ss arp)</a></li>
<li><a href="#9">用户管理 (useradd passwd userdel usermod chmod chown .bashrc .bash_profile)</a></li>
<li><a href="#10">防火墙 ()</a></li>
</ul>
<p>time计时</p>
<h2 id="Linux-常用基本命令"><a href="#Linux-常用基本命令" class="headerlink" title="Linux 常用基本命令"></a>Linux 常用基本命令</h2><h3 id="Linux目录"><a href="#Linux目录" class="headerlink" title="Linux目录"></a>Linux目录</h3><table>
<thead>
<tr>
<th>目录路径</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;bin</td>
<td>二进制可执行文件的目录所在 例如 openssl就是在这个文件下</td>
</tr>
<tr>
<td>｜ &#x2F;etc ｜ 系统管理和配置文件 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;etc&#x2F;rc.d ｜ 启动的配置文件和脚本 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;home ｜ 用户的主目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;lib ｜ 标准设计程序，是动态链接共享库 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;sbin ｜ 超级管理员命令 这里存放的是系统管理员使用的管理程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;tmp ｜ 公共存放的临时文件目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;root ｜ 系统管理员的主目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;mnt ｜ 系统提供这个目录是让用户临时挂载的文件系统 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;lost+found ｜ 这个目录平时是空，系统非正常关键而留下 没有保存的文件就在这里 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;proc ｜ 虚拟的目录，是系统内存的映射，可以直接访问这个目录来获取系统信息 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;var ｜ 某些大文件的溢出区，比方说各种服务器的日志文件 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;var&#x2F;log ｜系统⽇志⽂件。 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr ｜ 最庞大的目录，要用到的应用程序和文件几乎都在这个目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr&#x2F;bin ｜ 众多的应用程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr&#x2F;sbin ｜ 超级用户的一些管理程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;opt ｜ 软件包目录，⽤户安装的可选应⽤软件⼀般放在此处，不会影响系统默认的软件结构 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;sys ｜ 虚拟⽂件系统⽬录，⽤于存放系统硬件信息，提供系统与硬件设备之间的接⼝ ｜</td>
<td></td>
</tr>
</tbody></table>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="1">系统管理及ICP资源管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 Linux内核 版本命令</span></span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Linux系统 版本的命令</span></span><br><span class="line">lsb_release -a  <span class="comment"># RedHat、SUSE、Debian…等发行版</span></span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release <span class="comment"># 只适合Redhat系的Linux</span></span><br><span class="line"><span class="built_in">cat</span> /etc/issue <span class="comment"># 此命令也适用于所有的Linux发行版</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hostnamectl</span><br><span class="line">hostnamectl | grep -i kernel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 扩展</span></span><br><span class="line"><span class="comment"># 查看 CUP信息  包括型号 主频 内核等等</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CPU的核的个数:</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo | grep processor | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/meminfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CUP架构</span></span><br><span class="line">getconf LONG_BIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示架构</span></span><br><span class="line"><span class="built_in">arch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### ICP资源管理 ###</span></span><br><span class="line"><span class="comment">#查看系统使用的IPC资源</span></span><br><span class="line">ipcs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC共享内存资源</span></span><br><span class="line">ipcs -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC队列资源</span></span><br><span class="line">ipcs -q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC信号量资源</span></span><br><span class="line">ipcs -s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用示例：查看IPC资源被谁占用</span></span><br><span class="line"><span class="comment"># 有个IPCKEY：51036 ，需要查询其是否被占用；</span></span><br><span class="line"><span class="comment"># 首先通过计算器将其转为十六进制:</span></span><br><span class="line"><span class="comment">#     51036 -&gt; c75c</span></span><br><span class="line"><span class="comment"># 如果知道是被共享内存占用</span></span><br><span class="line">ipcs -m | grep c75c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不确定，则直接查找</span></span><br><span class="line">ipcs | grep c75c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前所有的系统资源limit 信息</span></span><br><span class="line"><span class="built_in">ulimit</span> – a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对生成的 core 文件的大小不进行限制</span></span><br><span class="line"><span class="built_in">ulimit</span> – c unlimited</span><br></pre></td></tr></table></figure>

<h4 id="2">文件及目录管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### 查看小文件 ###</span></span><br><span class="line"><span class="comment"># 小文档查看</span></span><br><span class="line"><span class="built_in">cat</span> [文件]</span><br><span class="line"><span class="comment"># 浏览文件</span></span><br><span class="line">less [文件]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 查看大文件 ###</span></span><br><span class="line"><span class="built_in">tail</span></span><br><span class="line"><span class="built_in">tail</span> -f [文件]</span><br><span class="line"><span class="comment"># 显示最后20行信息</span></span><br><span class="line"><span class="built_in">tail</span> -n 20 [文件]</span><br><span class="line"><span class="built_in">tail</span> -n -20 [文件]</span><br><span class="line"><span class="comment"># 显示从20行到末尾</span></span><br><span class="line"><span class="built_in">tail</span> -n +20 [文件]</span><br><span class="line"></span><br><span class="line"><span class="comment">### find 文件名查找 ###</span></span><br><span class="line"><span class="comment"># find [搜索路径] -name [文件名关键词]</span></span><br><span class="line">find / -name <span class="string">&quot;passw&quot;</span></span><br><span class="line">find / -name <span class="string">&quot;fi*&quot;</span> <span class="comment">## 区分大小写</span></span><br><span class="line">find / -iname <span class="string">&quot;fi*&quot;</span> <span class="comment">## 不区分大小写</span></span><br><span class="line"><span class="comment"># 支持通配符 `*`、`?`和`[]`</span></span><br><span class="line"><span class="string">&quot;*.log&quot;</span>,<span class="string">&quot;file?.txt&quot;</span>,<span class="string">&quot;file[0-9].txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找txt和pdf文件</span></span><br><span class="line">find . \( -name <span class="string">&quot;*.txt&quot;</span> -o -name <span class="string">&quot;*.pdf&quot;</span> \) -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则方式查找.txt和pdf</span></span><br><span class="line">find . -regex  <span class="string">&quot;.*\(\.txt|\.pdf\)$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询7天前被访问过的所有文件</span></span><br><span class="line">find . -atime +7 <span class="built_in">type</span> f -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按权限查找</span></span><br><span class="line">find . -<span class="built_in">type</span> f -perm 644 -<span class="built_in">print</span> //找具有可执行权限的所有文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按用户查找</span></span><br><span class="line">find . -<span class="built_in">type</span> f -user weber -<span class="built_in">print</span>// 找用户weber所拥有的文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按大小搜索</span></span><br><span class="line">find . -size xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">### grep 文件内容查找 ###</span></span><br><span class="line"><span class="comment"># grep -参数 查找范围</span></span><br><span class="line"><span class="comment"># 参数</span></span><br><span class="line"><span class="comment"># -n 显示所有结果显示行号 number</span></span><br><span class="line"><span class="comment"># -R 递归查找目录下的所有文件</span></span><br><span class="line"></span><br><span class="line">grep aries /etc</span><br><span class="line">grep aries /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep输出以0作为结尾符的文件名（-z）</span></span><br><span class="line">grep <span class="string">&quot;test&quot;</span> file* -lZ| xargs -0 <span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 综合应用：将日志中的所有带where条件的sql查找查找出来</span></span><br><span class="line"><span class="built_in">cat</span> LOG.* | <span class="built_in">tr</span> a-z A-Z | grep <span class="string">&quot;FROM &quot;</span> | grep <span class="string">&quot;WHERE&quot;</span> &gt; b</span><br><span class="line"></span><br><span class="line"><span class="comment">### sed 文本替换利器 ###</span></span><br><span class="line"><span class="comment"># 首处替换</span></span><br><span class="line">sed <span class="string">&#x27;s/text/replace_text/&#x27;</span> file   //替换每一行的第一处匹配的text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局替换</span></span><br><span class="line">sed <span class="string">&#x27;s/text/replace_text/g&#x27;</span> file</span><br><span class="line"></span><br><span class="line"><span class="comment">### awk 数据流处理工具 ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### rmdir 删除空目录 ###</span></span><br><span class="line"><span class="built_in">rmdir</span> newfile</span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件链接 ###</span></span><br><span class="line"><span class="comment">##  软链接 ##</span></span><br><span class="line"><span class="built_in">ln</span> -s original.txt symlink.txt <span class="comment">## 创建指向 original.txt 的符号链接（软链接） symlink.txt</span></span><br><span class="line"><span class="comment">##  硬链接 ##</span></span><br><span class="line"><span class="built_in">ln</span> ~/offsec123.txt hardlink.txt <span class="comment">## 创建 offsec123.txt ⽂件的硬链接 hardlink.txt </span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件搜索 ###</span></span><br><span class="line"><span class="built_in">which</span> mysql</span><br><span class="line"></span><br><span class="line">locate XX.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">### 系统日志 ###</span></span><br><span class="line"><span class="comment">## 日志⽂件 ##</span></span><br><span class="line"><span class="built_in">tail</span> -3 /var/log/auth.log <span class="comment">## 查看 auth.log ⽂件中的最后三⾏记录。</span></span><br><span class="line"><span class="comment">## ⼆进制⽇志 ##</span></span><br><span class="line"><span class="built_in">who</span> /var/log/wtmp | <span class="built_in">tail</span> -5 <span class="comment">## 查看最近五个⽤户登录记录。</span></span><br><span class="line">dmesg <span class="comment">## 查看系统启动和内核⽇志。</span></span><br><span class="line"><span class="comment">## systemd⽇志 ##</span></span><br><span class="line">journalctl <span class="comment">## 查看 systemd 系统⽇志。</span></span><br></pre></td></tr></table></figure>

<h4 id="3">管道</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法 - 命令1的输出结果，作为命令2的输入</span></span><br><span class="line"></span><br><span class="line">命令1 | 命令2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line"><span class="comment"># 查找aries用户</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | grep -n <span class="string">&quot;baizhi&quot;</span></span><br><span class="line"><span class="comment"># 查找aires组</span></span><br><span class="line"><span class="built_in">cat</span> /etc/group | grep -n <span class="string">&quot;baizhi&quot;</span></span><br><span class="line"><span class="comment"># 查找sshd进程</span></span><br><span class="line">ps -aux | grep sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续使用管道意味着第一个命令的输出会作为 第二个命令的输入，第二个命令的输出又会作为第三个命令的输入，依此类推</span></span><br><span class="line"></span><br><span class="line">rpm –qa | grep licq</span><br><span class="line"><span class="comment"># 管道将rpm -qa命令的输出（包括系统中所有安装的RPM包）作为grep命令的输入，从而列出带有licq字符的RPM包来</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | grep /bin/bash | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment"># 这条命令使用了两个管道，利用第一个管道将cat命令（显示passwd文件的内容）的输出送给grep命令，grep命令找出含有“/bin /bash”的所有行；第二个管道将grep的输出送给wc命令，wc命令统计出输入中的行数。这个命令的功能在于找出系统中有多少个用户使用bash。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> -v record.log | grep AAA | grep -v BBB | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment"># 查找record.log中包含AAA，但不包含BBB的记录的总数:</span></span><br></pre></td></tr></table></figure>
<p>管道命令与重定向区别<br>区别是：</p>
<ul>
<li>左边的命令应该有标准输出 | 右边的命令应该接受标准输入<br>左边的命令应该有标准输出 &gt; 右边只能是文件<br>左边的命令应该需要标准输入 &lt; 右边只能是文件</li>
<li>管道触发两个子进程执行”|”两边的程序；而重定向是在一个进程内执行<br>这些都是网上总结很多的，其实只要多加清楚用法，也一定有自己的一份不同描述。</li>
</ul>
<h4 id="4">远程拷贝</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scp -r [local_folder] [remote_username]@[remote_ip]:[remote_folder]</span><br><span class="line">scp -r [local_folder] [remote_ip]:[remote_folder]</span><br><span class="line"><span class="comment"># 第1个指定了用户名，命令执行后需要输入用户密码； 第2个没有指定用户名，命令执行后需要输入用户名和密码；</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 - 远处文件-&gt;本地目录</span></span><br><span class="line">scp root@10.6.159.147:/opt/soft/demo.tar /opt/soft/</span><br><span class="line"><span class="comment"># 说明： 从10.6.159.147机器上的/opt/soft/的目录中下载demo.tar 文件到本地/opt/soft/目录中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 - 远处-&gt;本地</span></span><br><span class="line">scp -r root@10.6.159.147:/opt/soft/test /opt/soft/</span><br><span class="line"><span class="comment"># 说明： 从10.6.159.147机器上的/opt/soft/中下载test目录到本地的/opt/soft/目录来。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传 - 本地文件-&gt;远程机器指定目录</span></span><br><span class="line">scp /opt/soft/demo.tar root@10.6.159.147:/opt/soft/scptest</span><br><span class="line"><span class="comment"># 说明： 复制本地opt/soft/目录下的文件demo.tar 到远程机器10.6.159.147的opt/soft/scptest目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传 - 本地目录-&gt;远程机器指定目录</span></span><br><span class="line">scp -r /opt/soft/test root@10.6.159.147:/opt/soft/scptest</span><br><span class="line"><span class="comment"># 说明： 上传本地目录 /opt/soft/test到远程机器10.6.159.147上/opt/soft/scptest的目录中</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/linux%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">### tar打包 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># tar [选项] [打包tar] [源目录文件]</span></span><br><span class="line">tar -cvf config.xml.tar config.xml </span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">### tar解压 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># tar [选项] [压缩包] [目录文件] / 不加C 就当前目录</span></span><br><span class="line">tar -xvf config.xml.tar -C /tmp </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### .tar.bz2 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># -z：压缩和解压缩 &quot;.tar.gz&quot; 格式；</span></span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 打包</span></span><br><span class="line">tar -zcvf tmp.tar.gz /tmp/ </span><br><span class="line"></span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 解压</span></span><br><span class="line">tar -zxvf tmp.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">###.tar.bz2 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># -j：压缩和解压缩 &quot;.tar.bz2&quot;格式。</span></span><br><span class="line"><span class="comment">## &quot;.tar.bz2&quot; 格式 - 打包</span></span><br><span class="line">tar -jcvf tmp.tar.bz2 /tmp/ </span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 解压</span></span><br><span class="line">tar -jxvf tmp.tar.bz2 </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### zip-压缩 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">## zip [选项] 压缩包名 源文件或源目录列表</span></span><br><span class="line">zip ana.zip anaconda-ks.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 多个文件 test.zip</span></span><br><span class="line">zip test.zip install.log install.log.syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 目录 需要使用“-r”选项</span></span><br><span class="line">zip -r dir1.zip dir1   </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### unzip-解压 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">## unzip [选项] 压缩包名</span></span><br><span class="line">unzip dir1.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压 - 把压缩包解压到指定位置</span></span><br><span class="line">unzip -d /tmp/ ana.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### gzip 压缩 ###</span></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment"># 只压缩 不打包成集合</span></span><br><span class="line"><span class="comment"># 默认压缩 不保留源文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## gzip [选项] 源文件</span></span><br><span class="line">gzip install.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 保留源文件压缩</span></span><br><span class="line"><span class="comment"># 使用-c选项，但是不让压缩数据输出到屏幕上，而是重定向到压缩文件中，这样可以缩文件的同时不删除源文件</span></span><br><span class="line">gzip -c anaconda-ks.cfg &gt;anaconda-ks.cfg.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">###################</span></span><br><span class="line"><span class="comment">### gunzip 解压 ###</span></span><br><span class="line"><span class="comment">##################</span></span><br><span class="line"><span class="comment">## gunzip [选项] 文件</span></span><br><span class="line">gunzip install.log.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 打包 - 要想解压缩&quot;.gz&quot;格式，还可以使用 &quot;gzip -d&quot;命令</span></span><br><span class="line">gzip -d anaconda-ks.cfg.gz</span><br><span class="line"><span class="comment">## 解压 - 缩目录下的内容，则需使用 &quot;-r&quot; 选项</span></span><br><span class="line">gunzip -r <span class="built_in">test</span>/</span><br><span class="line"><span class="comment">## 如果我们压缩的是一个纯文本文件，则可以直接使用 zcat 命令在不解压缩的情况下查看这个文本文件中的内容</span></span><br><span class="line">zcat anaconda-ks.cfg.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### bzip2压缩 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">## bzip2 [选项] 源文件</span></span><br><span class="line"><span class="comment">## 压缩 - 成&quot;.bz2&quot;格式，此压缩命令会在压缩的同时删除源文件。</span></span><br><span class="line">bzip2 anaconda-ks.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩 - 同时保留源文件</span></span><br><span class="line">bzip2 -k install.log.syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">## 打包</span></span><br><span class="line"><span class="comment">## bunzip2 [选项] 源文件</span></span><br><span class="line">bunzip2 anaconda-ks.cfg.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### bzip2解压 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># - &quot;.bz2&quot; 格式也可以使用 &quot;bzip2 -d 压缩包&quot; 命令来进行解压缩</span></span><br><span class="line">bzip2 -d install.log.syslog.bz2</span><br><span class="line"><span class="comment">## 和 &quot;.gz&quot; 格式一样，&quot;.bz2&quot; 格式压缩的纯文本文件也可以不解压缩直接查看，使用的命令是 bzcat</span></span><br><span class="line">bzcat install.log.syslog.bz2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5">磁盘管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">df</span> -h <span class="comment"># 查看磁盘空间</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -hT <span class="comment"># 显示⽂件系统的磁盘使⽤情况， -h ⼈性化显示， -T 显示⽂件系统类型。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> -sh <span class="comment"># 查看当前目录所占空间大小</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> ./* -hsc <span class="comment"># 递归查看⽬录中每个⽂件或⽂件夹的⼤⼩。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看磁盘分区 ##</span></span><br><span class="line">fdisk -l <span class="comment"># 列出所有分区信息。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载分区 ##</span></span><br><span class="line">mount /dev/sdb1 /mnt/usb <span class="comment"># 挂载设备 /dev/sdb1 到 /mnt/usb ⽬录。</span></span><br></pre></td></tr></table></figure>

<h4 id="6">进程管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看正在运行进程</span></span><br><span class="line">ps -ef</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态查看系统进程</span></span><br><span class="line">ps -aux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询归属于用户colin115的进程</span></span><br><span class="line">ps -ef | grep colin115</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询进程ID（适合只记得部分进程字段）</span></span><br><span class="line"><span class="comment"># pgrep [查找进程]</span></span><br><span class="line">pgrep  -l re <span class="comment">#查询进程名中含有re的进程</span></span><br><span class="line"></span><br><span class="line">ps -ajx <span class="comment"># 以完整的格式显示所有的进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看系统进程</span></span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭进程</span></span><br><span class="line"><span class="built_in">kill</span> [进程<span class="built_in">id</span>]</span><br><span class="line"><span class="comment"># 强制杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 [进程<span class="built_in">id</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看端口占用的进程状态</span></span><br><span class="line">lsof -i:3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询init进程当前打开的文件</span></span><br><span class="line">lsof -c init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询指定的进程ID(23295)打开的文件</span></span><br><span class="line">lsof -p 23295</span><br><span class="line"></span><br><span class="line"><span class="comment"># pmap，来输出进程内存的状况，可以用来分析线程堆栈</span></span><br><span class="line">pmap [PID]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户colin115下的所有进程名以av_开头的进程终止</span></span><br><span class="line">ps -u colin115 |  awk <span class="string">&#x27;/av_/ &#123;print &quot;kill -9 &quot; $1&#125;&#x27;</span> | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户colin115下所有进程名中包含HOST的进程终止</span></span><br><span class="line">ps -fe| grep colin115|grep HOST |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在命令末尾加上 &amp; 符号，就可以让程序在后台运行</span></span><br><span class="line">./test.sh &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果程序正在前台运行，可以使用 Ctrl+z 选项把程序暂停 然后用 bg %[number] 命令把这个程序放到后台运行，摁Ctrl+z，然后在最后一行加上bg %number</span></span><br><span class="line"><span class="built_in">bg</span> %1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将后台中的命令调至前台继续运行。如果后台中有多个命令，可以用fg %jobnumber（是命令编号，不是进程号）将选中的命令调出。</span></span><br><span class="line"><span class="built_in">fg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前有多少在后台运行的命令</span></span><br><span class="line"><span class="comment"># 对于所有运行的程序，我们可以用jobs –l 指令查看</span></span><br><span class="line"><span class="built_in">jobs</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果让程序始终在后台执行，即使关闭当前的终端也执行（之前的&amp;做不到），这时候需要nohup。该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。关闭中断后，在另一个终端jobs已经无法看到后台跑得程序了，此时利用ps（进程查看命令）</span></span><br><span class="line"><span class="built_in">nohup</span> ./test.sh &amp;</span><br></pre></td></tr></table></figure>

<h4 id="7">性能监控</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看CPU使用率</span></span><br><span class="line">sar -u</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CPU平均负载</span></span><br><span class="line">sar -q 1 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># sar指定-r之后，可查看内存使用状况</span></span><br><span class="line">sar -r 1 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存使用量</span></span><br><span class="line">free -m</span><br><span class="line"><span class="comment"># 显示内存和交换分区的使⽤情况</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看页面交换发生状况 页面发生交换时，服务器的吞吐量会大幅下降；服务器状况不良时，如果怀疑因为内存不足而导致了页面交换的发生，可以使用sar -W这个命令来确认是否发生了大量的交换</span></span><br><span class="line">sar -W 1 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux下有 vmstat、Unix系统有prstat</span></span><br><span class="line"><span class="comment"># 查看cpu、内存、使用情况： vmstat n m （n 为监控频率、m为监控次数）</span></span><br><span class="line">vmstat 1 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用watch 工具监控变化 当需要持续的监控应用的某个数据变化时，watch工具能满足要求； 执行watch命令后，会进入到一个界面，输出当前被监控的数据，一旦数据变化，便会高亮显示变化情况；</span></span><br><span class="line"><span class="comment"># 操作redis时，监控内存变化</span></span><br><span class="line">watch -d -n 1 <span class="string">&#x27;./redis-cli info | grep memory&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8">网络工具</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 查询网络服务和端口 ###</span></span><br><span class="line"><span class="comment"># 列出所有端口</span></span><br><span class="line">netstat -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有 tcp 端口</span></span><br><span class="line">netstat -at</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有有监听的服务状态</span></span><br><span class="line">netstat -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用netstat工具查询端口</span></span><br><span class="line">netstat -antp | grep 6379</span><br><span class="line"></span><br><span class="line">netstat -natup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是 netstat 的替代⼯具，性能更⾼。</span></span><br><span class="line">ss -natup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 ARP 缓存表中的⼆层地址信息。</span></span><br><span class="line">arp -en</span><br><span class="line"></span><br><span class="line"><span class="comment">### 网络路由 ###</span></span><br><span class="line"><span class="comment"># 查看路由状态</span></span><br><span class="line">route -n</span><br><span class="line"></span><br><span class="line"><span class="comment">### ping包到地址IP ###</span></span><br><span class="line">ping IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### 探测前往地址IP的路由路径 ###</span></span><br><span class="line">traceroute IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### DNS查询，寻找域名domain对应的IP ###</span></span><br><span class="line">host domain</span><br><span class="line"></span><br><span class="line"><span class="comment">### 反向DNS查询 ###</span></span><br><span class="line">host IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### ssh 222端口 ###</span></span><br><span class="line">ssh -p 222 ID@host</span><br><span class="line"></span><br><span class="line"><span class="comment">### ftp/sftp文件传输 ###</span></span><br><span class="line">sftp ID@host</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆服务器host，ID为用户名。sftp登陆后，可以使用下面的命令进一步操作：</span></span><br><span class="line">get filename <span class="comment"># 下载文件</span></span><br><span class="line">put filename <span class="comment"># 上传文件</span></span><br><span class="line"><span class="built_in">ls</span> <span class="comment"># 列出host上当前路径的所有文件</span></span><br><span class="line"><span class="built_in">cd</span> <span class="comment"># 在host上更改当前路径</span></span><br><span class="line">lls <span class="comment"># 列出本地主机上当前路径的所有文件</span></span><br><span class="line">lcd <span class="comment"># 在本地主机更改当前路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### lftp同步文件夹(类似rsync工具) ###</span></span><br><span class="line">lftp -u user:pass host</span><br><span class="line">lftp user@host:~&gt; mirror -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 同步⽂件或⽬录，适合备份和⼤规模⽂件传输。</span></span><br><span class="line">rsync -avzh</span><br></pre></td></tr></table></figure>


<h4 id="9">用户管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 用户 ###</span></span><br><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">useradd -m username <span class="comment"># 该命令为用户创建相应的帐号和用户目录/home/username</span></span><br><span class="line">passwd username <span class="comment"># 密码以交互方式创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">userdel -r username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换账户</span></span><br><span class="line">su userB</span><br><span class="line"></span><br><span class="line"><span class="comment">### 用户的组 ###</span></span><br><span class="line"><span class="comment"># 查看当前用户所属的组</span></span><br><span class="line"><span class="built_in">groups</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个用户可以属于多个组，将用户加入到组</span></span><br><span class="line">usermod -G groupNmame username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变更用户所属的根组(将用加入到新的组，并从原有的组中除去）</span></span><br><span class="line">usermod -g groupName username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统的所有用户及所有组信息分别记录在两个文件中：/etc/passwd , /etc/group 默认情况下这两个文件对所有用户可读</span></span><br><span class="line"><span class="comment"># 查看所有用户及权限</span></span><br><span class="line">more /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的用户组及权限</span></span><br><span class="line">more /etc/group</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 用户权限 ###</span></span><br><span class="line">[/home/weber#]<span class="built_in">ls</span> -l /etc/group</span><br><span class="line">-rwxrw-r-- colin king 725 2013-11-12 15:37 /home/colin/a</span><br><span class="line"></span><br><span class="line">-rwx [文件拥有者] 表示这个文件对文件拥有者colin这个用户可读写、可执行；</span><br><span class="line">rw- [所在的组] 对colin所在的组（king）可读可写；</span><br><span class="line">r-- [其他用户] 对其它用户只可读；</span><br><span class="line"></span><br><span class="line"><span class="comment">### 使用chmod命令更改文件的读写权限，更改读写权限有两种方法，一种是字母方式，一种是数字方式</span></span><br><span class="line"><span class="comment">## 字母方式:</span></span><br><span class="line"><span class="built_in">chmod</span> userMark(+|-)PermissionsMark</span><br><span class="line"><span class="comment"># userMark取值：</span></span><br><span class="line"><span class="comment"># u：用户</span></span><br><span class="line"><span class="comment"># g：组</span></span><br><span class="line"><span class="comment"># o：其它用户</span></span><br><span class="line"><span class="comment"># a：所有用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PermissionsMark取值：</span></span><br><span class="line"><span class="comment"># r: 读</span></span><br><span class="line"><span class="comment"># w：写</span></span><br><span class="line"><span class="comment"># x：执行</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> a+x main         对 [所有用户] 给文件main增加可执行权限</span><br><span class="line"><span class="built_in">chmod</span> g+w blogs        对 [组用户] 给文件blogs增加可写权限</span><br><span class="line"></span><br><span class="line"><span class="comment">## 数字方式：</span></span><br><span class="line"><span class="comment"># 4(读)</span></span><br><span class="line"><span class="comment"># 2(写)</span></span><br><span class="line"><span class="comment"># 1(执行)</span></span><br><span class="line"><span class="comment"># 6(4+2)代表有读写权</span></span><br><span class="line"><span class="comment"># 7(4+2+1)有读、写和执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> 740 main     将main的用户权限设置为rwxr-----</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改文件或目录的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> username dirOrFile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用-R选项递归更改该目下所有文件的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> -R weber server/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 环境变量 ###</span></span><br><span class="line"><span class="comment"># /etc/profile，/etc/bashrc 是系统全局环境变量设定、</span></span><br><span class="line"><span class="comment"># ~/.profile，~/.bashrc用户目录下的私有环境变量设定</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当登入系统获得一个shell进程时，其读取环境设置脚本分为三步:</p>
<p>首先读入的是全局环境变量设置文件<code>/etc/profile</code>，然后根据其内容读取额外的文档，如<code>/etc/profile.d</code>和<code>/etc/inputrc</code><br>读取当前登录用户Home目录下的文件<code>~ /.bash_profile</code>，其次读取<code>~ /.bash_login</code>，最后读取<code>~ /.profile</code>，这三个文档设定基本上是一样的，读取有优先关系<br>读取<code>~ /.bashrc</code><br><code>~ /.profile</code>与<code>~ /.bashrc</code>的区别:</p>
<p>这两者都具有个性化定制功能<br><code>~ /.profile</code>可以设定本用户专有的路径，环境变量，等，它只能登入的时候执行一次<br><code>~ /.bashrc</code>也是某用户专有设定文档，可以设定路径，命令别名，每次shell script的执行都会使用它一次</p>
<h4 id="10">防火墙</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>












<p>引用 ： <a target="_blank" rel="noopener" href="https://linuxtools-rst.readthedocs.io/zh-cn/latest/base/07_network.html">https://linuxtools-rst.readthedocs.io/zh-cn/latest/base/07_network.html</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/mac/">
                Mac
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/新/">新</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>m1 已经是arm处理器</p>
<ul>
<li><a href="#%E5%8C%85%E7%AE%A1%E7%90%86-brew">包管理 brew</a></li>
<li><a href="/2025/11/27/shell/" title="Shell">Shell</a></li>
<li><a href="#%E8%93%9D%E7%89%99%E4%BC%A0%E6%96%87%E4%BB%B6">蓝牙传文件</a></li>
<li><a href="#DNS-%E7%BC%93%E5%AD%98">DNS 缓存</a></li>
<li><a href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-launchd-%E4%BB%A3%E6%9B%BF-crontab">定时任务 launchd 代替 crontab</a></li>
</ul>
<h1 id="包管理-brew"><a href="#包管理-brew" class="headerlink" title="包管理 brew"></a>包管理 brew</h1><h1 id="蓝牙传文件"><a href="#蓝牙传文件" class="headerlink" title="蓝牙传文件"></a>蓝牙传文件</h1><p><a target="_blank" rel="noopener" href="https://support.apple.com/zh-cn/guide/mac-help/mchle7fa9e15/mac">蓝牙传文件</a></p>
<h1 id="DNS-缓存"><a href="#DNS-缓存" class="headerlink" title="DNS 缓存"></a>DNS 缓存</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dscacheutil -flushcache; <span class="built_in">sudo</span> killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure>

<h1 id="定时任务-launchd-代替-crontab"><a href="#定时任务-launchd-代替-crontab" class="headerlink" title="定时任务 launchd 代替 crontab"></a>定时任务 launchd 代替 crontab</h1><p></code>crontab</code> 设置后并不起作用</p>
<p>MacOS 可能禁用了 <code>cron</code>，可以用 <code>launchd</code> 代替：</p>
<p>launchd 是 MacOS 用来管理系统和用户级别的守护进程的工具</p>
<ul>
<li><p>LaunchDaemons（后台服务）</p>
<ul>
<li>适用于系统级别的任务，通常以 root 权限运行。</li>
<li>在 开机时 启动，不依赖用户登录。</li>
<li>目录：&#x2F;System&#x2F;Library&#x2F;LaunchDaemons&#x2F; 和 &#x2F;Library&#x2F;LaunchDaemons&#x2F;</li>
<li>适用于系统服务，如数据库、守护进程等。</li>
</ul>
</li>
<li><p>LaunchAgents（用户任务）</p>
<ul>
<li>适用于用户级别的任务，以当前用户权限运行。</li>
<li>在 用户登录后 才会启动。</li>
<li>目录：&#x2F;System&#x2F;Library&#x2F;LaunchAgents&#x2F;、&#x2F;Library&#x2F;LaunchAgents&#x2F;、~&#x2F;Library&#x2F;LaunchAgents&#x2F;</li>
<li>适用于个人任务，如开机自动运行应用、定时脚本等。</li>
</ul>
</li>
</ul>
<p>什么时候用 LaunchDaemons？</p>
<ol>
<li>你希望一个进程开机自动运行，而不依赖用户是否登录。</li>
<li>任务需要root 权限（比如修改系统文件）。</li>
</ol>
<p>什么时候用 LaunchAgents？</p>
<ol>
<li>任务需要在用户登录后运行，比如启动应用、挂载网络驱动等。</li>
<li>你不需要 root 权限，而是以当前用户权限运行。</li>
</ol>
<h3 id="创建一个定时任务"><a href="#创建一个定时任务" class="headerlink" title="创建一个定时任务"></a>创建一个定时任务</h3><p>每天 下午3点运行一次 &#x2F;Users&#x2F;mac&#x2F;work&#x2F;navCatReset&#x2F;reset_navicat.sh。</p>
<ol>
<li>创建 plist 文件</li>
</ol>
<p>vi ~&#x2F;Library&#x2F;LaunchAgents&#x2F;com.user.resetnavicat.plist</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span><br><span class="line">&lt;plist version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;com.user.resetnavicat&lt;/string&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;string&gt;/bin/bash&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;/Users/mac/work/navCatReset/reset_navicat.sh&lt;/string&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StartCalendarInterval&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;Hour&lt;/key&gt;</span><br><span class="line">        &lt;<span class="built_in">integer</span>&gt;15&lt;/integer&gt;  &lt;!-- 下午3点 --&gt;</span><br><span class="line">        &lt;key&gt;Minute&lt;/key&gt;</span><br><span class="line">        &lt;<span class="built_in">integer</span>&gt;0&lt;/integer&gt;   &lt;!-- 00 分 --&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">    &lt;<span class="literal">true</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StandardOutPath&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;/Users/mac/work/navCatReset/cron_stdout.log&lt;/string&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StandardErrorPath&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;/Users/mac/work/navCatReset/cron_stderr.log&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>加载任务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl bootout gui/$(<span class="built_in">id</span> -u) ~/Library/LaunchAgents/com.user.resetnavicat.plist 2&gt;/dev/null</span><br><span class="line">launchctl bootstrap gui/$(<span class="built_in">id</span> -u) ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>检查是否成功</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl list | grep com.user.resetnavicat</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重新加载或修改后生效</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br><span class="line">launchctl load ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>停止任务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl remove com.user.resetnavicat</span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/metasploit/">
                MetaSploit Framwork(MSF)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/渗透工具/">渗透工具</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><h3 id="模块划分"><a href="#模块划分" class="headerlink" title="模块划分"></a>模块划分</h3><ul>
<li>辅助模块 (Auxiliary，扫描器)，扫描主机系统，寻找可用漏洞；</li>
<li>渗透攻击模块 (Exploits)，选择并配置一个漏洞利用模块；</li>
<li>攻击载荷模块 (Payloads)，选择并配置一个攻击载荷模块；</li>
<li>后渗透攻击模块 (Post)，用于内网渗透的各种操作；</li>
<li>编码器模块 (Encoders)，选择编码技术，绕过杀软（或其他免杀方式）；</li>
</ul>
<h3 id="渗透步骤（exploit）"><a href="#渗透步骤（exploit）" class="headerlink" title="渗透步骤（exploit）"></a>渗透步骤（exploit）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search xxx		<span class="comment">## 搜索某个漏洞</span></span><br><span class="line">use xxx			<span class="comment">## 使用某个漏洞利用模块</span></span><br><span class="line">show options    	<span class="comment">## 查看配置选项</span></span><br><span class="line"><span class="built_in">set</span> payload		<span class="comment">## 配置攻击载荷</span></span><br><span class="line">exploit			<span class="comment">## 执行渗透攻击</span></span><br></pre></td></tr></table></figure>

<h3 id="参数摘要"><a href="#参数摘要" class="headerlink" title="参数摘要"></a>参数摘要</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">reload_all		<span class="comment">#从目录重载所有模块。导入模块也需要用到此命令。</span></span><br><span class="line">back	<span class="comment">#后退命令，移出当前上下文，用于模块切换</span></span><br><span class="line">info	<span class="comment">#目标和模块详细信息</span></span><br><span class="line">check	<span class="comment">#检查目标是否受某个漏洞影响</span></span><br><span class="line"></span><br><span class="line">sessions		<span class="comment">#会话管理</span></span><br><span class="line">sessions -l		<span class="comment">#列出所有会话</span></span><br><span class="line">sessions -K		<span class="comment">#终止所有会话</span></span><br><span class="line">sessions -i <span class="built_in">id</span>	<span class="comment">#进入某个会话</span></span><br><span class="line">sessions -v		<span class="comment">#以详细模式列出会话</span></span><br><span class="line">sessions -u		<span class="comment">#在许多平台上将shell升级到meterpreter会话</span></span><br><span class="line"></span><br><span class="line">show options	<span class="comment">#显示可选选项</span></span><br><span class="line">	 auxiliary	<span class="comment">#显示所有辅助模块</span></span><br><span class="line">	 exploits	<span class="comment">#显示所有漏洞利用模块</span></span><br><span class="line">	 payloads	<span class="comment">#显示所有有效载荷</span></span><br><span class="line">	 targets	<span class="comment">#显示所有可用目标</span></span><br><span class="line">	 advanced	<span class="comment">#显示更多高级选项</span></span><br><span class="line">	 encoders	<span class="comment">#显示可用编码器列表</span></span><br><span class="line">	 </span><br><span class="line"><span class="built_in">unset</span> [Module Options]    <span class="comment">#清除Module Options</span></span><br></pre></td></tr></table></figure>


<h3 id="脚本使用-高级用法"><a href="#脚本使用-高级用法" class="headerlink" title="脚本使用 (高级用法)"></a>脚本使用 (高级用法)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 搜索关于 afp的脚本</span></span><br><span class="line">nmap --script-help <span class="string">&quot;afp-*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 扫描常见漏洞</span></span><br><span class="line">nmap --script vuln &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查FTP是否开启匿名登陆</span></span><br><span class="line">nmap --script ftp-anon &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 对MySQL进行暴力破解</span></span><br><span class="line">nmap --script=mysql-brute &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 对MsSQL进行暴力破解</span></span><br><span class="line">nmap -p 1433 --script ms-sql-brute --script-args userdb=customuser.txt,passdb=custompass.txt &lt;host&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 利用DNS进行子域名暴力破解</span></span><br><span class="line">nmap --script dns-brute www.baidu.com</span><br></pre></td></tr></table></figure>

<h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 表示方式</span></span><br><span class="line">-iL filename                    从文件中读取待检测的目标,文件中的表示方法支持机名,ip,网段</span><br><span class="line">-iR hostnum                     随机选取,进行扫描.如果-iR指定为0,则是无休止的扫描</span><br><span class="line">--exclude host1[, host2]        从扫描任务中需要排除的主机           </span><br><span class="line">--exculdefile exclude_file      排除文件中的IP,格式和-iL指定扫描文件的格式相同</span><br><span class="line"></span><br><span class="line"><span class="comment">## 主机发现</span></span><br><span class="line">-sL                     仅仅是显示,扫描的IP数目,不会进行任何扫描</span><br><span class="line">-sn                     ping扫描,即主机发现</span><br><span class="line">-Pn                     不检测主机存活</span><br><span class="line">-PS/PA/PU/PY[portlist]  TCP SYN Ping/TCP ACK Ping/UDP Ping发现</span><br><span class="line">-PE/PP/PM               使用ICMP <span class="built_in">echo</span>, timestamp and netmask 请求包发现主机</span><br><span class="line">-PO[prococol list]      使用IP协议包探测对方主机是否开启   </span><br><span class="line">-n/-R                   不对IP进行域名反向解析/为所有的IP都进行域名的反响解析</span><br><span class="line"></span><br><span class="line"><span class="comment">## 扫描技巧</span></span><br><span class="line">-sS/sT/sA/sW/sM                 TCP SYN/TCP connect()/ACK/TCP窗口扫描/TCP Maimon扫描</span><br><span class="line">-sU                             UDP扫描</span><br><span class="line">-sN/sF/sX                       TCP Null，FIN，and Xmas扫描</span><br><span class="line">--scanflags                     自定义TCP包中的flags</span><br><span class="line">-sI zombie host[:probeport]     Idlescan</span><br><span class="line">-sY/sZ                          SCTP INIT/COOKIE-ECHO 扫描</span><br><span class="line">-sO                             使用IP protocol 扫描确定目标机支持的协议类型</span><br><span class="line">-b “FTP relay host”             使用FTP bounce scan</span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定端口 扫描顺序</span></span><br><span class="line">-p                      特定的端口 -p80,443 或者 -p1-65535</span><br><span class="line">-p U:PORT               扫描udp的某个端口, -p U:53</span><br><span class="line">-F                      快速扫描模式,比默认的扫描端口还少</span><br><span class="line">-r                      不随机扫描端口,默认是随机扫描的</span><br><span class="line">--top-ports <span class="string">&quot;number&quot;</span>    扫描开放概率最高的number个端口,出现的概率需要参考nmap-services文件,ubuntu中该文件位于/usr/share/nmap.nmap默认扫前1000个</span><br><span class="line">--port-ratio <span class="string">&quot;ratio&quot;</span>    扫描指定频率以上的端口</span><br><span class="line"></span><br><span class="line"><span class="comment">## 服务版本识别</span></span><br><span class="line">-sV                             开放版本探测,可以直接使用-A同时打开操作系统探测和版本探测</span><br><span class="line">--version-intensity <span class="string">&quot;level&quot;</span>     设置版本扫描强度,强度水平说明了应该使用哪些探测报文。数值越高，服务越有可能被正确识别。默认是7</span><br><span class="line">--version-light                 打开轻量级模式,为--version-intensity 2的别名</span><br><span class="line">--version-all                   尝试所有探测,为--version-intensity 9的别名</span><br><span class="line">--version-trace                 显示出详细的版本侦测过程信息</span><br><span class="line"></span><br><span class="line"><span class="comment">## 脚本扫描</span></span><br><span class="line">-sC                             根据端口识别的服务,调用默认脚本</span><br><span class="line">--script=”Lua scripts”          调用的脚本名</span><br><span class="line">--script-args=n1=v1,[n2=v2]     调用的脚本传递的参数</span><br><span class="line">--script-args-file=filename     使用文本传递参数</span><br><span class="line">--script-trace                  显示所有发送和接收到的数据</span><br><span class="line">--script-updatedb               更新脚本的数据库</span><br><span class="line">--script-help=”Lua script”      显示指定脚本的帮助</span><br><span class="line"></span><br><span class="line"><span class="comment">## OS识别</span></span><br><span class="line">-O              启用操作系统检测,-A来同时启用操作系统检测和版本检测</span><br><span class="line">--osscan-limit  针对指定的目标进行操作系统检测(至少需确知该主机分别有一个open和closed的端口)</span><br><span class="line">--osscan-guess  推测操作系统检测结果,当Nmap无法确定所检测的操作系统时，会尽可能地提供最相近的匹配，Nmap默认进行这种匹配</span><br><span class="line">防火墙/IDS躲避和哄骗</span><br><span class="line">-f; --mtu value                 指定使用分片、指定数据包的MTU.</span><br><span class="line">-D decoy1,decoy2,ME             使用诱饵隐蔽扫描</span><br><span class="line">-S IP-ADDRESS                   源地址欺骗</span><br><span class="line">-e interface                    使用指定的接口</span><br><span class="line">-g/ --source-port PROTNUM       使用指定源端口  </span><br><span class="line">--proxies url1,[url2],...       使用HTTP或者SOCKS4的代理</span><br><span class="line"></span><br><span class="line">--data-length NUM               填充随机数据让数据包长度达到NUM</span><br><span class="line">--ip-options OPTIONS            使用指定的IP选项来发送数据包</span><br><span class="line">--ttl VALUE                     设置IP time-to-live域</span><br><span class="line">--spoof-mac ADDR/PREFIX/VEBDOR  MAC地址伪装</span><br><span class="line">--badsum                        使用错误的checksum来发送数据包</span><br><span class="line">Nmap 输出</span><br><span class="line">-oN                     将标准输出直接写入指定的文件</span><br><span class="line">-oX                     输出xml文件</span><br><span class="line">-oS                     将所有的输出都改为大写</span><br><span class="line">-oG                     输出便于通过bash或者perl处理的格式,非xml</span><br><span class="line">-oA BASENAME            可将扫描结果以标准格式、XML格式和Grep格式一次性输出</span><br><span class="line">-v                      提高输出信息的详细度</span><br><span class="line">-d level                设置debug级别,最高是9</span><br><span class="line">--reason                显示端口处于带确认状态的原因</span><br><span class="line">--open                  只输出端口状态为open的端口</span><br><span class="line">--packet-trace          显示所有发送或者接收到的数据包</span><br><span class="line">--iflist                显示路由信息和接口,便于调试</span><br><span class="line">--log-errors            把日志等级为errors/warings的日志输出</span><br><span class="line">--append-output         追加到指定的文件</span><br><span class="line">--resume FILENAME       恢复已停止的扫描</span><br><span class="line">--stylesheet PATH/URL   设置XSL样式表，转换XML输出</span><br><span class="line">--webxml                从namp.org得到XML的样式</span><br><span class="line">--no-sytlesheet         忽略XML声明的XSL样式表</span><br><span class="line"></span><br><span class="line"><span class="comment">## nmap选项</span></span><br><span class="line">-6                      开启IPv6</span><br><span class="line">-A                      OS识别,版本探测,脚本扫描和traceroute</span><br><span class="line">--datedir DIRNAME       说明用户Nmap数据文件位置</span><br><span class="line">--send-eth / --send-ip  使用原以太网帧发送/在原IP层发送</span><br><span class="line">--privileged            假定用户具有全部权限</span><br><span class="line">--unprovoleged          假定用户不具有全部权限,创建原始套接字需要root权限</span><br><span class="line">-V                      打印版本信息</span><br><span class="line">-h                      输出帮助</span><br></pre></td></tr></table></figure>

<p>引用<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2090727">https://cloud.tencent.com/developer/article/2090727</a><br><a target="_blank" rel="noopener" href="https://sh1yan.top/2019/07/28/MSF-Command-Notes/">https://sh1yan.top/2019/07/28/MSF-Command-Notes/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LyShark/p/12189163.html">https://www.cnblogs.com/LyShark/p/12189163.html</a><br><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/tools/metasploit.html">https://wiki.wgpsec.org/knowledge/tools/metasploit.html</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/mongodb/">
                MongoDB
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/数据库/">数据库</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#%E5%9F%BA%E7%A1%80">基础</a><ul>
<li><a href="#MySQL%E5%92%8Cmongodb%E7%9A%84%E5%8C%BA%E5%88%AB">MySQL和mongodb的区别</a></li>
<li><a href="#CRUD">CRUD</a></li>
<li><a href="#%E8%81%9A%E5%90%88">聚合查询</a><ul>
<li><a href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2-lookup">高级查询 lookup</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2-lookup-+-pipeline">高级查询 lookup + pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">数据迁移</a>  <!-- * [分析器在MongoDB中的作用](#1.1)
  * [名字空间(namespace)是](#1.1)
  * [如果用户移除对象的属性，该属性是否从存储层中删除](#1.1)
  * [允许空值null吗](#1.1)
  * [更新操作立刻fsync到磁盘](#1.1)
  * [如何执行事务/加锁](#1.1)
  * [数据文件如此庞大](#1.1)
  * [启用备份故障恢复需要多久](#1.1)
  * [什么是master或primary](#1.1)
  * [什么是secondary或slave](#1.1)
  * [我必须调用getLastError来确保写操作生效了么](#1.1)
  * [分片(sharding)和复制(replication)是怎样工作的](#1.1)
  * [数据在什么时候才会扩展到多个分片(shard)里](#1.1) --></li>
</ul>
<p>非关系型数据库 -&gt; 文档数据库<br>可提供高性能，高可用性和易扩展性。<br>数据模型实现，接口，对想存储以及复制方法</p>
<p>GridFS是一种将大型文件存储在MongoDB的文件规范。 所有官方支持的驱动均实现了GridFS规范。 GridFS是MongoDB中的一个内置功能，可以用于存放文件。 数据库支持以(BSON格式<code>Binary JSON</code>)保存二进制对象。</p>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><table>
<thead>
<tr>
<th>SQL术语&#x2F;概念</th>
<th>MongoDB 术语&#x2F;概念</th>
<th>解释&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表&#x2F;集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行&#x2F;文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段&#x2F;域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接,MongoDB不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<h2 id="MySQL和mongodb的区别"><a href="#MySQL和mongodb的区别" class="headerlink" title="MySQL和mongodb的区别"></a>MySQL和mongodb的区别</h2><table>
<thead>
<tr>
<th>形式</th>
<th>MongoDB</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>数据库模型</td>
<td>非关系型</td>
<td>关系型</td>
</tr>
<tr>
<td>存储方式</td>
<td></td>
<td>虚拟内存+持久化</td>
</tr>
<tr>
<td>查询语句</td>
<td>独特的MongoDB查询方式</td>
<td>传统SQL语句</td>
</tr>
<tr>
<td>架构特点</td>
<td>副本集以及分片</td>
<td>常见单点、M-S、MHA、MMM等架构方式</td>
</tr>
<tr>
<td>数据处理方式</td>
<td>基于内存，将热数据存在物理内存中，从而达到高速读写</td>
<td>不同的引擎拥有自己的特点</td>
</tr>
<tr>
<td>使用场景</td>
<td>事件的记录，内容管理或者博客平台等数据大且非结构化数据的场景</td>
<td>适用于数据量少且很多结构化数据</td>
</tr>
</tbody></table>
<p>索引类型</p>
<ul>
<li>单字段索引(Single Field Indexes)</li>
<li>复合索引(Compound Indexes)</li>
<li>多键索引(Multikey Indexes)</li>
<li>全文索引(text Indexes)</li>
<li>Hash 索引(Hash Indexes)</li>
<li>通配符索引(Wildcard Index)</li>
<li>2dsphere索引(2dsphere Indexes)</li>
</ul>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 批量更新 click, favorite, love, notlove</span></span><br><span class="line">db.getCollection(<span class="string">&quot;post&quot;</span>).updateMany(&#123; <span class="variable">$set</span>: &#123;</span><br><span class="line">        click: 0,</span><br><span class="line">        favorite: 0,</span><br><span class="line">        love: 0,</span><br><span class="line">        notlove:0</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询age字段不存在并且批量更新为1</span></span><br><span class="line">db.getCollection(<span class="string">&quot;users&quot;</span>).updateMany(</span><br><span class="line">    &#123; age: &#123; <span class="variable">$exists</span>: <span class="literal">false</span> &#125; &#125;, </span><br><span class="line">    &#123; <span class="variable">$set</span>: &#123; age: 18 &#125; &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><h3 id="Create-新增"><a href="#Create-新增" class="headerlink" title="Create 新增"></a>Create 新增</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">insertOne</span>(&#123;</span><br><span class="line">  <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span>,</span><br><span class="line">  <span class="attr">order_sn</span>: <span class="string">&quot;aaaa&quot;</span>,</span><br><span class="line">  <span class="attr">user_id</span>: <span class="number">4568</span>,</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;0KLd&quot;</span>,</span><br><span class="line">  <span class="attr">object_id</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">object_type</span>: <span class="string">&quot;face1&quot;</span>,</span><br><span class="line">  <span class="attr">object_money_old</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">register_at</span>: <span class="number">1750145943</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Delete-删除"><a href="#Delete-删除" class="headerlink" title="Delete 删除"></a>Delete 删除</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">deleteOne</span>(&#123;</span><br><span class="line">  <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Update-更新"><a href="#Update-更新" class="headerlink" title="Update 更新"></a>Update 更新</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">updateOne</span>(</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$set</span>: &#123;</span><br><span class="line">      <span class="attr">out_data</span>: [</span><br><span class="line">        <span class="string">&quot;/md-204/m3u8-download/a嗷嗷aa.m3u8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/md-204/ai-out-files/5a.zip&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Read-查询"><a href="#Read-查询" class="headerlink" title="Read 查询"></a>Read 查询</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;)</span><br></pre></td></tr></table></figure>


<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><h3 id="高级查询-lookup"><a href="#高级查询-lookup" class="headerlink" title="高级查询 lookup"></a>高级查询 lookup</h3><p><code>$lookup</code> 是 MongoDB 聚合框架中的一个阶段，用来在两个集合之间进行联表查询（类似 SQL 的 JOIN）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">orders</span>.<span class="title function_">aggregate</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$lookup</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&quot;users&quot;</span>,           <span class="comment">// 要连接的集合名</span></span><br><span class="line">      <span class="attr">localField</span>: <span class="string">&quot;user_id&quot;</span>,   <span class="comment">// orders 中的字段</span></span><br><span class="line">      <span class="attr">foreignField</span>: <span class="string">&quot;_id&quot;</span>,     <span class="comment">// users 中的字段</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;user_info&quot;</span>          <span class="comment">// 输出的新字段（数组）</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="高级查询-lookup-pipeline"><a href="#高级查询-lookup-pipeline" class="headerlink" title="高级查询 lookup + pipeline"></a>高级查询 lookup + pipeline</h3><p>pipeline高级方式，支持表达式和子查询</p>
<p>📘 场景设定<br>orders 集合（订单）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>users 集合（用户）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>🎯 目标<br>想查出 orders，并只联表关联<strong>is_active &#x3D; true</strong> 的用户信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">orders</span>.<span class="title function_">aggregate</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$lookup</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">      <span class="attr">let</span>: &#123; <span class="attr">uid</span>: <span class="string">&quot;$user_id&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">pipeline</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">$match</span>: &#123;</span><br><span class="line">            <span class="attr">$expr</span>: &#123; <span class="attr">$eq</span>: [<span class="string">&quot;$_id&quot;</span>, <span class="string">&quot;$$uid&quot;</span>] &#125;,   <span class="comment">// 条件：user._id == orders.user_id</span></span><br><span class="line">            <span class="attr">is_active</span>: <span class="literal">true</span>                      <span class="comment">// 只关联激活用户</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">$project</span>: &#123; <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">_id</span>: <span class="number">0</span> &#125;           <span class="comment">// 可选：控制输出字段</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;user_info&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">$unwind</span>: <span class="string">&quot;$user_info&quot;</span> &#125; <span class="comment">// 如果你只要一个用户对象而不是数组</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>✅ 查询结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Alice&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  &#x27;$group&#x27; =&gt; <span class="punctuation">[</span></span><br><span class="line">    &#x27;_id&#x27;         =&gt; &#x27;$object_type&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;total_count&#x27; =&gt; <span class="punctuation">[</span>&#x27;$sum&#x27; =&gt; <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    &#x27;total_money&#x27; =&gt; <span class="punctuation">[</span>&#x27;$sum&#x27; =&gt; &#x27;$object_money&#x27;<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>💡 说明</p>
<table>
<thead>
<tr>
<th>关键点</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>let: &#123; uid: &quot;$user_id&quot; &#125;</code></td>
<td>把外部变量传入内部 pipeline</td>
</tr>
<tr>
<td><code>$expr</code> + <code>$eq</code></td>
<td>允许字段与字段对比（而不是固定值）</td>
</tr>
<tr>
<td><code>is_active: true</code></td>
<td>增加自定义的过滤逻辑</td>
</tr>
<tr>
<td><code>$project</code></td>
<td>控制最终关联的字段</td>
</tr>
<tr>
<td><code>$unwind</code></td>
<td>把数组变成对象，常用于一对一关系</td>
</tr>
</tbody></table>
<h1 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h1><ul>
<li>导入 - 多集合</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置部分</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span> </span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span> </span><br><span class="line">DATABASE=<span class="string">&quot;&quot;</span> </span><br><span class="line">FOLDER_PATH=<span class="string">&quot;/data/db/backup_dev_20250115&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历文件夹 </span></span><br><span class="line"><span class="keyword">for</span> DIR <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$FOLDER_PATH</span>&quot;</span>/*/; <span class="keyword">do</span> </span><br><span class="line">	COLLECTION_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$DIR</span>&quot;</span>) </span><br><span class="line">	mongorestore --db <span class="variable">$COLLECTION_NAME</span> <span class="variable">$DIR</span>  -j 100</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有文件导入完成！&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>备份-多集合</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 基础配置 ===</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span></span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/data/db/dbback&quot;</span></span><br><span class="line">PJ=<span class="string">&quot;dev&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d)</span><br><span class="line">LOG_FILE=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>.log&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 日志函数 ===</span></span><br><span class="line"><span class="function"><span class="title">log_msg</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$1</span>&quot;</span> | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># === 获取集合名 ===</span></span><br><span class="line"><span class="function"><span class="title">get_all_collections</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> db=<span class="variable">$1</span></span><br><span class="line">    mongo --quiet --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> --<span class="built_in">eval</span> <span class="string">&quot;db.getSiblingDB(&#x27;<span class="variable">$db</span>&#x27;).getCollectionNames().join(&#x27; &#x27;)&quot;</span> 2&gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># === 交互 ===</span></span><br><span class="line"><span class="built_in">declare</span> -A FULL_COLLECTIONS_MAP</span><br><span class="line"><span class="built_in">declare</span> -A STRUCT_ONLY_COLLECTIONS_MAP</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入需要备份的数据库数量: &quot;</span> DB_COUNT</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=DB_COUNT; i++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请输入第 <span class="variable">$i</span> 个数据库名: &quot;</span> DB_NAME</span><br><span class="line"></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;数据库 <span class="variable">$DB_NAME</span> 中【完整备份（含数据）】的集合（支持 all / exclude xxx / 指定）: &quot;</span> full_input</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;数据库 <span class="variable">$DB_NAME</span> 中【只备结构】的集合（支持 all / 指定）: &quot;</span> struct_input</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理含数据集合</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$full_input</span>&quot;</span> == <span class="string">&quot;all&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="subst">$(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$full_input</span>&quot;</span> =~ ^exclude ]]; <span class="keyword">then</span></span><br><span class="line">        all_cols=($(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>))</span><br><span class="line">        exclude_cols=(<span class="variable">$&#123;full_input[@]:1&#125;</span>)</span><br><span class="line">        keep_cols=()</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;all_cols[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> [[ ! <span class="string">&quot; <span class="variable">$&#123;exclude_cols[*]&#125;</span> &quot;</span> =~ <span class="string">&quot; <span class="variable">$col</span> &quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                keep_cols+=(<span class="string">&quot;<span class="variable">$col</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$&#123;keep_cols[*]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$full_input</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理只结构集合</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$struct_input</span>&quot;</span> == <span class="string">&quot;all&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        STRUCT_ONLY_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="subst">$(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        STRUCT_ONLY_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$struct_input</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 备份逻辑 ===</span></span><br><span class="line"><span class="keyword">for</span> DB_NAME <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!FULL_COLLECTIONS_MAP[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    BACKUP_PATH=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    log_msg <span class="string">&quot;📦 正在备份数据库 <span class="variable">$DB_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> COLLECTION <span class="keyword">in</span> <span class="variable">$&#123;FULL_COLLECTIONS_MAP[$DB_NAME]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        log_msg <span class="string">&quot;📥 备份集合 <span class="variable">$DB_NAME</span>.<span class="variable">$COLLECTION</span>（含数据）&quot;</span></span><br><span class="line">        mongodump --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> \</span><br><span class="line">                  --db <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span> --collection <span class="string">&quot;<span class="variable">$COLLECTION</span>&quot;</span> \</span><br><span class="line">                  --out <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> COLLECTION <span class="keyword">in</span> <span class="variable">$&#123;STRUCT_ONLY_COLLECTIONS_MAP[$DB_NAME]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        log_msg <span class="string">&quot;🧱 备份集合 <span class="variable">$DB_NAME</span>.<span class="variable">$COLLECTION</span>（仅结构）&quot;</span></span><br><span class="line">        mongodump --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> \</span><br><span class="line">                  --db <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span> --collection <span class="string">&quot;<span class="variable">$COLLECTION</span>&quot;</span> \</span><br><span class="line">                  --query <span class="string">&#x27;&#123;&#125;&#x27;</span> --<span class="built_in">limit</span> 0 \</span><br><span class="line">                  --out <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    TAR_NAME=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.tar.gz&quot;</span></span><br><span class="line">    log_msg <span class="string">&quot;🗜️ 压缩 <span class="variable">$DB_NAME</span> 到 <span class="variable">$TAR_NAME</span>&quot;</span></span><br><span class="line">    tar -zcf <span class="string">&quot;<span class="variable">$TAR_NAME</span>&quot;</span> -C <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">log_msg <span class="string">&quot;🧹 删除7天前的旧备份...&quot;</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -<span class="built_in">type</span> f -name <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_*.tar.gz&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \; &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">log_msg <span class="string">&quot;✅ 所有备份任务完成！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何使用脚本</span></span><br><span class="line"><span class="comment"># 请输入需要备份的数据库数量: 2</span></span><br><span class="line"><span class="comment"># 请输入第 1 个数据库名: userdb</span></span><br><span class="line"><span class="comment"># 请输入数据库 userdb 中要【完整备份（含数据）】的集合（空格分隔，支持 all / exclude xxx）: all</span></span><br><span class="line"><span class="comment"># 请输入数据库 userdb 中要【只备结构】的集合（空格分隔，支持 all）: app_log post_log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请输入第 2 个数据库名: productdb</span></span><br><span class="line"><span class="comment"># 请输入数据库 productdb 中要【完整备份（含数据）】的集合（空格分隔，支持 all / exclude xxx）: exclude items post_log</span></span><br><span class="line"><span class="comment"># 请输入数据库 productdb 中要【只备结构】的集合（空格分隔，支持 all）: app_log </span></span><br></pre></td></tr></table></figure>


<p>mongodb 副本集的主的选举–优先级设置</p>
<p>分片<br>复制集</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904186300071943">https://juejin.cn/post/6844904186300071943</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/create/">
                创业思维
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/创业/">创业</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="找到个人商业路径：从副业起步到系统化创业"><a href="#找到个人商业路径：从副业起步到系统化创业" class="headerlink" title="找到个人商业路径：从副业起步到系统化创业"></a>找到个人商业路径：从副业起步到系统化创业</h1><ol>
<li>边工作边探索，用副业试水</li>
<li>独立的“小业务”其实可以共享我的个人品牌资源和受众池，相互促进。</li>
</ol>
<h1 id="可操作性强的建议：从副产品到被动收入"><a href="#可操作性强的建议：从副产品到被动收入" class="headerlink" title="可操作性强的建议：从副产品到被动收入"></a>可操作性强的建议：从副产品到被动收入</h1><ol>
<li>将副业作为起点</li>
<li>先用最小成本测试市场反应</li>
<li>在营销方面，作者介绍了**“链式传播”的概念，即注重让用户帮你二次传播（例如转发分享），实现滚雪球式增长 </li>
<li>尽量避开与大公司正面交锋，而是寻找小众且刚需的细分市场，以差异化的定位胜出</li>
<li>反思自己的项目：与其跟风拥挤的热门领域，不如发挥个人专长，找到尚未被满足的特殊需求，这样才能减少竞争压力，用巧劲取胜。</li>
</ol>
<h1 id="创业精神与价值观：小而美、优雅独立"><a href="#创业精神与价值观：小而美、优雅独立" class="headerlink" title="创业精神与价值观：小而美、优雅独立"></a>创业精神与价值观：小而美、优雅独立</h1><ol>
<li>“小规模、可持续”，不盲目追求公司做大做快，而是专注把业务做精做好，维持精巧的规模以获取自由</li>
<li>做让自己和用户都由衷认可的事，财富将自然而然地到来</li>
<li>持续学习与分享，乐于分享、共同成长</li>
</ol>
<h1 id="新的认识与激励：从螺丝钉到超级个体的信心"><a href="#新的认识与激励：从螺丝钉到超级个体的信心" class="headerlink" title="新的认识与激励：从螺丝钉到超级个体的信心"></a>新的认识与激励：从螺丝钉到超级个体的信心</h1><ol>
<li>个人完全可以成为一个“小而全”的公司，最低可行利润，先让副业收入达到养活自己</li>
<li>迈出体制、独立生存就是胜利的开始</li>
<li>副业就是最好的练兵场</li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/darkweb/">
                darkweb
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="网络安全"><a href="#网络安全" class="headerlink" title="网络安全"></a>网络安全</h2><h3 id="分类文章"><a href="#分类文章" class="headerlink" title="分类文章"></a>分类文章</h3><p><a target="_blank" rel="noopener" href="http://juhanurmihxlp77nkq76byazcldy2hlmovfu2epvl5ankdibsot4csyd.onion/">搜索工具</a></p>
<p><a target="_blank" rel="noopener" href="http://weapon5dj7fwz2zaqa22fqeaqrauclim5kfvecegphrvxeywxoa3wuid.onion/shop.php">黑市交易</a></p>
<p><a target="_blank" rel="noopener" href="https://onion666.com/">暗网交易中心</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/data-analysis/">
                数据分析
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/数据分析/">数据分析</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="一个国家的市场分析"><a href="#一个国家的市场分析" class="headerlink" title="一个国家的市场分析"></a>一个国家的市场分析</h1><h2 id="trends-爬虫"><a href="#trends-爬虫" class="headerlink" title="trends 爬虫"></a>trends 爬虫</h2><h3 id="google-trends"><a href="#google-trends" class="headerlink" title="google trends"></a>google trends</h3><h3 id="facebook-trends"><a href="#facebook-trends" class="headerlink" title="facebook trends"></a>facebook trends</h3><h3 id="youtube-trends"><a href="#youtube-trends" class="headerlink" title="youtube trends"></a>youtube trends</h3>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/docker-basic/">
                Docker
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/运维/">运维</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#%E5%9F%BA%E7%A1%80">基础</a><ul>
<li><a href="#Docker%E7%9A%84%E7%BB%84%E6%88%90">Docker的组成</a></li>
<li><a href="#Docker%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF">Docker底层技术</a></li>
<li><a href="#Docker%E7%BD%91%E7%BB%9C">Docker网络</a></li>
<li><a href="#Docker%E4%B8%8E%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%8C%BA%E5%88%AB">Docker与传统虚拟机的区别</a></li>
<li><a href="#%E5%AE%B9%E5%99%A8%E7%9A%84copy-on-write%E7%89%B9%E6%80%A7%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%AE%B9%E5%99%A8%E9%87%8C%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%E4%BC%9A%E4%BF%AE%E6%94%B9%E9%95%9C%E5%83%8F">容器的copy-on-write特性，修改容器里面的内容会修改镜像</a></li>
<li><a href="#Dockerfile%E7%9A%84%E6%95%B4%E4%B8%AA%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E8%BF%87%E7%A8%8B">Dockerfile的整个构建镜像过程</a></li>
<li><a href="#Dockerfile%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4">Dockerfile的基本指令</a></li>
<li><a href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4">进入容器命令</a></li>
</ul>
</li>
<li><a href="#docker-compose">docker-compose</a><ul>
<li><a href="#Dockerfile-%E6%9B%B4%E6%96%B0/%E9%87%8D%E6%9E%84">Dockerfile 更新&#x2F;重构</a></li>
</ul>
</li>
<li><a href="#docker%E5%A4%96%E7%94%A8">docker外用</a><ul>
<li><a href="#Docker%E5%AE%B9%E5%99%A8%E6%97%B6%E9%97%B4%E4%B8%8E%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%8D%E4%B8%80%E8%87%B4">Docker容器时间与宿主机不一致</a></li>
</ul>
</li>
<li><a href="#Docker%E9%80%83%E9%80%B8">Docker逃逸</a></li>
</ul>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><h2 id="Docker的组成"><a href="#Docker的组成" class="headerlink" title="Docker的组成"></a>Docker的组成</h2><ul>
<li><em><strong>docker client 客户端</strong></em> 👉  docker daemon 交互</li>
<li><em><strong>docker daemon 守护进程</strong></em> 👉  一般在宿主主机后台运行，等待接收来自客户端的请求消息</li>
<li><em><strong>docker container 容器</strong></em> 👉  镜像的运行实例，我们可以把镜像看成是一个个的构建块，容器根据这些构建块搭建起了一个隔离的，拥有整个包的应用程序。每一个容器都是一个标准化单元，确保了在不同机子上也能拥有一致的行为</li>
<li><em><strong>docker image 镜像</strong></em> 👉  包含了操作系统的一张光碟，它是一个模板文件，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）</li>
<li><em><strong>数据卷</strong></em> 👉  Docker 对数据持久化的解决方案，数据不会随着容器结束而丢失，通过将宿主机的某一文件目录载到容器里来实现 <code>volumes：</code></li>
<li><em><strong>网络</strong></em> <ul>
<li><em><strong>bridge 模式</strong></em> 👉  Docker 在主机上会创建一个<code>docker0</code>的网桥</li>
<li><em><strong>host 模式</strong></em> 👉  在建一个容器时，一般会为容器分配一个独立的 Network Namespace 以进行网络隔离。如果我们使用了 Host 模式，则不再分配 Network Namespace，而是和宿主机共用一个 Network Namespace。此时容器将不再拥有自己的虚拟网卡、IP 和端口，而是和宿主机共用一个 IP 和端口</li>
<li><em><strong>none 模式</strong></em> 👉  使用 none 模式的容器拥有属于自己的 Network Namespace，但不做任何网络配置。它和宿主机以及其他容器是不互通的。如果需要和外部通信，则需要自定义网络驱动程序，自己添加网卡、配置 IP 等</li>
</ul>
</li>
</ul>
<h2 id="Docker底层技术"><a href="#Docker底层技术" class="headerlink" title="Docker底层技术"></a>Docker底层技术</h2><ul>
<li><em><strong>Namespaces（资源隔离）</strong></em>：将系统的全局资源通过抽象划分，使得在同一 namespace 中的进程看起来拥有自己的全局资源。主要有 Mount namespaces（文件系统挂载）、Network namespaces（网络）、User namespaces（用户）等的资源隔离。</li>
<li><em><strong>CGroups（资源限制）</strong></em>：对系统资源的限制，比如 CPU、内存等。</li>
<li><em><strong>UnionFS（联合文件系统）</strong></em>：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。便于镜像的分层继承。</li>
</ul>
<h2 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker network prune</span><br><span class="line"></span><br><span class="line">docker network <span class="built_in">rm</span> XXX</span><br><span class="line"></span><br><span class="line">docker network list</span><br></pre></td></tr></table></figure>

<h2 id="Docker与传统虚拟机的区别"><a href="#Docker与传统虚拟机的区别" class="headerlink" title="Docker与传统虚拟机的区别"></a>Docker与传统虚拟机的区别</h2><table>
<thead>
<tr>
<th>特性</th>
<th>Docker 容器</th>
<th>传统虚拟机 (VM)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>启动速度</strong></td>
<td>秒级启动 (轻量级)</td>
<td>分钟级启动 (启动完整操作系统)</td>
</tr>
<tr>
<td><strong>资源占用</strong></td>
<td>共享主机内核，资源占用小</td>
<td>每个虚拟机包含完整操作系统，占用大</td>
</tr>
<tr>
<td><strong>架构</strong></td>
<td>基于容器引擎 (如 Docker Engine)</td>
<td>基于 Hypervisor (如 VMware、VirtualBox)</td>
</tr>
<tr>
<td><strong>运行效率</strong></td>
<td>运行在主机操作系统之上，高效</td>
<td>需通过 Hypervisor 间接访问硬件，性能损耗较大</td>
</tr>
<tr>
<td><strong>文件系统</strong></td>
<td>分层镜像 (Layered Images)，增量存储</td>
<td>每个虚拟机独立的磁盘文件 (如 VMDK, VDI)</td>
</tr>
<tr>
<td><strong>隔离性</strong></td>
<td>进程级隔离，共享主机内核</td>
<td>完全隔离，虚拟机有自己的内核</td>
</tr>
<tr>
<td><strong>操作系统支持</strong></td>
<td>仅支持与主机相同的内核 (通常是 Linux)</td>
<td>支持不同的操作系统 (如在 Windows 上运行 Linux)</td>
</tr>
<tr>
<td><strong>应用场景</strong></td>
<td>微服务、CI&#x2F;CD、测试环境、轻量服务</td>
<td>需要完整操作系统的场景，如传统应用、特定依赖环境</td>
</tr>
<tr>
<td><strong>部署方式</strong></td>
<td>Dockerfile、镜像 (Image)、容器 (Container)</td>
<td>镜像 (ISO)、虚拟机模板、虚拟机实例</td>
</tr>
<tr>
<td><strong>资源调度</strong></td>
<td>通过编排工具 (如 Kubernetes) 实现灵活调度</td>
<td>通过虚拟化平台 (如 vSphere) 进行调度</td>
</tr>
<tr>
<td><strong>迁移灵活性</strong></td>
<td>容器镜像小，迁移快</td>
<td>虚拟机文件大，迁移相对慢</td>
</tr>
</tbody></table>
<h2 id="容器的copy-on-write特性，修改容器里面的内容会修改镜像"><a href="#容器的copy-on-write特性，修改容器里面的内容会修改镜像" class="headerlink" title="容器的copy-on-write特性，修改容器里面的内容会修改镜像"></a>容器的copy-on-write特性，修改容器里面的内容会修改镜像</h2><h2 id="Dockerfile的整个构建镜像过程"><a href="#Dockerfile的整个构建镜像过程" class="headerlink" title="Dockerfile的整个构建镜像过程"></a>Dockerfile的整个构建镜像过程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t [镜像名]:tag</span><br><span class="line">docker build -t 镜像名:tag -f /xx/xxx/Dockerfile <span class="comment"># 可以使用-f参数来指定dockerfile文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Dockerfile的基本指令"><a href="#Dockerfile的基本指令" class="headerlink" title="Dockerfile的基本指令"></a>Dockerfile的基本指令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="comment"># 指定基础镜像（必须为第一个指令，因为需要指定使用哪个基础镜像来构建镜像）；</span></span><br><span class="line"></span><br><span class="line">MAINTAINER <span class="comment"># 设置镜像作者相关信息，如作者名字，日期，邮件，联系方式等；</span></span><br><span class="line"></span><br><span class="line">COPY <span class="comment"># 复制文件到镜像；</span></span><br><span class="line"></span><br><span class="line">ADD <span class="comment"># 复制文件到镜像（ADD与COPY的区别在于，ADD会自动解压tar、zip、tgz、xz等归档文件，而COPY不会，同时ADD指令还可以接一个url下载文件地址，一般建议使用COPY复制文件即可，文件在宿主机上是什么样子复制到镜像里面就是什么样子这样比较好）；</span></span><br><span class="line"></span><br><span class="line">ENV <span class="comment"># 设置环境变量；</span></span><br><span class="line"></span><br><span class="line">EXPOSE <span class="comment"># 暴露容器进程的端口，仅仅是提示别人容器使用的哪个端口，没有过多作用；</span></span><br><span class="line"></span><br><span class="line">VOLUME <span class="comment"># 数据卷持久化，挂载一个目录；</span></span><br><span class="line"></span><br><span class="line">WORKDIR <span class="comment"># 设置工作目录，如果目录不在，则会自动创建目录；</span></span><br><span class="line"></span><br><span class="line">RUN <span class="comment"># 在容器中运行命令，RUN指令会创建新的镜像层，RUN指令经常被用于安装软件包；</span></span><br><span class="line"></span><br><span class="line">CMD <span class="comment"># 指定容器启动时默认运行哪些命令，如果有多个CMD，则只有最后一个生效，另外，CMD指令可以被docker run之后的参数替换；</span></span><br><span class="line"></span><br><span class="line">ENTRYOINT <span class="comment"># 指定容器启动时运行哪些命令，如果有多个ENTRYOINT，则只有最后一个生效，另外，如果Dockerfile中同时存在CMD和ENTRYOINT，那么CMD或docker run之后的参数将被当做参数传递给ENTRYOINT；</span></span><br></pre></td></tr></table></figure>

<h2 id="进入容器命令"><a href="#进入容器命令" class="headerlink" title="进入容器命令"></a>进入容器命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 容器生命周期管理</span></span><br><span class="line"><span class="comment"># 搜索镜像</span></span><br><span class="line">docker search centos</span><br><span class="line"><span class="comment"># 查看镜像层级关系</span></span><br><span class="line">docker images --tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器状态</span></span><br><span class="line">docker ps -a                <span class="comment"># 列出所有容器 (包含停止状态)</span></span><br><span class="line">docker ps                   <span class="comment"># 仅列出运行中的容器</span></span><br><span class="line">docker inspect my_nginx     <span class="comment"># 查看容器详细信息</span></span><br><span class="line">docker logs my_nginx        <span class="comment"># 查看容器日志输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并运行容器</span></span><br><span class="line">docker run -d --name my_nginx -p 8080:80 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">### 启动、停止、重启容器</span></span><br><span class="line">docker start my_nginx       <span class="comment"># 启动已存在但停止的容器</span></span><br><span class="line">docker start $(docker ps -aq) <span class="comment"># 启动所有容器</span></span><br><span class="line">docker stop my_nginx        <span class="comment"># 停止正在运行的容器</span></span><br><span class="line">docker restart my_nginx     <span class="comment"># 重启容器 (相当于 stop + start)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即强制停止容器</span></span><br><span class="line">docker <span class="built_in">kill</span> my_nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">### 删除容器</span></span><br><span class="line">docker <span class="built_in">rm</span> my_nginx          <span class="comment"># 删除的容器</span></span><br><span class="line">docker <span class="built_in">rm</span> -f my_nginx       <span class="comment"># 强制删除运行中的容器 (相当于 kill + rm)</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -q -f status=exited) <span class="comment"># 删除所有已退出的容器</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -a -q)  <span class="comment"># 删除所有已停止的容器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有正在运行和已停止的容器</span></span><br><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -aq)  <span class="comment"># 删除所有容器 (小心使用)</span></span><br><span class="line">docker rmi $(docker images -q) <span class="comment"># 删除所有镜像</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Docker 资源清理</span></span><br><span class="line">docker container prune	<span class="comment"># 删除所有退出状态的容器</span></span><br><span class="line">docker image prune			<span class="comment"># 删除 dangling 或所有未被使用的镜像</span></span><br><span class="line">docker network prune		<span class="comment"># 删除所有未使用的网络</span></span><br><span class="line">docker volume prune			<span class="comment"># 删除未被使用的数据卷</span></span><br><span class="line">docker system prune			<span class="comment"># 删除已停止的容器、dangling 镜像、未被容器引用的 network 和构建过程中的 cache，安全起见，这个命令默认不会删除那些未被任何容器引用的数据卷，如果需要同时删除这些数据卷，你需要显式的指定 --volumns 参数</span></span><br><span class="line">docker system prune --all --force --volumns 	<span class="comment"># 这次不仅会删除数据卷，而且连确认的过程都没有了！注意，使用 --all 参数后会删除所有未被引用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂停与恢复容器</span></span><br><span class="line">docker pause my_nginx       <span class="comment"># 暂停容器中的所有进程</span></span><br><span class="line">docker unpause my_nginx     <span class="comment"># 恢复被暂停的容器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 进入容器 </span></span><br><span class="line"><span class="comment"># attach  命令是attach到容器启动命令的终端</span></span><br><span class="line">docker attach my_nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># exec  是另外在容器里面启动一个TTY终端</span></span><br><span class="line">docker <span class="built_in">exec</span> -it my_nginx /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以执行单次命令，而不进入交互模式</span></span><br><span class="line">docker <span class="built_in">exec</span> my_nginx <span class="built_in">ls</span> /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件传输</span></span><br><span class="line">docker <span class="built_in">cp</span> [本地文件路径] [ID全称]:[容器路径]</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">docker <span class="built_in">cp</span> [ID全称]:[容器文件路径] [本地路径]</span><br><span class="line"></span><br><span class="line"><span class="comment">### 后台运行docker</span></span><br><span class="line">docker run -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="导出导入镜像"><a href="#导出导入镜像" class="headerlink" title="导出导入镜像"></a>导出导入镜像</h5><p>export\import 与 save\load 的区别：</p>
<ul>
<li><p>export\import 导出的镜像文件大小要小于 save\load 导出的镜像</p>
</li>
<li><p>export\import 是根据容器拿到的镜像，再导入时会丢失镜像所有的历史，所以无法进行回滚操作；而 save\load 的镜像，没有丢失镜像的历史，可以回滚到之前的层。</p>
</li>
</ul>
<p>核心原因是 export 是针对容器的导出，所以只有所有层组合的最终版本；而 save 则是针对镜像的，所以可以看到每一层的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 导出导入镜像</span></span><br><span class="line"><span class="comment"># export\import 导入导出</span></span><br><span class="line">docker <span class="built_in">export</span> web &gt; /home/docker_web.tar</span><br><span class="line">docker import /home/docker_web.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># save\load 导入导出</span></span><br><span class="line">docker save 9610cfc68e8d &gt; /home/docker_web.tar</span><br><span class="line">docker load &lt; /home/docker_web.tar</span><br></pre></td></tr></table></figure>

<h5 id="修改正在运行的容器端口映射"><a href="#修改正在运行的容器端口映射" class="headerlink" title="修改正在运行的容器端口映射"></a>修改正在运行的容器端口映射</h5><ol>
<li>停止容器</li>
<li>停止 docker 服务(systemctl stop docker)</li>
<li>修改这个容器的 hostconfig.json 文件中的端口（原帖有人提到，如果 config.v2.json 里面也记录了端口，也要修改）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/docker/3b6ef264a040* 	<span class="comment"># 这里是 CONTAINER ID</span></span><br><span class="line"></span><br><span class="line">vi hostconfig.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果之前没有端口映射, 应该有这样的一段:</span></span><br><span class="line"><span class="string">&quot;PortBindings&quot;</span>:&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个映射, 这样写:</span></span><br><span class="line"><span class="string">&quot;PortBindings&quot;</span>:&#123;<span class="string">&quot;3306/tcp&quot;</span>:[&#123;<span class="string">&quot;HostIp&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;HostPort&quot;</span>:<span class="string">&quot;3307&quot;</span>&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前一个数字是容器端口, 后一个是宿主机端口</span></span><br><span class="line"><span class="comment"># 而修改现有端口映射更简单, 把端口号改掉就行</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>启动docker服务(systemctl start docker)</li>
<li>启动容器</li>
</ol>
<h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h1><ul>
<li>192网段</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    network_mode: bridge</span><br><span class="line">    IP: 192.168.1.100</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  my-network:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.1.0/24</span><br><span class="line"></span><br><span class="line">$ docker-compose up --net=my-network</span><br></pre></td></tr></table></figure>

<h2 id="Dockerfile-更新-重构"><a href="#Dockerfile-更新-重构" class="headerlink" title="Dockerfile 更新&#x2F;重构"></a>Dockerfile 更新&#x2F;重构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build php84</span><br></pre></td></tr></table></figure>

<h1 id="docker外部调用"><a href="#docker外部调用" class="headerlink" title="docker外部调用"></a>docker外部调用</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -v $(<span class="built_in">pwd</span>):/app/backend -w /app/backend dnmp-php82 composer dump-autoload</span><br></pre></td></tr></table></figure>

<h3 id="命令作用"><a href="#命令作用" class="headerlink" title="命令作用"></a><strong>命令作用</strong></h3><p>在 <code>dnmp-php82</code> 容器中运行 <code>composer dump-autoload</code>，并将当前目录挂载到 <code>/app/backend</code>，优化 PHP 自动加载。</p>
<hr>
<h3 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a><strong>参数解析</strong></h3><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker run</code></td>
<td>启动一个新的 Docker 容器</td>
</tr>
<tr>
<td><code>--rm</code></td>
<td>容器执行完成后自动删除（不会保留实例）</td>
</tr>
<tr>
<td><code>-v $(pwd):/app/backend</code></td>
<td><strong>挂载当前目录</strong> 到容器 <code>/app/backend</code>，让容器能访问本地代码</td>
</tr>
<tr>
<td><code>-w /app/backend</code></td>
<td><strong>设置工作目录</strong>，让 <code>composer dump-autoload</code> 在 <code>/app/backend</code> 目录执行</td>
</tr>
<tr>
<td><code>dnmp-php82</code></td>
<td><strong>Docker 镜像名称</strong>，用于运行 PHP 和 Composer</td>
</tr>
<tr>
<td><code>composer dump-autoload</code></td>
<td><strong>重新生成 Composer 自动加载文件</strong>，提高 PHP 代码加载效率</td>
</tr>
</tbody></table>
<h2 id="Docker容器时间与宿主机不一致"><a href="#Docker容器时间与宿主机不一致" class="headerlink" title="Docker容器时间与宿主机不一致"></a>Docker容器时间与宿主机不一致</h2><h3 id="方法一：初始化容器时，容器时间与宿主机同步，docker-run-添加时间参数"><a href="#方法一：初始化容器时，容器时间与宿主机同步，docker-run-添加时间参数" class="headerlink" title="方法一：初始化容器时，容器时间与宿主机同步，docker run 添加时间参数"></a>方法一：初始化容器时，容器时间与宿主机同步，docker run 添加时间参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker  run -itd --privileged=<span class="literal">true</span> -v /etc/localtime:/etc/localtime:ro</span><br></pre></td></tr></table></figure>

<h3 id="方法二：Dockerfile解决方案"><a href="#方法二：Dockerfile解决方案" class="headerlink" title="方法二：Dockerfile解决方案"></a>方法二：Dockerfile解决方案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1</span></span><br><span class="line"><span class="comment"># 添加时区环境变量，亚洲，上海</span></span><br><span class="line">ENV TimeZone=Asia/Shanghai</span><br><span class="line"><span class="comment"># 使用软连接，并且将时区配置覆盖/etc/timezone</span></span><br><span class="line">RUN <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TimeZone</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TimeZone</span> &gt; /etc/timezone</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 方法2</span></span><br><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&quot;Asia/shanghai&quot;</span> &gt; /etc/timezone</span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">RUN <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<h3 id="方法三：docker-compose解决方案"><a href="#方法三：docker-compose解决方案" class="headerlink" title="方法三：docker-compose解决方案"></a>方法三：docker-compose解决方案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一种方式(推荐)：</span></span><br><span class="line">environment:</span><br><span class="line">  TZ: Asia/Shanghai</span><br><span class="line">  </span><br><span class="line"><span class="comment">#第二种方式：</span></span><br><span class="line">environment:</span><br><span class="line">  SET_CONTAINER_TIMEZONE=<span class="literal">true</span></span><br><span class="line">  CONTAINER_TIMEZONE=Asia/Shanghai</span><br><span class="line">  </span><br><span class="line"><span class="comment">#第三种方式：</span></span><br><span class="line">volumes:</span><br><span class="line">  - /etc/timezone:/etc/timezone</span><br><span class="line">  - /etc/localtime:/etc/localtime</span><br></pre></td></tr></table></figure>

<h3 id="方法四：正在运行的容器，可以宿主机直接执行命令给某个容器同步时间"><a href="#方法四：正在运行的容器，可以宿主机直接执行命令给某个容器同步时间" class="headerlink" title="方法四：正在运行的容器，可以宿主机直接执行命令给某个容器同步时间"></a>方法四：正在运行的容器，可以宿主机直接执行命令给某个容器同步时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1  直接在宿主机操作</span></span><br><span class="line">docker <span class="built_in">cp</span> /etc/localtime 【容器ID或者NAME】:/etc/localtime</span><br><span class="line">docker <span class="built_in">cp</span> -L /usr/share/zoneinfo/Asia/Shanghai 【容器ID或者NAME】:/etc/localtime</span><br><span class="line">  </span><br><span class="line"><span class="comment">#方法2  登录容器同步时区timezone，一般是因为时区不同导致时间差</span></span><br><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Singapore /etc/localtime</span><br></pre></td></tr></table></figure>

<h1 id="Docker逃逸"><a href="#Docker逃逸" class="headerlink" title="Docker逃逸"></a>Docker逃逸</h1><ul>
<li><p>容器镜像存在的风险</p>
</li>
<li><p>活动中的容器存在的风险</p>
<ul>
<li><p>不安全的容器应用</p>
</li>
<li><p>不受限制的资源共享</p>
</li>
<li><p>不安全的配置与挂载</p>
<p>如果为容器设定了不安全的配置，会导致容器本身的隔离机制失效，容器的两大隔离机制如下：</p>
<ul>
<li>Linux 命名空间（NameSpace）：实现文件系统、网络、进程、主机名等方面的隔离</li>
<li>Linux 控制组（cgroups）：实现 CPU、内存、硬盘等方面的隔离</li>
</ul>
<p>如果设定了以下配置就会导致相应的隔离机制失效：</p>
<ul>
<li>–privileged：使容器内的 root 权限和宿主机上的 root 权限一致，权限隔离被打破</li>
<li>–net&#x3D;host：使容器与宿主机处于同一网络命名空间，网络隔离被打破</li>
<li>–pid&#x3D;host：使容器与宿主机处于同一进程命令空间，进程隔离被打破</li>
<li>–volume &#x2F;:&#x2F;host：宿主机根目录被挂载到容器内部，文件系统隔离被打破</li>
</ul>
</li>
</ul>
</li>
<li><p>容器管理程序接口的风险</p>
<p>Docker 守护进程主要监听 UNIX socket 和 TCP socket，默认情况下，Docker 只会监听 UNIX socket</p>
<ul>
<li><p>UNIX socket<br>UNIX socket 的风险主要在于 Docker 守护进程默认以宿主机的 root 权限运行，因此就可以借助这点进行提权或者容器逃逸。<br>这类风险主要有两个利用场景：</p>
<p>  普通用户被加到 Docker 用户组内<br>  如果普通用户被加入到 Docker 用户组内，那么普通用户也将有权限访问 Docker UNIX socket，如果攻击者获得了这个普通用户权限，就可以借助 Docker 提权到 root 用户权限。</p>
<p>  具体的做法可以简单描述为：使用普通用户创建一个 privileged 为 true 的容器，在该容器内挂载宿主机硬盘并写入定时任务，然后将宿主机的 root 权限反弹回来，后期将详细介绍这种方法的使用。</p>
<p>  UNIX socket 挂载到容器内部<br>  有时为了实现容器内部管理容器，可能会将 Docker UNIX socket 挂载到容器内部，那么如果该容器被入侵，RT 就可以借助这个 socket 进行容器逃逸获得宿主机 root 权限。</p>
</li>
<li><p>TCP socket<br>现在 Docker 守护进程默认不会监听 TCP socket，不过有时可能用户会因为方便开启 TCP socket 的监听，一般默认监听端口是 2375</p>
<p>默认情况下，Docker 守护进程 TCP socket 是无加密无认证的，因此如果发现宿主机 Docker 开放了 TCP socket，就可以直接使用 docker -H 接管目标的容器</p>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://wiki.teamssix.com/cloudnative/docker/cve-2022-0847-dirty-pipe.html">docker 逃逸</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/drink/">
                调饮
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/新/">新</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>奶茶 &#x3D; 小轻甘-甘菊金银花露-椰泰 + 雀巢咖啡-丝滑拿铁<br>清爽奶茶 &#x3D; 加多宝凉茶 + 雀巢咖啡-丝滑拿铁<br>阿萨姆（清爽奶茶 茉莉味） &#x3D; 茉莉蜜茶 + 纯牛奶<br>龟苓膏 &#x3D; 加多宝凉茶 + 纯牛奶<br>果冻 &#x3D; 加多宝凉茶 + 优酸乳<br>难以言喻味道 &#x3D; 海之言 电解质饮料 +  雀巢咖啡-焦糖风味拿铁<br>清爽酸甜汁（清香） &#x3D; 茉莉清茶 + 红牛</p>
<h1 id="定律"><a href="#定律" class="headerlink" title="定律"></a>定律</h1><p>气泡水 + 白酒&#x2F;红酒（高度数）：挥发酒精<br>果汁 + 茶饮<br>凉茶 + 纯牛奶</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/11/27/elasticsearch/">
                Elasticsearch
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/数据库/">数据库</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#%E5%9F%BA%E7%A1%80">基础</a></li>
</ul>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 列出所有索引</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:9200/_cat/indices?v&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 只看索引名字</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:9200/_cat/indices?h=index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 结合管道符 查询 为 XXX 的关键字</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:9200/_cat/indices?v&quot;</span> | grep XXX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除一个index （XXX）</span></span><br><span class="line">curl -X DELETE <span class="string">&quot;http://localhost:9200/XXX&quot;</span></span><br></pre></td></tr></table></figure>


        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/page/5/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/7/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    Respect All Fear None. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2025/11/27/vue2vsvue3/">vue2 对比 vue3</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/vue-big-file-upload/">vue2 大文件上传component(做成组件)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/wireshark/">Wireshark</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/xss/">XSS跨站脚本攻击</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/%E5%88%9B%E4%B8%9A/">创业</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Blog/">Blog</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E7%9F%A5/">知</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @4ck. All right reserved | Design & Hexo 0rz33
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Searching -->
<!-- <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> -->

<script src="/js/search.js"></script>


<!-- Mermaid -->
<script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
<script>
  if (window.mermaid) {
    mermaid.initialize({theme: 'dark'});
  }
</script>

<!-- Disqus Comments -->



</body>

</html>