<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="4ckU">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="0rz33"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="0rz33"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>page - 0rz33</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Searching-->
<div class="search-bg">
    <div class="search-container">
            <div class="alpha-search">
                <form class="site-search-form">
                    <input type="text" id="local-search-input" class="st-search-input" />
                </form>
                <div id="local-search-result">
                </div>
            </div>
        </div>
    </div>
</div> 

<!--Hamburger Icon-->
<search>
    <a href="#search"></a>
</search>
<nav>
    <a href="#menu"></a>
</nav>

<!-- 执行本地搜索脚本 -->
<script>
    var inputArea = document.querySelector("#local-search-input");
    var getSearchFile = function(){
        var path = "/search.xml";
        searchFunc(path, 'local-search-input', 'local-search-result');
    }
    inputArea.onfocus = function(){ getSearchFile() }
    inputArea.onkeydown = function(){ if(event.keyCode==13) return false}
</script>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">0rz33</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/kali/">
                Kali
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/渗透/">渗透</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/420393.html">kali</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/kerberos/">
                Kerberos
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/知/">知</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903955416219661">引用-看完您如果还不明白 Kerberos 原理</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liugp/p/16468514.html">Kerberos认证原理与环境部署</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/lang-version/">
                各类版本控制管理
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/研发工具/">研发工具</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="语言版本控制管理"><a href="#语言版本控制管理" class="headerlink" title="语言版本控制管理"></a>语言版本控制管理</h2><h3 id="nodejs-nvm"><a href="#nodejs-nvm" class="headerlink" title="nodejs -&gt; nvm"></a>nodejs -&gt; nvm</h3><blockquote>
<p>提示前提：必须装nodejs</p>
</blockquote>
<h4 id="shell设置"><a href="#shell设置" class="headerlink" title="shell设置"></a>shell设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /opt/homebrew/opt/nvm/nvm.sh</span><br></pre></td></tr></table></figure>

<h4 id="一般命令"><a href="#一般命令" class="headerlink" title="一般命令"></a>一般命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nvm list available  <span class="comment"># Windows</span></span><br><span class="line">nvm ls-remote <span class="comment"># linux 显示所有可下载的版本</span></span><br><span class="line"></span><br><span class="line">nvm install 11.13.0 <span class="comment"># 安装11.13.0版本</span></span><br><span class="line"></span><br><span class="line">nvm use 11.13.0 <span class="comment"># 使用当前版本</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示！~查看npm包是否有了</p>
</blockquote>
<h3 id="python-pyenv"><a href="#python-pyenv" class="headerlink" title="python -&gt; pyenv"></a>python -&gt; pyenv</h3><blockquote>
<p>提示前提：必须装python</p>
</blockquote>
<h4 id="shell设置-1"><a href="#shell设置-1" class="headerlink" title="shell设置"></a>shell设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /opt/homebrew/opt/nvm/nvm.sh</span><br></pre></td></tr></table></figure>

<h4 id="一般命令-1"><a href="#一般命令-1" class="headerlink" title="一般命令"></a>一般命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pyenv version</span><br><span class="line">pyenv install --list  <span class="comment"># 查看版本</span></span><br><span class="line"></span><br><span class="line">pyenv install 3.11.0</span><br><span class="line"></span><br><span class="line">pyenv global 3.7.4 <span class="comment"># Python版本全局生效</span></span><br><span class="line"></span><br><span class="line">pyenv <span class="built_in">local</span> 3.7.4 <span class="comment"># 指定的目录下生效，那可以使用pyenv local命令修改</span></span><br></pre></td></tr></table></figure>

<h3 id="golang-gvm"><a href="#golang-gvm" class="headerlink" title="golang -&gt; gvm"></a>golang -&gt; gvm</h3><blockquote>
<p>提示前提：必须装golang</p>
</blockquote>
<h4 id="shell设置-2"><a href="#shell设置-2" class="headerlink" title="shell设置"></a>shell设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ -s <span class="string">&quot;<span class="variable">$HOME</span>/.gvm/scripts/gvm&quot;</span> ]] &amp;&amp; <span class="built_in">source</span> <span class="string">&quot;<span class="variable">$HOME</span>/.gvm/scripts/gvm&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="一般命令-2"><a href="#一般命令-2" class="headerlink" title="一般命令"></a>一般命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go version <span class="comment"># 版本</span></span><br><span class="line">gvm listall <span class="comment"># 查看版本</span></span><br><span class="line"></span><br><span class="line">gvm install go1.21.0 <span class="comment"># 安装1.21.0版本</span></span><br><span class="line"></span><br><span class="line">gvm use go1.21.0 --default <span class="comment"># 使用当前版本</span></span><br></pre></td></tr></table></figure>

<h3 id="java-IDEA-切换版本"><a href="#java-IDEA-切换版本" class="headerlink" title="java -&gt; IDEA (切换版本)"></a>java -&gt; IDEA (切换版本)</h3><h3 id="docker-版本管理-开发更方便"><a href="#docker-版本管理-开发更方便" class="headerlink" title="docker 版本管理 开发更方便"></a>docker 版本管理 开发更方便</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/0rz33/dnmp">php-多版本多项目管理-docker-composer</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http[s]://[你的域名]/72       <span class="comment"># PHP72</span></span><br><span class="line">http[s]://[你的域名]/73       <span class="comment"># PHP73</span></span><br><span class="line">http[s]://[你的域名]/74       <span class="comment"># PHP74</span></span><br><span class="line">http[s]://[你的域名]/80       <span class="comment"># PHP80</span></span><br><span class="line">http[s]://[你的域名]/81       <span class="comment"># PHP81</span></span><br><span class="line">http[s]://[你的域名]/82       <span class="comment"># PHP82</span></span><br><span class="line">http[s]://[你的域名]/83       <span class="comment"># PHP83</span></span><br><span class="line">http[s]://[你的域名]/84       <span class="comment"># PHP84</span></span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/language/">
                世界语言体系
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/语言/">语言</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <pre class="mermaid">flowchart LR
    A[世界七大语系]
    
    A --> B[汉藏语系]
    B --> B1[汉语]
    B1 --> B1B[北方方言]
    B1 --> B1C[吴方言]
    B1 --> B1D[湘方言]
    B1 --> B1E[赣方言]
    B1 --> B1F[客家]
    B1 --> B1G[闽北方言->福州]
    B1 --> B1H[闽南方言]
    B1 --> B1I[粤方言]
    B --> B2[藏缅语]
    B2 --> B2A[缅甸语]
    B2 --> B2B[泰语]
    B2 --> B2C[越南语]
    B2 --> B2D[柬埔寨语]

    A --> C[印欧语系]
    C --> C1[日耳曼语族]
    C1 --> C1A[英语]
    C1 --> C1B[德语]
    C1 --> C1C[荷兰语]
    C --> C2[罗曼语族]
    C2 --> C2A[法语]
    C2 --> C2B[西班牙语]
    C2 --> C2C[意大利语]
    C --> C3[斯拉夫语族]
    C3 --> C3A[俄语]
    C3 --> C3B[波兰语]
    C3 --> C3C[捷克语]
    C --> C4[印度-伊朗语族]
    C4 --> C4A[印地语]
    C4 --> C4B[波斯语]

    A --> D[阿尔泰语系]
    D --> D1[突厥语族]
    D1 --> D1A[土耳其语]
    D --> D2[蒙古语族]
    D2 --> D2A[蒙古语]
    D --> D3[满-通古斯语族]
    D3 --> D3A[满语]

    A --> E[闪含语系]
    E --> E1[阿拉伯语]
    E --> E2[希伯来语]

    A --> F[南岛语系]
    F --> F1[马来语]
    F --> F2[印度尼西亚语]
    F --> F3[他加禄语]
    F3 --> F3A[比萨亚]

    A --> G[尼日尔-科尔多凡语系]
    G --> G1[斯瓦希里语]
    G --> G2[约鲁巴语]

    A --> H[达罗毗荼语系]
    H --> H1[泰米尔语]
    H --> H2[泰卢固语]</pre>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/linux-emergency-response/">
                Linux应急响应
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/Linux/">Linux</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#1">入侵排查思路</a><ul>
<li><a href="#1.1">账号安全</a></li>
<li><a href="#1.2">历史命令</a></li>
<li><a href="#1.3">检查异常端口</a></li>
<li><a href="#1.4">检查异常进程</a></li>
<li><a href="#1.5">检查开机启动项</a></li>
<li><a href="#1.6">检查定时任务</a></li>
<li><a href="#1.7">检查服务</a></li>
<li><a href="#1.8">检查异常文件</a></li>
<li><a href="#1.9">检查系统日志</a></li>
</ul>
</li>
<li><a href="#2">工具</a><ul>
<li><a href="#2.1">Rootkit查杀</a></li>
<li><a href="#2.2">病毒查杀</a></li>
<li><a href="#2.3">webshell查杀</a></li>
<li><a href="#2.4">RPM check检查</a></li>
<li><a href="#2.5">linux安全检查脚本</a></li>
</ul>
</li>
<li><a href="#3">常见网络安全攻击特征</a></li>
<li><a href="#4">Linux数据传输</a></li>
</ul>
<h3 id="1">入侵排查思路</h3>

<ol>
<li><p>了解清楚事件发生时间点、事件有什么特征、服务器的用途、服务器上部署的应用组件、已做过那些应急措施，禁忌上来就一顿操作；</p>
</li>
<li><p>大概思考下能沾边的网络攻击特征，同时根据服务器版本以及服务器上部署的组件看看近期是否有nday漏洞，有时匹配上了可以节约一大部分时间；</p>
</li>
<li><p>根据已部署的安全设备，快速看看异常事件以及已攻击成功的事件；</p>
</li>
<li><p>上机排查，使用busybox套装防止发生预期以外的情况，使用磁盘备份（dd）进行整个备份，或手工备份日志以及一些易被覆盖的系统文件，如：.viminfo、history，使用LiME（Linux Memory Extractor）备份服务器内存，或者使用手工追加将进程、网络连接状态等进行备份，（虚拟化&#x2F;云环境可直接拍摄快照）；</p>
</li>
<li><p>根据前期了解的情况、事件特征进行排查，若排查到有一定的特征的异常文件或者进程时，可先到网上找找有没有相似案例，可以节约很多时间。</p>
</li>
</ol>
<h4 id="1.1">账号安全</h4>

<ul>
<li>基本使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、用户信息文件</span></span><br><span class="line">/etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">account:password:UID:GID:GECOS:directory:shell</span><br><span class="line"><span class="comment"># 用户名：密码：用户ID：组ID：用户说明：家目录：登陆之后shell</span></span><br><span class="line"><span class="comment">## 注意：无密码只允许本机登陆，远程不允许登陆</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、影子文件</span></span><br><span class="line">/etc/shadow</span><br><span class="line">root:$6$oGs1PqhL2p3ZetrE<span class="variable">$X7o7bzoouHQVSEmSgsYN5UD4</span>.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br><span class="line"><span class="comment">#用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之后的宽限天数：账号失效时间：保留</span></span><br><span class="line"><span class="comment"># who     查看当前登录用户（tty本地登陆  pts远程登录）</span></span><br><span class="line"><span class="comment"># w       查看系统信息，想知道某一时刻用户的行为</span></span><br><span class="line"><span class="comment"># uptime  查看登陆多久、多少用户，负载</span></span><br></pre></td></tr></table></figure>
<ul>
<li>入侵排查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、查询特权用户特权用户(uid 为0)</span></span><br><span class="line">awk -F: <span class="string">&#x27;$3==0&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、查询可以远程登录的帐号信息</span></span><br><span class="line">awk <span class="string">&#x27;/\$1|\$6/&#123;print $1&#125;&#x27;</span> /etc/shadow</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、除root帐号外，其他帐号是否存在sudo权限。如非管理需要，普通帐号应删除sudo权限</span></span><br><span class="line">more /etc/sudoers | grep -v <span class="string">&quot;^#\|^$&quot;</span> | grep <span class="string">&quot;ALL=(ALL)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、禁用或删除多余及可疑的帐号</span></span><br><span class="line">usermod -L user    <span class="comment"># 禁用帐号，帐号无法登录，/etc/shadow第二栏为!开头</span></span><br><span class="line">userdel user       <span class="comment"># 删除user用户</span></span><br><span class="line">userdel -r user    <span class="comment"># 将删除user用户，并且将/home目录下的user目录一并删除</span></span><br></pre></td></tr></table></figure>


<h4 id="1.2">历史命令</h4>

<ul>
<li>基本使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过.bash_history查看帐号执行过的系统命令</span></span><br><span class="line"><span class="comment"># 1、root的历史命令</span></span><br><span class="line">histroy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、打开/home各帐号目录下的.bash_history，查看普通帐号的历史命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为历史的命令增加登录的IP地址、执行命令时间等信息：</span></span><br><span class="line"><span class="comment">## 1）保存1万条命令</span></span><br><span class="line">sed -i <span class="string">&#x27;s/^HISTSIZE=1000/HISTSIZE=10000/g&#x27;</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2）在/etc/profile的文件尾部添加如下行数配置信息：</span></span><br><span class="line"><span class="comment">######jiagu history xianshi#########</span></span><br><span class="line">USER_IP=`<span class="built_in">who</span> -u am i 2&gt;/dev/null | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | sed -e <span class="string">&#x27;s/[()]//g&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$USER_IP</span>&quot;</span> = <span class="string">&quot;&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">USER_IP=`hostname`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">&quot;%F %T <span class="variable">$USER_IP</span> `whoami` &quot;</span></span><br><span class="line"><span class="built_in">shopt</span> -s histappend</span><br><span class="line"><span class="built_in">export</span> PROMPT_COMMAND=<span class="string">&quot;history -a&quot;</span></span><br><span class="line"><span class="comment">######### jiagu history xianshi ##########</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3）让配置生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成效果： </span></span><br><span class="line">1  2018-07-10 19:45:39 192.168.204.1 root <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、历史操作命令的清除：</span></span><br><span class="line"><span class="built_in">history</span> -c</span><br><span class="line"><span class="comment">## 但此命令并不会清除保存在文件中的记录，因此需要手动删除.bash_profile文件中的记录。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>入侵排查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入用户目录下</span></span><br><span class="line"><span class="built_in">cat</span> .bash_history &gt;&gt; history.txt</span><br></pre></td></tr></table></figure>

<h4 id="1.3">检查异常端口</h4>

<p>使用netstat 网络连接命令，分析可疑端口、IP、PID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp|more</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看下pid所对应的进程文件路径，</span></span><br><span class="line"><span class="built_in">ls</span> -l /proc/<span class="variable">$PID</span>/exe或file /proc/<span class="variable">$PID</span>/exe（<span class="variable">$PID</span> 为对应的pid 号）</span><br></pre></td></tr></table></figure>

<h4 id="1.4">检查异常进程</h4>

<p>使用ps命令，分析进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pid</span><br></pre></td></tr></table></figure>

<h4 id="1.5">检查开机启动项</h4>

<ul>
<li>基本使用<br>系统运行级别示意图：</li>
</ul>
<table>
<thead>
<tr>
<th>运行级别</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>关机</td>
</tr>
<tr>
<td>1</td>
<td>单用户模式，可以想象为windows的安全模式，主要用于系统修复</td>
</tr>
<tr>
<td>2</td>
<td>不完全的命令行模式，不含NFS服务</td>
</tr>
<tr>
<td>3</td>
<td>完全的命令行模式，就是标准字符界面</td>
</tr>
<tr>
<td>4</td>
<td>系统保留</td>
</tr>
<tr>
<td>5</td>
<td>图形模式</td>
</tr>
<tr>
<td>6</td>
<td>重启动</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看运行级别命令 </span></span><br><span class="line">runlevel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统默认允许级别</span></span><br><span class="line"></span><br><span class="line">vi  /etc/inittab</span><br><span class="line"><span class="built_in">id</span>=3：initdefault  <span class="comment"># 系统开机后直接进入哪个运行级别</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机启动配置文件</span></span><br><span class="line">/etc/rc.local</span><br><span class="line">/etc/rc.d/rc[0~6].d</span><br><span class="line"><span class="comment"># 例子:当我们需要开机启动自己的脚本时，只需要将可执行脚本丢在/etc/init.d目录下，然后在/etc/rc.d/rc*.d中建立软链接即可</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">ln</span> -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</span><br><span class="line"><span class="comment"># 此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行级别加载时需要关闭的。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>入侵排查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动项文件 </span></span><br><span class="line">more /etc/rc.local /etc/rc.d/rc[0~6].d <span class="built_in">ls</span> -l /etc/rc.d/rc3.d/</span><br></pre></td></tr></table></figure>
<h4 id="1.6">检查定时任务</h4>

<ul>
<li>基本使用</li>
</ul>
<h5 id="1-利用crontab创建计划任务"><a href="#1-利用crontab创建计划任务" class="headerlink" title="1. 利用crontab创建计划任务"></a>1. 利用crontab创建计划任务</h5><h6 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">crontab -l <span class="comment"># 列出某个用户cron服务的详细内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/root</span></span><br><span class="line"></span><br><span class="line">crontab -r <span class="comment"># 删除每个用户cront任务(谨慎：删除所有的计划任务)</span></span><br><span class="line"></span><br><span class="line">crontab -e <span class="comment"># 使用编辑器编辑当前的crontab文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 如：</span></span><br><span class="line">/1 * <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt;&gt; /tmp/test.txt 每分钟写入文件</span><br></pre></td></tr></table></figure>

<h5 id="2-利用anacron实现异步定时任务调度"><a href="#2-利用anacron实现异步定时任务调度" class="headerlink" title="2. 利用anacron实现异步定时任务调度"></a>2. 利用anacron实现异步定时任务调度</h5><h6 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 每天运行 /home/backup.sh脚本： </span></span><br><span class="line">vi /etc/anacrontab @daily 10 example.daily /bin/bash /home/backup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当机器在 backup.sh 期望被运行时是关机的，anacron会在机器开机十分钟之后运行它，而不用再等待 7天。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>入侵排查</li>
</ul>
<p>重点关注以下目录中是否存在恶意脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/* </span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.d/*</span><br><span class="line">/etc/cron.daily/* </span><br><span class="line">/etc/cron.hourly/* </span><br><span class="line">/etc/cron.monthly/*</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/anacrontab</span><br><span class="line">/var/spool/anacron/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小技巧：</span></span><br><span class="line">more /etc/cron.daily/*  <span class="comment"># 查看目录下所有文件</span></span><br></pre></td></tr></table></figure>

<h4 id="1.7">检查服务</h4>

<ul>
<li>服务自启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种修改方法：</span></span><br><span class="line">chkconfig [--level 运行级别] [独立服务名] [on|off]</span><br><span class="line">chkconfig –level  2345 httpd on  开启自启动</span><br><span class="line">chkconfig httpd on （默认level是2345）</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二种修改方法：</span></span><br><span class="line">修改/etc/re.d/rc.local 文件  </span><br><span class="line">加入 /etc/init.d/httpd start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三种修改方法：</span></span><br><span class="line"><span class="comment"># 使用ntsysv命令管理自启动，可以管理独立服务和xinetd服务。</span></span><br><span class="line">ntsysv</span><br></pre></td></tr></table></figure>
<ul>
<li>入侵排查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1、查询已安装的服务：</span></span><br><span class="line"><span class="comment"># RPM包安装的服务</span></span><br><span class="line">chkconfig  --list  <span class="comment"># 查看服务自启动状态，可以看到所有的RPM包安装的服务</span></span><br><span class="line">ps aux | grep crond <span class="comment"># 查看当前服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统在3与5级别下的启动项 </span></span><br><span class="line"><span class="comment">## 中文环境</span></span><br><span class="line">chkconfig --list | grep <span class="string">&quot;3:启用\|5:启用&quot;</span></span><br><span class="line"><span class="comment">## 英文环境</span></span><br><span class="line">chkconfig --list | grep <span class="string">&quot;3:on\|5:on&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 源码包安装的服务</span></span><br><span class="line"><span class="comment"># 查看服务安装位置</span></span><br><span class="line">/user/local/</span><br><span class="line"></span><br><span class="line">service httpd start</span><br><span class="line"><span class="comment"># 搜索/etc/rc.d/init.d/  查看是否存在</span></span><br></pre></td></tr></table></figure>

<h4 id="1.8">检查异常文件</h4>

<ol>
<li>查看敏感目录，如&#x2F;tmp目录下的文件，同时注意隐藏文件夹，以“..”为名的文件夹具有隐藏属性</li>
<li>得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？<br> 可以使用find命令来查找，如 <code>find /opt -iname &quot;*&quot; -atime 1 -type f </code>找出 &#x2F;opt 下一天前访问过的文件</li>
<li>针对可疑文件可以使用stat进行创建修改时间。</li>
</ol>
<h4 id="1.9">检查系统日志</h4>

<p>日志默认存放位置：&#x2F;var&#x2F;log&#x2F;</p>
<p>查看日志配置情况：more &#x2F;etc&#x2F;rsyslog.conf</p>
<table>
<thead>
<tr>
<th>日志文件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;var&#x2F;log&#x2F;cron</td>
<td>记录了系统定时任务相关的日志</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;cups</td>
<td>记录打印信息的日志</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;dmesg</td>
<td>记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;mailog</td>
<td>记录邮件信息</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;message</td>
<td>记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;btmp</td>
<td>记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;lastlog</td>
<td>记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;wtmp</td>
<td>永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;utmp</td>
<td>记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;secure</td>
<td>记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td>
</tr>
</tbody></table>
<p>日志分析技巧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、定位有多少IP在爆破主机的root帐号：    </span></span><br><span class="line">grep <span class="string">&quot;Failed password for root&quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定位有哪些IP在爆破：</span></span><br><span class="line">grep <span class="string">&quot;Failed password&quot;</span> /var/log/secure|grep -E -o <span class="string">&quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;</span>|<span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破用户名字典是什么？</span></span><br><span class="line"> grep <span class="string">&quot;Failed password&quot;</span> /var/log/secure|perl -e <span class="string">&#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print &quot;$1\n&quot;;&#125;&#x27;</span>|<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、登录成功的IP有哪些：     </span></span><br><span class="line">grep <span class="string">&quot;Accepted &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录成功的日期、用户名、IP：</span></span><br><span class="line">grep <span class="string">&quot;Accepted &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、增加一个用户kali日志：</span></span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali</span><br><span class="line">, shell=/bin/bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed <span class="keyword">for</span> kali</span><br><span class="line"><span class="comment">#grep &quot;useradd&quot; /var/log/secure </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、删除用户kali日志：</span></span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user <span class="string">&#x27;kali&#x27;</span></span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group <span class="string">&#x27;kali&#x27;</span> owned by <span class="string">&#x27;kali&#x27;</span></span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group <span class="string">&#x27;kali&#x27;</span> owned by <span class="string">&#x27;kali&#x27;</span></span><br><span class="line"><span class="comment"># grep &quot;userdel&quot; /var/log/secure</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、su切换用户：</span></span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened <span class="keyword">for</span> user good by root(uid=0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo授权执行:</span></span><br><span class="line"><span class="built_in">sudo</span> -l</span><br><span class="line">Jul 10 00:43:09 localhost <span class="built_in">sudo</span>:    good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now</span><br></pre></td></tr></table></figure>

<p>软件包管理器log：</p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>格式</th>
<th>工具</th>
</tr>
</thead>
<tbody><tr>
<td>Debian</td>
<td>.deb</td>
<td>apt, apt-cache, apt-get, dpkg</td>
</tr>
<tr>
<td>Ubuntu</td>
<td>.deb</td>
<td>apt, apt-cache, apt-get, dpkg</td>
</tr>
<tr>
<td>CentOS</td>
<td>.rpm</td>
<td>yum</td>
</tr>
<tr>
<td>Fedora</td>
<td>.rpm</td>
<td>dnf</td>
</tr>
<tr>
<td>FreeBSD</td>
<td>Ports, .txz</td>
<td>make, pkg</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 软件安装升级卸载日志：</span></span><br><span class="line">~~~yum install gcc yum install gcc</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">more /var/log/yum.log</span><br></pre></td></tr></table></figure>

<h3 id="2">工具</h3>
<h4 id="2.1">Rootkit查杀</h4>

<ul>
<li><a target="_blank" rel="noopener" href="http://www.chkrootkit.org/">chkrootkit</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用方法：</span></span><br><span class="line">wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz</span><br><span class="line">tar zxvf chkrootkit.tar.gz</span><br><span class="line"><span class="built_in">cd</span> chkrootkit-0.52</span><br><span class="line">make sense</span><br><span class="line"><span class="comment">#编译完成没有报错的话执行检查</span></span><br><span class="line">./chkrootkit</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="http://rkhunter.sourceforge.net/">rkhunter</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用方法：</span></span><br><span class="line">Wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gz</span><br><span class="line">tar -zxvf rkhunter-1.4.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> rkhunter-1.4.4</span><br><span class="line">./installer.sh --install</span><br><span class="line">rkhunter -c</span><br></pre></td></tr></table></figure>

<h4 id="2.2">病毒查杀</h4>

<p><a target="_blank" rel="noopener" href="http://www.clamav.net/download.html">Clamav</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装方式一：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、安装zlib：</span></span><br><span class="line">wget http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz </span><br><span class="line">tar -zxvf  zlib-1.2.7.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zlib-1.2.7</span><br><span class="line"><span class="comment">#安装一下gcc编译环境： yum install gcc</span></span><br><span class="line">CFLAGS=<span class="string">&quot;-O3 -fPIC&quot;</span> ./configure --prefix= /usr/local/zlib/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、添加用户组clamav和组成员clamav：</span></span><br><span class="line">groupadd clamav</span><br><span class="line">useradd -g clamav -s /bin/false -c <span class="string">&quot;Clam AntiVirus&quot;</span> clamav</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、安装Clamav</span></span><br><span class="line">tar –zxvf clamav-0.97.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> clamav-0.97.6</span><br><span class="line">./configure --prefix=/opt/clamav --disable-clamav -with-zlib=/usr/local/zlib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、配置Clamav</span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/clamav/logs</span><br><span class="line"><span class="built_in">mkdir</span> /opt/clamav/updata</span><br><span class="line"><span class="built_in">touch</span> /opt/clamav/logs/freshclam.log</span><br><span class="line"><span class="built_in">touch</span> /opt/clamav/logs/clamd.log</span><br><span class="line"><span class="built_in">cd</span> /opt/clamav/logs</span><br><span class="line"><span class="built_in">chown</span> clamav:clamav clamd.log</span><br><span class="line"><span class="built_in">chown</span> clamav:clamav freshclam.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、ClamAV 使用：</span></span><br><span class="line"> /opt/clamav/bin/freshclam 升级病毒库</span><br><span class="line">./clamscan –h 查看相应的帮助信息</span><br><span class="line">./clamscan -r /home  扫描所有用户的主目录就使用</span><br><span class="line">./clamscan -r --bell -i /bin  扫描bin目录并且显示有问题的文件的扫描结果</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装方式二：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">yum install -y clamav</span><br><span class="line"><span class="comment">#更新病毒库</span></span><br><span class="line">freshclam</span><br><span class="line"><span class="comment">#扫描方法</span></span><br><span class="line">clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log</span><br><span class="line">clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log</span><br><span class="line">clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log</span><br><span class="line"><span class="comment">#扫描并杀毒</span></span><br><span class="line">clamscan -r  --remove  /usr/bin/bsd-port</span><br><span class="line">clamscan -r  --remove  /usr/bin/</span><br><span class="line">clamscan -r --remove  /usr/local/zabbix/sbin</span><br><span class="line"><span class="comment">#查看日志发现</span></span><br><span class="line"><span class="built_in">cat</span> /root/usrclamav.log |grep FOUND</span><br></pre></td></tr></table></figure>

<h4 id="2.3">webshell查杀</h4>


<ul>
<li><a target="_blank" rel="noopener" href="http://www.shellpub.com/">河马webshell查杀</a></li>
<li><a target="_blank" rel="noopener" href="http://edr.sangfor.com.cn/backdoor_detection.html">深信服Webshell网站后门检测工具</a></li>
</ul>
<h4 id="2.4">RPM check检查</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统完整性可以通过rpm自带的-Va来校验检查所有的rpm软件包，查看哪些命令是否被替换了：</span></span><br><span class="line">./rpm -Va &gt; rpm.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果一切均校验正常将不会产生任何输出，如果有不一致的地方，就会显示出来，输出格式是8位长字符串，每个字符都用以表示文件与RPM数据库中一种属性的比较结果 ，如果是. (点) 则表示测试通过。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证内容中的8个信息的具体内容如下：</span></span><br><span class="line"><span class="comment">#        S         文件大小是否改变</span></span><br><span class="line"><span class="comment">#        M         文件的类型或文件的权限（rwx）是否被改变</span></span><br><span class="line"><span class="comment">#        5         文件MD5校验是否改变（可以看成文件内容是否改变）</span></span><br><span class="line"><span class="comment">#        D         设备中，从代码是否改变</span></span><br><span class="line"><span class="comment">#        L         文件路径是否改变</span></span><br><span class="line"><span class="comment">#        U         文件的属主（所有者）是否改变</span></span><br><span class="line"><span class="comment">#        G         文件的属组是否改变</span></span><br><span class="line"><span class="comment">#        T         文件的修改时间是否改变</span></span><br><span class="line"><span class="comment"># 如果命令被替换了，如果还原回来：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件提取还原案例：</span></span><br><span class="line">rpm  -qf /bin/ls  <span class="comment"># 查询ls命令属于哪个软件包</span></span><br><span class="line"><span class="built_in">mv</span>  /bin/ls /tmp  <span class="comment"># 先把ls转移到tmp目录下，造成ls命令丢失的假象</span></span><br><span class="line">rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls <span class="comment"># 提取rpm包中ls命令到当前目录的/bin/ls下</span></span><br><span class="line"><span class="built_in">cp</span> /root/bin/ls  /bin/ <span class="comment"># 把ls命令复制到/bin/目录 修复文件丢失</span></span><br></pre></td></tr></table></figure>

<h4 id="2.4">linux安全检查脚本</h4>

<p>Github项目地址：<br><a target="_blank" rel="noopener" href="https://github.com/grayddq/GScan">https://github.com/grayddq/GScan</a><br><a target="_blank" rel="noopener" href="https://github.com/ppabc/security_check">https://github.com/ppabc/security_check</a><br><a target="_blank" rel="noopener" href="https://github.com/T0xst/linux">https://github.com/T0xst/linux</a></p>
<h4 id="3">常见网络安全攻击特征</h4>

<table>
<thead>
<tr>
<th>攻击类型</th>
<th>特征表现</th>
</tr>
</thead>
<tbody><tr>
<td>挖矿病毒</td>
<td>- CPU &#x2F; GPU 长时间 占用 100%- 异常进程（如xmrig、kworker、ddgs） - 持续对外连接 矿池地址（stratum+tcp:&#x2F;&#x2F;）</td>
</tr>
<tr>
<td>DDoS 攻击</td>
<td>- 服务器 带宽异常占满-netstat显示大 SYN_RECV、TIME_WAIT-ps发现大量httpd&#x2F;nginx进程</td>
</tr>
<tr>
<td>后门木马</td>
<td>- 隐藏进程，ps进程列表找不到但top能看到 -crontab中出现可疑定时任务 - 端口监听异常 (ss -antp显示 root 运行的非标准端口)</td>
</tr>
<tr>
<td>蠕虫病毒</td>
<td>- 短时间内大量文件变动-top显示异常高 I&#x2F;O 负载 - 服务器对外疯狂扫描其他 IP</td>
</tr>
<tr>
<td>勒索病毒</td>
<td>- 文件被加密（扩展名.lock、.encrypted） -&#x2F;tmp目录下出现未知可执行文件 -ps发现wget&#x2F;curl下载可疑文件</td>
</tr>
<tr>
<td>Webshell &#x2F; 恶意代码</td>
<td>- 网站目录（&#x2F;var&#x2F;www&#x2F;html&#x2F;）出现陌生脚本文件- &#96;grep -r eval</td>
</tr>
<tr>
<td>SQL 注入攻击</td>
<td>- 数据库mysqld进程 CPU 异常升高 - 网站日志出现大量 UNION SELECT或 OR 1&#x3D;1语句</td>
</tr>
<tr>
<td>暴力破解 SSH</td>
<td>-&#x2F;var&#x2F;log&#x2F;secure出现大量 failed login记录 -who发现陌生 IP 登录 -ss -antp发现22端口大量连接</td>
</tr>
<tr>
<td>DNS 劫持</td>
<td>-resolv.conf被篡改，DNS 解析异常 -ping google.com解析 IP 变化 - 服务器 DNS 记录被改到8.8.8.8之外的未知 IP</td>
</tr>
<tr>
<td>恶意代理 &#x2F; 隧道</td>
<td>-ps发现socat、nc、iodine等隧道工具 - 服务器对外大量443&#x2F;80连接 -iptables规则被修改</td>
</tr>
<tr>
<td>ARP 欺骗 &#x2F; 内网流量劫持</td>
<td>-arp -a显示异常网关 MAC - 内网通信异常，流量到达错误 IP -tcpdump发现 ARP 报文激增</td>
</tr>
</tbody></table>
<h4 id="4">Linux数据传输</h4>

<table>
<thead>
<tr>
<th>传输方式</th>
<th>适用场景</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td>SCP（安全复制协议）✅ 推荐</td>
<td>适用于内网或有 SSH 访问权限的服务器，支持加密传输</td>
<td>scp tool.tar.gz <a href="mailto:&#x75;&#115;&#x65;&#114;&#x40;&#49;&#57;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#49;&#x2e;&#x31;&#x30;&#48;">user@192.168.1.100</a>:&#x2F;tmp&#x2F;</td>
</tr>
<tr>
<td>SFTP（安全文件传输）✅ 推荐</td>
<td>基于 SSH，适用于Windows 客户端上传</td>
<td>使用FileZilla、WinSCP等客户端 ｜</td>
</tr>
<tr>
<td>rsync（高效增量同步）✅ 推荐</td>
<td>大文件同步，支持断点续传</td>
<td>rsync -avz tool.tar.gz <a href="mailto:&#117;&#115;&#x65;&#x72;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#x31;&#46;&#x31;&#48;&#48;">user@192.168.1.100</a>:&#x2F;tmp&#x2F; ｜</td>
</tr>
<tr>
<td>Xshell &#x2F; Xftp（图形化）</td>
<td>适用于Windows 远程管理</td>
<td>Xftp 上传文件到服务器 ｜</td>
</tr>
<tr>
<td>FTP（不安全，谨慎使用）</td>
<td>适用于无 SSH 但开放 FTP 端口的服务器</td>
<td>ftp 192.168.1.100 ｜</td>
</tr>
<tr>
<td>HTTP &#x2F; Python Web 服务器✅ 推荐</td>
<td>适用于目标服务器可访问外网的情况</td>
<td>python3 -m http.server 8080 ｜</td>
</tr>
<tr>
<td>Wget &#x2F; Curl（远程下载）✅ 推荐</td>
<td>适用于服务器能访问公网的情况</td>
<td>wget <a target="_blank" rel="noopener" href="http://your-server.com/tool.tar.gz">http://your-server.com/tool.tar.gz</a></td>
</tr>
<tr>
<td>Netcat（适用于封闭环境）✅ 推荐</td>
<td>适用于内网受限环境，可用于无 SSH 但有端口通信的服务器</td>
<td>发送端：nc -lvp 4444 &lt; tool.tar.gz接收端：nc IP 4444 &gt; tool.tar.gz</td>
</tr>
<tr>
<td>SMB 共享（Windows ↔ Linux）</td>
<td>适用于Windows 与 Linux 互传</td>
<td>Linux 挂载 SMB:mount -t cifs &#x2F;&#x2F;192.168.1.100&#x2F;share &#x2F;mnt</td>
</tr>
<tr>
<td>U 盘 &#x2F; 物理介质</td>
<td>适用于离线服务器</td>
<td>直接拷贝到 U 盘，然后mount &#x2F;dev&#x2F;sdb1 &#x2F;mnt</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://bypass007.github.io/Emergency-Response-Notes/Summary/%E7%AC%AC2%E7%AF%87%EF%BC%9ALinux%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5.html">引用</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/WangsuSecurity/article/details/143143504">https://blog.csdn.net/WangsuSecurity/article/details/143143504</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/linux/">
                Linux命令
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/Linux/">Linux</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#1">系统管理及ICP资源管理 (uname hostnamectl getconf uname sar arch date ipcs ulimit)</a></li>
<li><a href="#2">文件及目录管理 (cat less tail find grep sed awk rmdir ln which locate tail dmesg journalctl rsync)</a></li>
<li><a href="#3">管道 |</a></li>
<li><a href="#4">远程拷贝 (scp tar zip unzip gzip gunzip bzip bunzip)</a></li>
<li><a href="#5">磁盘管理 (df du fdisk mount)</a></li>
<li><a href="#6">进程管理 (ps top pgrep kill lsof pmap bg ctrl+z ctrl+c &amp; jobs nohup)</a></li>
<li><a href="#7">性能监控 (top sar free watch)</a></li>
<li><a href="#8">网络工具 (netstat lsof route ping host wget sftp scp traceroute ss arp)</a></li>
<li><a href="#9">用户管理 (useradd passwd userdel usermod chmod chown .bashrc .bash_profile)</a></li>
<li><a href="#10">防火墙 ()</a></li>
</ul>
<p>time计时</p>
<h2 id="Linux-常用基本命令"><a href="#Linux-常用基本命令" class="headerlink" title="Linux 常用基本命令"></a>Linux 常用基本命令</h2><h3 id="Linux目录"><a href="#Linux目录" class="headerlink" title="Linux目录"></a>Linux目录</h3><table>
<thead>
<tr>
<th>目录路径</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;bin</td>
<td>二进制可执行文件的目录所在 例如 openssl就是在这个文件下</td>
</tr>
<tr>
<td>｜ &#x2F;etc ｜ 系统管理和配置文件 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;etc&#x2F;rc.d ｜ 启动的配置文件和脚本 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;home ｜ 用户的主目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;lib ｜ 标准设计程序，是动态链接共享库 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;sbin ｜ 超级管理员命令 这里存放的是系统管理员使用的管理程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;tmp ｜ 公共存放的临时文件目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;root ｜ 系统管理员的主目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;mnt ｜ 系统提供这个目录是让用户临时挂载的文件系统 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;lost+found ｜ 这个目录平时是空，系统非正常关键而留下 没有保存的文件就在这里 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;proc ｜ 虚拟的目录，是系统内存的映射，可以直接访问这个目录来获取系统信息 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;var ｜ 某些大文件的溢出区，比方说各种服务器的日志文件 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;var&#x2F;log ｜系统⽇志⽂件。 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr ｜ 最庞大的目录，要用到的应用程序和文件几乎都在这个目录 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr&#x2F;bin ｜ 众多的应用程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;usr&#x2F;sbin ｜ 超级用户的一些管理程序 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;opt ｜ 软件包目录，⽤户安装的可选应⽤软件⼀般放在此处，不会影响系统默认的软件结构 ｜</td>
<td></td>
</tr>
<tr>
<td>｜&#x2F;sys ｜ 虚拟⽂件系统⽬录，⽤于存放系统硬件信息，提供系统与硬件设备之间的接⼝ ｜</td>
<td></td>
</tr>
</tbody></table>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="1">系统管理及ICP资源管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 Linux内核 版本命令</span></span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Linux系统 版本的命令</span></span><br><span class="line">lsb_release -a  <span class="comment"># RedHat、SUSE、Debian…等发行版</span></span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release <span class="comment"># 只适合Redhat系的Linux</span></span><br><span class="line"><span class="built_in">cat</span> /etc/issue <span class="comment"># 此命令也适用于所有的Linux发行版</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hostnamectl</span><br><span class="line">hostnamectl | grep -i kernel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 扩展</span></span><br><span class="line"><span class="comment"># 查看 CUP信息  包括型号 主频 内核等等</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CPU的核的个数:</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo | grep processor | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/meminfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CUP架构</span></span><br><span class="line">getconf LONG_BIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示架构</span></span><br><span class="line"><span class="built_in">arch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### ICP资源管理 ###</span></span><br><span class="line"><span class="comment">#查看系统使用的IPC资源</span></span><br><span class="line">ipcs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC共享内存资源</span></span><br><span class="line">ipcs -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC队列资源</span></span><br><span class="line">ipcs -q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统使用的IPC信号量资源</span></span><br><span class="line">ipcs -s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用示例：查看IPC资源被谁占用</span></span><br><span class="line"><span class="comment"># 有个IPCKEY：51036 ，需要查询其是否被占用；</span></span><br><span class="line"><span class="comment"># 首先通过计算器将其转为十六进制:</span></span><br><span class="line"><span class="comment">#     51036 -&gt; c75c</span></span><br><span class="line"><span class="comment"># 如果知道是被共享内存占用</span></span><br><span class="line">ipcs -m | grep c75c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不确定，则直接查找</span></span><br><span class="line">ipcs | grep c75c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前所有的系统资源limit 信息</span></span><br><span class="line"><span class="built_in">ulimit</span> – a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对生成的 core 文件的大小不进行限制</span></span><br><span class="line"><span class="built_in">ulimit</span> – c unlimited</span><br></pre></td></tr></table></figure>

<h4 id="2">文件及目录管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### 查看小文件 ###</span></span><br><span class="line"><span class="comment"># 小文档查看</span></span><br><span class="line"><span class="built_in">cat</span> [文件]</span><br><span class="line"><span class="comment"># 浏览文件</span></span><br><span class="line">less [文件]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 查看大文件 ###</span></span><br><span class="line"><span class="built_in">tail</span></span><br><span class="line"><span class="built_in">tail</span> -f [文件]</span><br><span class="line"><span class="comment"># 显示最后20行信息</span></span><br><span class="line"><span class="built_in">tail</span> -n 20 [文件]</span><br><span class="line"><span class="built_in">tail</span> -n -20 [文件]</span><br><span class="line"><span class="comment"># 显示从20行到末尾</span></span><br><span class="line"><span class="built_in">tail</span> -n +20 [文件]</span><br><span class="line"></span><br><span class="line"><span class="comment">### find 文件名查找 ###</span></span><br><span class="line"><span class="comment"># find [搜索路径] -name [文件名关键词]</span></span><br><span class="line">find / -name <span class="string">&quot;passw&quot;</span></span><br><span class="line">find / -name <span class="string">&quot;fi*&quot;</span> <span class="comment">## 区分大小写</span></span><br><span class="line">find / -iname <span class="string">&quot;fi*&quot;</span> <span class="comment">## 不区分大小写</span></span><br><span class="line"><span class="comment"># 支持通配符 `*`、`?`和`[]`</span></span><br><span class="line"><span class="string">&quot;*.log&quot;</span>,<span class="string">&quot;file?.txt&quot;</span>,<span class="string">&quot;file[0-9].txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找txt和pdf文件</span></span><br><span class="line">find . \( -name <span class="string">&quot;*.txt&quot;</span> -o -name <span class="string">&quot;*.pdf&quot;</span> \) -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则方式查找.txt和pdf</span></span><br><span class="line">find . -regex  <span class="string">&quot;.*\(\.txt|\.pdf\)$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询7天前被访问过的所有文件</span></span><br><span class="line">find . -atime +7 <span class="built_in">type</span> f -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按权限查找</span></span><br><span class="line">find . -<span class="built_in">type</span> f -perm 644 -<span class="built_in">print</span> //找具有可执行权限的所有文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按用户查找</span></span><br><span class="line">find . -<span class="built_in">type</span> f -user weber -<span class="built_in">print</span>// 找用户weber所拥有的文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按大小搜索</span></span><br><span class="line">find . -size xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">### grep 文件内容查找 ###</span></span><br><span class="line"><span class="comment"># grep -参数 查找范围</span></span><br><span class="line"><span class="comment"># 参数</span></span><br><span class="line"><span class="comment"># -n 显示所有结果显示行号 number</span></span><br><span class="line"><span class="comment"># -R 递归查找目录下的所有文件</span></span><br><span class="line"></span><br><span class="line">grep aries /etc</span><br><span class="line">grep aries /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep输出以0作为结尾符的文件名（-z）</span></span><br><span class="line">grep <span class="string">&quot;test&quot;</span> file* -lZ| xargs -0 <span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 综合应用：将日志中的所有带where条件的sql查找查找出来</span></span><br><span class="line"><span class="built_in">cat</span> LOG.* | <span class="built_in">tr</span> a-z A-Z | grep <span class="string">&quot;FROM &quot;</span> | grep <span class="string">&quot;WHERE&quot;</span> &gt; b</span><br><span class="line"></span><br><span class="line"><span class="comment">### sed 文本替换利器 ###</span></span><br><span class="line"><span class="comment"># 首处替换</span></span><br><span class="line">sed <span class="string">&#x27;s/text/replace_text/&#x27;</span> file   //替换每一行的第一处匹配的text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局替换</span></span><br><span class="line">sed <span class="string">&#x27;s/text/replace_text/g&#x27;</span> file</span><br><span class="line"></span><br><span class="line"><span class="comment">### awk 数据流处理工具 ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### rmdir 删除空目录 ###</span></span><br><span class="line"><span class="built_in">rmdir</span> newfile</span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件链接 ###</span></span><br><span class="line"><span class="comment">##  软链接 ##</span></span><br><span class="line"><span class="built_in">ln</span> -s original.txt symlink.txt <span class="comment">## 创建指向 original.txt 的符号链接（软链接） symlink.txt</span></span><br><span class="line"><span class="comment">##  硬链接 ##</span></span><br><span class="line"><span class="built_in">ln</span> ~/offsec123.txt hardlink.txt <span class="comment">## 创建 offsec123.txt ⽂件的硬链接 hardlink.txt </span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件搜索 ###</span></span><br><span class="line"><span class="built_in">which</span> mysql</span><br><span class="line"></span><br><span class="line">locate XX.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">### 系统日志 ###</span></span><br><span class="line"><span class="comment">## 日志⽂件 ##</span></span><br><span class="line"><span class="built_in">tail</span> -3 /var/log/auth.log <span class="comment">## 查看 auth.log ⽂件中的最后三⾏记录。</span></span><br><span class="line"><span class="comment">## ⼆进制⽇志 ##</span></span><br><span class="line"><span class="built_in">who</span> /var/log/wtmp | <span class="built_in">tail</span> -5 <span class="comment">## 查看最近五个⽤户登录记录。</span></span><br><span class="line">dmesg <span class="comment">## 查看系统启动和内核⽇志。</span></span><br><span class="line"><span class="comment">## systemd⽇志 ##</span></span><br><span class="line">journalctl <span class="comment">## 查看 systemd 系统⽇志。</span></span><br></pre></td></tr></table></figure>

<h4 id="3">管道</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法 - 命令1的输出结果，作为命令2的输入</span></span><br><span class="line"></span><br><span class="line">命令1 | 命令2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line"><span class="comment"># 查找aries用户</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | grep -n <span class="string">&quot;baizhi&quot;</span></span><br><span class="line"><span class="comment"># 查找aires组</span></span><br><span class="line"><span class="built_in">cat</span> /etc/group | grep -n <span class="string">&quot;baizhi&quot;</span></span><br><span class="line"><span class="comment"># 查找sshd进程</span></span><br><span class="line">ps -aux | grep sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续使用管道意味着第一个命令的输出会作为 第二个命令的输入，第二个命令的输出又会作为第三个命令的输入，依此类推</span></span><br><span class="line"></span><br><span class="line">rpm –qa | grep licq</span><br><span class="line"><span class="comment"># 管道将rpm -qa命令的输出（包括系统中所有安装的RPM包）作为grep命令的输入，从而列出带有licq字符的RPM包来</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | grep /bin/bash | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment"># 这条命令使用了两个管道，利用第一个管道将cat命令（显示passwd文件的内容）的输出送给grep命令，grep命令找出含有“/bin /bash”的所有行；第二个管道将grep的输出送给wc命令，wc命令统计出输入中的行数。这个命令的功能在于找出系统中有多少个用户使用bash。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> -v record.log | grep AAA | grep -v BBB | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment"># 查找record.log中包含AAA，但不包含BBB的记录的总数:</span></span><br></pre></td></tr></table></figure>
<p>管道命令与重定向区别<br>区别是：</p>
<ul>
<li>左边的命令应该有标准输出 | 右边的命令应该接受标准输入<br>左边的命令应该有标准输出 &gt; 右边只能是文件<br>左边的命令应该需要标准输入 &lt; 右边只能是文件</li>
<li>管道触发两个子进程执行”|”两边的程序；而重定向是在一个进程内执行<br>这些都是网上总结很多的，其实只要多加清楚用法，也一定有自己的一份不同描述。</li>
</ul>
<h4 id="4">远程拷贝</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scp -r [local_folder] [remote_username]@[remote_ip]:[remote_folder]</span><br><span class="line">scp -r [local_folder] [remote_ip]:[remote_folder]</span><br><span class="line"><span class="comment"># 第1个指定了用户名，命令执行后需要输入用户密码； 第2个没有指定用户名，命令执行后需要输入用户名和密码；</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 - 远处文件-&gt;本地目录</span></span><br><span class="line">scp root@10.6.159.147:/opt/soft/demo.tar /opt/soft/</span><br><span class="line"><span class="comment"># 说明： 从10.6.159.147机器上的/opt/soft/的目录中下载demo.tar 文件到本地/opt/soft/目录中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 - 远处-&gt;本地</span></span><br><span class="line">scp -r root@10.6.159.147:/opt/soft/test /opt/soft/</span><br><span class="line"><span class="comment"># 说明： 从10.6.159.147机器上的/opt/soft/中下载test目录到本地的/opt/soft/目录来。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传 - 本地文件-&gt;远程机器指定目录</span></span><br><span class="line">scp /opt/soft/demo.tar root@10.6.159.147:/opt/soft/scptest</span><br><span class="line"><span class="comment"># 说明： 复制本地opt/soft/目录下的文件demo.tar 到远程机器10.6.159.147的opt/soft/scptest目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传 - 本地目录-&gt;远程机器指定目录</span></span><br><span class="line">scp -r /opt/soft/test root@10.6.159.147:/opt/soft/scptest</span><br><span class="line"><span class="comment"># 说明： 上传本地目录 /opt/soft/test到远程机器10.6.159.147上/opt/soft/scptest的目录中</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/linux%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">### tar打包 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># tar [选项] [打包tar] [源目录文件]</span></span><br><span class="line">tar -cvf config.xml.tar config.xml </span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">### tar解压 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># tar [选项] [压缩包] [目录文件] / 不加C 就当前目录</span></span><br><span class="line">tar -xvf config.xml.tar -C /tmp </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### .tar.bz2 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># -z：压缩和解压缩 &quot;.tar.gz&quot; 格式；</span></span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 打包</span></span><br><span class="line">tar -zcvf tmp.tar.gz /tmp/ </span><br><span class="line"></span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 解压</span></span><br><span class="line">tar -zxvf tmp.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">###.tar.bz2 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment"># -j：压缩和解压缩 &quot;.tar.bz2&quot;格式。</span></span><br><span class="line"><span class="comment">## &quot;.tar.bz2&quot; 格式 - 打包</span></span><br><span class="line">tar -jcvf tmp.tar.bz2 /tmp/ </span><br><span class="line"><span class="comment">## &quot;.tar.gz&quot; 格式 - 解压</span></span><br><span class="line">tar -jxvf tmp.tar.bz2 </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### zip-压缩 ###</span></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line"><span class="comment">## zip [选项] 压缩包名 源文件或源目录列表</span></span><br><span class="line">zip ana.zip anaconda-ks.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 多个文件 test.zip</span></span><br><span class="line">zip test.zip install.log install.log.syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 目录 需要使用“-r”选项</span></span><br><span class="line">zip -r dir1.zip dir1   </span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">### unzip-解压 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">## unzip [选项] 压缩包名</span></span><br><span class="line">unzip dir1.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压 - 把压缩包解压到指定位置</span></span><br><span class="line">unzip -d /tmp/ ana.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### gzip 压缩 ###</span></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment"># 只压缩 不打包成集合</span></span><br><span class="line"><span class="comment"># 默认压缩 不保留源文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## gzip [选项] 源文件</span></span><br><span class="line">gzip install.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## 压缩 - 保留源文件压缩</span></span><br><span class="line"><span class="comment"># 使用-c选项，但是不让压缩数据输出到屏幕上，而是重定向到压缩文件中，这样可以缩文件的同时不删除源文件</span></span><br><span class="line">gzip -c anaconda-ks.cfg &gt;anaconda-ks.cfg.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">###################</span></span><br><span class="line"><span class="comment">### gunzip 解压 ###</span></span><br><span class="line"><span class="comment">##################</span></span><br><span class="line"><span class="comment">## gunzip [选项] 文件</span></span><br><span class="line">gunzip install.log.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 打包 - 要想解压缩&quot;.gz&quot;格式，还可以使用 &quot;gzip -d&quot;命令</span></span><br><span class="line">gzip -d anaconda-ks.cfg.gz</span><br><span class="line"><span class="comment">## 解压 - 缩目录下的内容，则需使用 &quot;-r&quot; 选项</span></span><br><span class="line">gunzip -r <span class="built_in">test</span>/</span><br><span class="line"><span class="comment">## 如果我们压缩的是一个纯文本文件，则可以直接使用 zcat 命令在不解压缩的情况下查看这个文本文件中的内容</span></span><br><span class="line">zcat anaconda-ks.cfg.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### bzip2压缩 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment">## bzip2 [选项] 源文件</span></span><br><span class="line"><span class="comment">## 压缩 - 成&quot;.bz2&quot;格式，此压缩命令会在压缩的同时删除源文件。</span></span><br><span class="line">bzip2 anaconda-ks.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩 - 同时保留源文件</span></span><br><span class="line">bzip2 -k install.log.syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">## 打包</span></span><br><span class="line"><span class="comment">## bunzip2 [选项] 源文件</span></span><br><span class="line">bunzip2 anaconda-ks.cfg.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">### bzip2解压 ###</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># - &quot;.bz2&quot; 格式也可以使用 &quot;bzip2 -d 压缩包&quot; 命令来进行解压缩</span></span><br><span class="line">bzip2 -d install.log.syslog.bz2</span><br><span class="line"><span class="comment">## 和 &quot;.gz&quot; 格式一样，&quot;.bz2&quot; 格式压缩的纯文本文件也可以不解压缩直接查看，使用的命令是 bzcat</span></span><br><span class="line">bzcat install.log.syslog.bz2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5">磁盘管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">df</span> -h <span class="comment"># 查看磁盘空间</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -hT <span class="comment"># 显示⽂件系统的磁盘使⽤情况， -h ⼈性化显示， -T 显示⽂件系统类型。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> -sh <span class="comment"># 查看当前目录所占空间大小</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> ./* -hsc <span class="comment"># 递归查看⽬录中每个⽂件或⽂件夹的⼤⼩。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看磁盘分区 ##</span></span><br><span class="line">fdisk -l <span class="comment"># 列出所有分区信息。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载分区 ##</span></span><br><span class="line">mount /dev/sdb1 /mnt/usb <span class="comment"># 挂载设备 /dev/sdb1 到 /mnt/usb ⽬录。</span></span><br></pre></td></tr></table></figure>

<h4 id="6">进程管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看正在运行进程</span></span><br><span class="line">ps -ef</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态查看系统进程</span></span><br><span class="line">ps -aux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询归属于用户colin115的进程</span></span><br><span class="line">ps -ef | grep colin115</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询进程ID（适合只记得部分进程字段）</span></span><br><span class="line"><span class="comment"># pgrep [查找进程]</span></span><br><span class="line">pgrep  -l re <span class="comment">#查询进程名中含有re的进程</span></span><br><span class="line"></span><br><span class="line">ps -ajx <span class="comment"># 以完整的格式显示所有的进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看系统进程</span></span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭进程</span></span><br><span class="line"><span class="built_in">kill</span> [进程<span class="built_in">id</span>]</span><br><span class="line"><span class="comment"># 强制杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 [进程<span class="built_in">id</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看端口占用的进程状态</span></span><br><span class="line">lsof -i:3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询init进程当前打开的文件</span></span><br><span class="line">lsof -c init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询指定的进程ID(23295)打开的文件</span></span><br><span class="line">lsof -p 23295</span><br><span class="line"></span><br><span class="line"><span class="comment"># pmap，来输出进程内存的状况，可以用来分析线程堆栈</span></span><br><span class="line">pmap [PID]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户colin115下的所有进程名以av_开头的进程终止</span></span><br><span class="line">ps -u colin115 |  awk <span class="string">&#x27;/av_/ &#123;print &quot;kill -9 &quot; $1&#125;&#x27;</span> | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户colin115下所有进程名中包含HOST的进程终止</span></span><br><span class="line">ps -fe| grep colin115|grep HOST |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在命令末尾加上 &amp; 符号，就可以让程序在后台运行</span></span><br><span class="line">./test.sh &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果程序正在前台运行，可以使用 Ctrl+z 选项把程序暂停 然后用 bg %[number] 命令把这个程序放到后台运行，摁Ctrl+z，然后在最后一行加上bg %number</span></span><br><span class="line"><span class="built_in">bg</span> %1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将后台中的命令调至前台继续运行。如果后台中有多个命令，可以用fg %jobnumber（是命令编号，不是进程号）将选中的命令调出。</span></span><br><span class="line"><span class="built_in">fg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前有多少在后台运行的命令</span></span><br><span class="line"><span class="comment"># 对于所有运行的程序，我们可以用jobs –l 指令查看</span></span><br><span class="line"><span class="built_in">jobs</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果让程序始终在后台执行，即使关闭当前的终端也执行（之前的&amp;做不到），这时候需要nohup。该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。关闭中断后，在另一个终端jobs已经无法看到后台跑得程序了，此时利用ps（进程查看命令）</span></span><br><span class="line"><span class="built_in">nohup</span> ./test.sh &amp;</span><br></pre></td></tr></table></figure>

<h4 id="7">性能监控</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看CPU使用率</span></span><br><span class="line">sar -u</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CPU平均负载</span></span><br><span class="line">sar -q 1 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># sar指定-r之后，可查看内存使用状况</span></span><br><span class="line">sar -r 1 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存使用量</span></span><br><span class="line">free -m</span><br><span class="line"><span class="comment"># 显示内存和交换分区的使⽤情况</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看页面交换发生状况 页面发生交换时，服务器的吞吐量会大幅下降；服务器状况不良时，如果怀疑因为内存不足而导致了页面交换的发生，可以使用sar -W这个命令来确认是否发生了大量的交换</span></span><br><span class="line">sar -W 1 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux下有 vmstat、Unix系统有prstat</span></span><br><span class="line"><span class="comment"># 查看cpu、内存、使用情况： vmstat n m （n 为监控频率、m为监控次数）</span></span><br><span class="line">vmstat 1 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用watch 工具监控变化 当需要持续的监控应用的某个数据变化时，watch工具能满足要求； 执行watch命令后，会进入到一个界面，输出当前被监控的数据，一旦数据变化，便会高亮显示变化情况；</span></span><br><span class="line"><span class="comment"># 操作redis时，监控内存变化</span></span><br><span class="line">watch -d -n 1 <span class="string">&#x27;./redis-cli info | grep memory&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8">网络工具</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 查询网络服务和端口 ###</span></span><br><span class="line"><span class="comment"># 列出所有端口</span></span><br><span class="line">netstat -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有 tcp 端口</span></span><br><span class="line">netstat -at</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有有监听的服务状态</span></span><br><span class="line">netstat -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用netstat工具查询端口</span></span><br><span class="line">netstat -antp | grep 6379</span><br><span class="line"></span><br><span class="line">netstat -natup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是 netstat 的替代⼯具，性能更⾼。</span></span><br><span class="line">ss -natup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 ARP 缓存表中的⼆层地址信息。</span></span><br><span class="line">arp -en</span><br><span class="line"></span><br><span class="line"><span class="comment">### 网络路由 ###</span></span><br><span class="line"><span class="comment"># 查看路由状态</span></span><br><span class="line">route -n</span><br><span class="line"></span><br><span class="line"><span class="comment">### ping包到地址IP ###</span></span><br><span class="line">ping IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### 探测前往地址IP的路由路径 ###</span></span><br><span class="line">traceroute IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### DNS查询，寻找域名domain对应的IP ###</span></span><br><span class="line">host domain</span><br><span class="line"></span><br><span class="line"><span class="comment">### 反向DNS查询 ###</span></span><br><span class="line">host IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### ssh 222端口 ###</span></span><br><span class="line">ssh -p 222 ID@host</span><br><span class="line"></span><br><span class="line"><span class="comment">### ftp/sftp文件传输 ###</span></span><br><span class="line">sftp ID@host</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆服务器host，ID为用户名。sftp登陆后，可以使用下面的命令进一步操作：</span></span><br><span class="line">get filename <span class="comment"># 下载文件</span></span><br><span class="line">put filename <span class="comment"># 上传文件</span></span><br><span class="line"><span class="built_in">ls</span> <span class="comment"># 列出host上当前路径的所有文件</span></span><br><span class="line"><span class="built_in">cd</span> <span class="comment"># 在host上更改当前路径</span></span><br><span class="line">lls <span class="comment"># 列出本地主机上当前路径的所有文件</span></span><br><span class="line">lcd <span class="comment"># 在本地主机更改当前路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### lftp同步文件夹(类似rsync工具) ###</span></span><br><span class="line">lftp -u user:pass host</span><br><span class="line">lftp user@host:~&gt; mirror -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 同步⽂件或⽬录，适合备份和⼤规模⽂件传输。</span></span><br><span class="line">rsync -avzh</span><br></pre></td></tr></table></figure>


<h4 id="9">用户管理</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 用户 ###</span></span><br><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">useradd -m username <span class="comment"># 该命令为用户创建相应的帐号和用户目录/home/username</span></span><br><span class="line">passwd username <span class="comment"># 密码以交互方式创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">userdel -r username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换账户</span></span><br><span class="line">su userB</span><br><span class="line"></span><br><span class="line"><span class="comment">### 用户的组 ###</span></span><br><span class="line"><span class="comment"># 查看当前用户所属的组</span></span><br><span class="line"><span class="built_in">groups</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个用户可以属于多个组，将用户加入到组</span></span><br><span class="line">usermod -G groupNmame username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变更用户所属的根组(将用加入到新的组，并从原有的组中除去）</span></span><br><span class="line">usermod -g groupName username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统的所有用户及所有组信息分别记录在两个文件中：/etc/passwd , /etc/group 默认情况下这两个文件对所有用户可读</span></span><br><span class="line"><span class="comment"># 查看所有用户及权限</span></span><br><span class="line">more /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的用户组及权限</span></span><br><span class="line">more /etc/group</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 用户权限 ###</span></span><br><span class="line">[/home/weber#]<span class="built_in">ls</span> -l /etc/group</span><br><span class="line">-rwxrw-r-- colin king 725 2013-11-12 15:37 /home/colin/a</span><br><span class="line"></span><br><span class="line">-rwx [文件拥有者] 表示这个文件对文件拥有者colin这个用户可读写、可执行；</span><br><span class="line">rw- [所在的组] 对colin所在的组（king）可读可写；</span><br><span class="line">r-- [其他用户] 对其它用户只可读；</span><br><span class="line"></span><br><span class="line"><span class="comment">### 使用chmod命令更改文件的读写权限，更改读写权限有两种方法，一种是字母方式，一种是数字方式</span></span><br><span class="line"><span class="comment">## 字母方式:</span></span><br><span class="line"><span class="built_in">chmod</span> userMark(+|-)PermissionsMark</span><br><span class="line"><span class="comment"># userMark取值：</span></span><br><span class="line"><span class="comment"># u：用户</span></span><br><span class="line"><span class="comment"># g：组</span></span><br><span class="line"><span class="comment"># o：其它用户</span></span><br><span class="line"><span class="comment"># a：所有用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PermissionsMark取值：</span></span><br><span class="line"><span class="comment"># r: 读</span></span><br><span class="line"><span class="comment"># w：写</span></span><br><span class="line"><span class="comment"># x：执行</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> a+x main         对 [所有用户] 给文件main增加可执行权限</span><br><span class="line"><span class="built_in">chmod</span> g+w blogs        对 [组用户] 给文件blogs增加可写权限</span><br><span class="line"></span><br><span class="line"><span class="comment">## 数字方式：</span></span><br><span class="line"><span class="comment"># 4(读)</span></span><br><span class="line"><span class="comment"># 2(写)</span></span><br><span class="line"><span class="comment"># 1(执行)</span></span><br><span class="line"><span class="comment"># 6(4+2)代表有读写权</span></span><br><span class="line"><span class="comment"># 7(4+2+1)有读、写和执行的权限</span></span><br><span class="line"><span class="built_in">chmod</span> 740 main     将main的用户权限设置为rwxr-----</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改文件或目录的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> username dirOrFile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用-R选项递归更改该目下所有文件的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> -R weber server/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 环境变量 ###</span></span><br><span class="line"><span class="comment"># /etc/profile，/etc/bashrc 是系统全局环境变量设定、</span></span><br><span class="line"><span class="comment"># ~/.profile，~/.bashrc用户目录下的私有环境变量设定</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当登入系统获得一个shell进程时，其读取环境设置脚本分为三步:</p>
<p>首先读入的是全局环境变量设置文件<code>/etc/profile</code>，然后根据其内容读取额外的文档，如<code>/etc/profile.d</code>和<code>/etc/inputrc</code><br>读取当前登录用户Home目录下的文件<code>~ /.bash_profile</code>，其次读取<code>~ /.bash_login</code>，最后读取<code>~ /.profile</code>，这三个文档设定基本上是一样的，读取有优先关系<br>读取<code>~ /.bashrc</code><br><code>~ /.profile</code>与<code>~ /.bashrc</code>的区别:</p>
<p>这两者都具有个性化定制功能<br><code>~ /.profile</code>可以设定本用户专有的路径，环境变量，等，它只能登入的时候执行一次<br><code>~ /.bashrc</code>也是某用户专有设定文档，可以设定路径，命令别名，每次shell script的执行都会使用它一次</p>
<h4 id="10">防火墙</h4>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>












<p>引用 ： <a target="_blank" rel="noopener" href="https://linuxtools-rst.readthedocs.io/zh-cn/latest/base/07_network.html">https://linuxtools-rst.readthedocs.io/zh-cn/latest/base/07_network.html</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/mac/">
                Mac坑
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/Mac/">Mac</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>m1 已经是arm处理器</p>
<ul>
<li>包管理 brew</li>
<li><a href="/2025/05/29/shell/" title="Shell">Shell</a></li>
</ul>
<h1 id="launchd-代替-crontab"><a href="#launchd-代替-crontab" class="headerlink" title="launchd 代替 crontab"></a><code>launchd</code> 代替 <code>crontab</code></h1><p></code>crontab</code> 设置后并不起作用</p>
<p>MacOS 可能禁用了 <code>cron</code>，可以用 <code>launchd</code> 代替：</p>
<p>launchd 是 MacOS 用来管理系统和用户级别的守护进程的工具</p>
<ul>
<li><p>LaunchDaemons（后台服务）</p>
<ul>
<li>适用于系统级别的任务，通常以 root 权限运行。</li>
<li>在 开机时 启动，不依赖用户登录。</li>
<li>目录：&#x2F;System&#x2F;Library&#x2F;LaunchDaemons&#x2F; 和 &#x2F;Library&#x2F;LaunchDaemons&#x2F;</li>
<li>适用于系统服务，如数据库、守护进程等。</li>
</ul>
</li>
<li><p>LaunchAgents（用户任务）</p>
<ul>
<li>适用于用户级别的任务，以当前用户权限运行。</li>
<li>在 用户登录后 才会启动。</li>
<li>目录：&#x2F;System&#x2F;Library&#x2F;LaunchAgents&#x2F;、&#x2F;Library&#x2F;LaunchAgents&#x2F;、~&#x2F;Library&#x2F;LaunchAgents&#x2F;</li>
<li>适用于个人任务，如开机自动运行应用、定时脚本等。</li>
</ul>
</li>
</ul>
<p>什么时候用 LaunchDaemons？</p>
<ol>
<li>你希望一个进程开机自动运行，而不依赖用户是否登录。</li>
<li>任务需要root 权限（比如修改系统文件）。</li>
</ol>
<p>什么时候用 LaunchAgents？</p>
<ol>
<li>任务需要在用户登录后运行，比如启动应用、挂载网络驱动等。</li>
<li>你不需要 root 权限，而是以当前用户权限运行。</li>
</ol>
<h3 id="创建一个定时任务"><a href="#创建一个定时任务" class="headerlink" title="创建一个定时任务"></a>创建一个定时任务</h3><p>每天 下午3点运行一次 &#x2F;Users&#x2F;mac&#x2F;work&#x2F;navCatReset&#x2F;reset_navicat.sh。</p>
<ol>
<li>创建 plist 文件</li>
</ol>
<p>vi ~&#x2F;Library&#x2F;LaunchAgents&#x2F;com.user.resetnavicat.plist</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span><br><span class="line">&lt;plist version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;com.user.resetnavicat&lt;/string&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;string&gt;/bin/bash&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;/Users/mac/work/navCatReset/reset_navicat.sh&lt;/string&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StartCalendarInterval&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;Hour&lt;/key&gt;</span><br><span class="line">        &lt;<span class="built_in">integer</span>&gt;15&lt;/integer&gt;  &lt;!-- 下午3点 --&gt;</span><br><span class="line">        &lt;key&gt;Minute&lt;/key&gt;</span><br><span class="line">        &lt;<span class="built_in">integer</span>&gt;0&lt;/integer&gt;   &lt;!-- 00 分 --&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">    &lt;<span class="literal">true</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StandardOutPath&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;/Users/mac/work/navCatReset/cron_stdout.log&lt;/string&gt;</span><br><span class="line"></span><br><span class="line">    &lt;key&gt;StandardErrorPath&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;/Users/mac/work/navCatReset/cron_stderr.log&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>加载任务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl bootout gui/$(<span class="built_in">id</span> -u) ~/Library/LaunchAgents/com.user.resetnavicat.plist 2&gt;/dev/null</span><br><span class="line">launchctl bootstrap gui/$(<span class="built_in">id</span> -u) ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>检查是否成功</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl list | grep com.user.resetnavicat</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重新加载或修改后生效</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br><span class="line">launchctl load ~/Library/LaunchAgents/com.user.resetnavicat.plist</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>停止任务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl remove com.user.resetnavicat</span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/metasploit/">
                MetaSploit Framwork(MSF)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/渗透工具/">渗透工具</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><h3 id="模块划分"><a href="#模块划分" class="headerlink" title="模块划分"></a>模块划分</h3><ul>
<li>辅助模块 (Auxiliary，扫描器)，扫描主机系统，寻找可用漏洞；</li>
<li>渗透攻击模块 (Exploits)，选择并配置一个漏洞利用模块；</li>
<li>攻击载荷模块 (Payloads)，选择并配置一个攻击载荷模块；</li>
<li>后渗透攻击模块 (Post)，用于内网渗透的各种操作；</li>
<li>编码器模块 (Encoders)，选择编码技术，绕过杀软（或其他免杀方式）；</li>
</ul>
<h3 id="渗透步骤（exploit）"><a href="#渗透步骤（exploit）" class="headerlink" title="渗透步骤（exploit）"></a>渗透步骤（exploit）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search xxx		<span class="comment">## 搜索某个漏洞</span></span><br><span class="line">use xxx			<span class="comment">## 使用某个漏洞利用模块</span></span><br><span class="line">show options    	<span class="comment">## 查看配置选项</span></span><br><span class="line"><span class="built_in">set</span> payload		<span class="comment">## 配置攻击载荷</span></span><br><span class="line">exploit			<span class="comment">## 执行渗透攻击</span></span><br></pre></td></tr></table></figure>

<h3 id="参数摘要"><a href="#参数摘要" class="headerlink" title="参数摘要"></a>参数摘要</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">reload_all		<span class="comment">#从目录重载所有模块。导入模块也需要用到此命令。</span></span><br><span class="line">back	<span class="comment">#后退命令，移出当前上下文，用于模块切换</span></span><br><span class="line">info	<span class="comment">#目标和模块详细信息</span></span><br><span class="line">check	<span class="comment">#检查目标是否受某个漏洞影响</span></span><br><span class="line"></span><br><span class="line">sessions		<span class="comment">#会话管理</span></span><br><span class="line">sessions -l		<span class="comment">#列出所有会话</span></span><br><span class="line">sessions -K		<span class="comment">#终止所有会话</span></span><br><span class="line">sessions -i <span class="built_in">id</span>	<span class="comment">#进入某个会话</span></span><br><span class="line">sessions -v		<span class="comment">#以详细模式列出会话</span></span><br><span class="line">sessions -u		<span class="comment">#在许多平台上将shell升级到meterpreter会话</span></span><br><span class="line"></span><br><span class="line">show options	<span class="comment">#显示可选选项</span></span><br><span class="line">	 auxiliary	<span class="comment">#显示所有辅助模块</span></span><br><span class="line">	 exploits	<span class="comment">#显示所有漏洞利用模块</span></span><br><span class="line">	 payloads	<span class="comment">#显示所有有效载荷</span></span><br><span class="line">	 targets	<span class="comment">#显示所有可用目标</span></span><br><span class="line">	 advanced	<span class="comment">#显示更多高级选项</span></span><br><span class="line">	 encoders	<span class="comment">#显示可用编码器列表</span></span><br><span class="line">	 </span><br><span class="line"><span class="built_in">unset</span> [Module Options]    <span class="comment">#清除Module Options</span></span><br></pre></td></tr></table></figure>


<h3 id="脚本使用-高级用法"><a href="#脚本使用-高级用法" class="headerlink" title="脚本使用 (高级用法)"></a>脚本使用 (高级用法)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 搜索关于 afp的脚本</span></span><br><span class="line">nmap --script-help <span class="string">&quot;afp-*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 扫描常见漏洞</span></span><br><span class="line">nmap --script vuln &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查FTP是否开启匿名登陆</span></span><br><span class="line">nmap --script ftp-anon &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 对MySQL进行暴力破解</span></span><br><span class="line">nmap --script=mysql-brute &lt;targetIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 对MsSQL进行暴力破解</span></span><br><span class="line">nmap -p 1433 --script ms-sql-brute --script-args userdb=customuser.txt,passdb=custompass.txt &lt;host&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 利用DNS进行子域名暴力破解</span></span><br><span class="line">nmap --script dns-brute www.baidu.com</span><br></pre></td></tr></table></figure>

<h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 表示方式</span></span><br><span class="line">-iL filename                    从文件中读取待检测的目标,文件中的表示方法支持机名,ip,网段</span><br><span class="line">-iR hostnum                     随机选取,进行扫描.如果-iR指定为0,则是无休止的扫描</span><br><span class="line">--exclude host1[, host2]        从扫描任务中需要排除的主机           </span><br><span class="line">--exculdefile exclude_file      排除文件中的IP,格式和-iL指定扫描文件的格式相同</span><br><span class="line"></span><br><span class="line"><span class="comment">## 主机发现</span></span><br><span class="line">-sL                     仅仅是显示,扫描的IP数目,不会进行任何扫描</span><br><span class="line">-sn                     ping扫描,即主机发现</span><br><span class="line">-Pn                     不检测主机存活</span><br><span class="line">-PS/PA/PU/PY[portlist]  TCP SYN Ping/TCP ACK Ping/UDP Ping发现</span><br><span class="line">-PE/PP/PM               使用ICMP <span class="built_in">echo</span>, timestamp and netmask 请求包发现主机</span><br><span class="line">-PO[prococol list]      使用IP协议包探测对方主机是否开启   </span><br><span class="line">-n/-R                   不对IP进行域名反向解析/为所有的IP都进行域名的反响解析</span><br><span class="line"></span><br><span class="line"><span class="comment">## 扫描技巧</span></span><br><span class="line">-sS/sT/sA/sW/sM                 TCP SYN/TCP connect()/ACK/TCP窗口扫描/TCP Maimon扫描</span><br><span class="line">-sU                             UDP扫描</span><br><span class="line">-sN/sF/sX                       TCP Null，FIN，and Xmas扫描</span><br><span class="line">--scanflags                     自定义TCP包中的flags</span><br><span class="line">-sI zombie host[:probeport]     Idlescan</span><br><span class="line">-sY/sZ                          SCTP INIT/COOKIE-ECHO 扫描</span><br><span class="line">-sO                             使用IP protocol 扫描确定目标机支持的协议类型</span><br><span class="line">-b “FTP relay host”             使用FTP bounce scan</span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定端口 扫描顺序</span></span><br><span class="line">-p                      特定的端口 -p80,443 或者 -p1-65535</span><br><span class="line">-p U:PORT               扫描udp的某个端口, -p U:53</span><br><span class="line">-F                      快速扫描模式,比默认的扫描端口还少</span><br><span class="line">-r                      不随机扫描端口,默认是随机扫描的</span><br><span class="line">--top-ports <span class="string">&quot;number&quot;</span>    扫描开放概率最高的number个端口,出现的概率需要参考nmap-services文件,ubuntu中该文件位于/usr/share/nmap.nmap默认扫前1000个</span><br><span class="line">--port-ratio <span class="string">&quot;ratio&quot;</span>    扫描指定频率以上的端口</span><br><span class="line"></span><br><span class="line"><span class="comment">## 服务版本识别</span></span><br><span class="line">-sV                             开放版本探测,可以直接使用-A同时打开操作系统探测和版本探测</span><br><span class="line">--version-intensity <span class="string">&quot;level&quot;</span>     设置版本扫描强度,强度水平说明了应该使用哪些探测报文。数值越高，服务越有可能被正确识别。默认是7</span><br><span class="line">--version-light                 打开轻量级模式,为--version-intensity 2的别名</span><br><span class="line">--version-all                   尝试所有探测,为--version-intensity 9的别名</span><br><span class="line">--version-trace                 显示出详细的版本侦测过程信息</span><br><span class="line"></span><br><span class="line"><span class="comment">## 脚本扫描</span></span><br><span class="line">-sC                             根据端口识别的服务,调用默认脚本</span><br><span class="line">--script=”Lua scripts”          调用的脚本名</span><br><span class="line">--script-args=n1=v1,[n2=v2]     调用的脚本传递的参数</span><br><span class="line">--script-args-file=filename     使用文本传递参数</span><br><span class="line">--script-trace                  显示所有发送和接收到的数据</span><br><span class="line">--script-updatedb               更新脚本的数据库</span><br><span class="line">--script-help=”Lua script”      显示指定脚本的帮助</span><br><span class="line"></span><br><span class="line"><span class="comment">## OS识别</span></span><br><span class="line">-O              启用操作系统检测,-A来同时启用操作系统检测和版本检测</span><br><span class="line">--osscan-limit  针对指定的目标进行操作系统检测(至少需确知该主机分别有一个open和closed的端口)</span><br><span class="line">--osscan-guess  推测操作系统检测结果,当Nmap无法确定所检测的操作系统时，会尽可能地提供最相近的匹配，Nmap默认进行这种匹配</span><br><span class="line">防火墙/IDS躲避和哄骗</span><br><span class="line">-f; --mtu value                 指定使用分片、指定数据包的MTU.</span><br><span class="line">-D decoy1,decoy2,ME             使用诱饵隐蔽扫描</span><br><span class="line">-S IP-ADDRESS                   源地址欺骗</span><br><span class="line">-e interface                    使用指定的接口</span><br><span class="line">-g/ --source-port PROTNUM       使用指定源端口  </span><br><span class="line">--proxies url1,[url2],...       使用HTTP或者SOCKS4的代理</span><br><span class="line"></span><br><span class="line">--data-length NUM               填充随机数据让数据包长度达到NUM</span><br><span class="line">--ip-options OPTIONS            使用指定的IP选项来发送数据包</span><br><span class="line">--ttl VALUE                     设置IP time-to-live域</span><br><span class="line">--spoof-mac ADDR/PREFIX/VEBDOR  MAC地址伪装</span><br><span class="line">--badsum                        使用错误的checksum来发送数据包</span><br><span class="line">Nmap 输出</span><br><span class="line">-oN                     将标准输出直接写入指定的文件</span><br><span class="line">-oX                     输出xml文件</span><br><span class="line">-oS                     将所有的输出都改为大写</span><br><span class="line">-oG                     输出便于通过bash或者perl处理的格式,非xml</span><br><span class="line">-oA BASENAME            可将扫描结果以标准格式、XML格式和Grep格式一次性输出</span><br><span class="line">-v                      提高输出信息的详细度</span><br><span class="line">-d level                设置debug级别,最高是9</span><br><span class="line">--reason                显示端口处于带确认状态的原因</span><br><span class="line">--open                  只输出端口状态为open的端口</span><br><span class="line">--packet-trace          显示所有发送或者接收到的数据包</span><br><span class="line">--iflist                显示路由信息和接口,便于调试</span><br><span class="line">--log-errors            把日志等级为errors/warings的日志输出</span><br><span class="line">--append-output         追加到指定的文件</span><br><span class="line">--resume FILENAME       恢复已停止的扫描</span><br><span class="line">--stylesheet PATH/URL   设置XSL样式表，转换XML输出</span><br><span class="line">--webxml                从namp.org得到XML的样式</span><br><span class="line">--no-sytlesheet         忽略XML声明的XSL样式表</span><br><span class="line"></span><br><span class="line"><span class="comment">## nmap选项</span></span><br><span class="line">-6                      开启IPv6</span><br><span class="line">-A                      OS识别,版本探测,脚本扫描和traceroute</span><br><span class="line">--datedir DIRNAME       说明用户Nmap数据文件位置</span><br><span class="line">--send-eth / --send-ip  使用原以太网帧发送/在原IP层发送</span><br><span class="line">--privileged            假定用户具有全部权限</span><br><span class="line">--unprovoleged          假定用户不具有全部权限,创建原始套接字需要root权限</span><br><span class="line">-V                      打印版本信息</span><br><span class="line">-h                      输出帮助</span><br></pre></td></tr></table></figure>

<p>引用<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2090727">https://cloud.tencent.com/developer/article/2090727</a><br><a target="_blank" rel="noopener" href="https://sh1yan.top/2019/07/28/MSF-Command-Notes/">https://sh1yan.top/2019/07/28/MSF-Command-Notes/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LyShark/p/12189163.html">https://www.cnblogs.com/LyShark/p/12189163.html</a><br><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/tools/metasploit.html">https://wiki.wgpsec.org/knowledge/tools/metasploit.html</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/mongodb/">
                MongoDB
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/数据库/">数据库</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#1">基础</a><ul>
<li><a href="#1.1">MySQL和mongodb的区别</a></li>
<li><a href="#1.1">分析器在MongoDB中的作用</a></li>
<li><a href="#1.1">名字空间(namespace)是</a></li>
<li><a href="#1.1">如果用户移除对象的属性，该属性是否从存储层中删除</a></li>
<li><a href="#1.1">允许空值null吗</a></li>
<li><a href="#1.1">更新操作立刻fsync到磁盘</a></li>
<li><a href="#1.1">如何执行事务&#x2F;加锁</a></li>
<li><a href="#1.1">数据文件如此庞大</a></li>
<li><a href="#1.1">启用备份故障恢复需要多久</a></li>
<li><a href="#1.1">什么是master或primary</a></li>
<li><a href="#1.1">什么是secondary或slave</a></li>
<li><a href="#1.1">我必须调用getLastError来确保写操作生效了么</a></li>
<li><a href="#1.1">分片(sharding)和复制(replication)是怎样工作的</a></li>
<li><a href="#1.1">数据在什么时候才会扩展到多个分片(shard)里</a></li>
</ul>
</li>
</ul>
<p>非关系型数据库 -&gt; 文档数据库<br>可提供高性能，高可用性和易扩展性。<br>数据模型实现，接口，对想存储以及复制方法</p>
<p>GridFS是一种将大型文件存储在MongoDB的文件规范。 所有官方支持的驱动均实现了GridFS规范。 GridFS是MongoDB中的一个内置功能，可以用于存放文件。 数据库支持以(BSON格式<code>Binary JSON</code>)保存二进制对象。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><table>
<thead>
<tr>
<th>SQL术语&#x2F;概念</th>
<th>MongoDB 术语&#x2F;概念</th>
<th>解释&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表&#x2F;集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行&#x2F;文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段&#x2F;域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接,MongoDB不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<h2 id="MySQL和mongodb的区别"><a href="#MySQL和mongodb的区别" class="headerlink" title="MySQL和mongodb的区别"></a>MySQL和mongodb的区别</h2><table>
<thead>
<tr>
<th>形式</th>
<th>MongoDB</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>数据库模型</td>
<td>非关系型</td>
<td>关系型</td>
</tr>
<tr>
<td>存储方式</td>
<td></td>
<td>虚拟内存+持久化</td>
</tr>
<tr>
<td>查询语句</td>
<td>独特的MongoDB查询方式</td>
<td>传统SQL语句</td>
</tr>
<tr>
<td>架构特点</td>
<td>副本集以及分片</td>
<td>常见单点、M-S、MHA、MMM等架构方式</td>
</tr>
<tr>
<td>数据处理方式</td>
<td>基于内存，将热数据存在物理内存中，从而达到高速读写</td>
<td>不同的引擎拥有自己的特点</td>
</tr>
<tr>
<td>使用场景</td>
<td>事件的记录，内容管理或者博客平台等数据大且非结构化数据的场景</td>
<td>适用于数据量少且很多结构化数据</td>
</tr>
</tbody></table>
<p>索引类型</p>
<ul>
<li>单字段索引(Single Field Indexes)</li>
<li>复合索引(Compound Indexes)</li>
<li>多键索引(Multikey Indexes)</li>
<li>全文索引(text Indexes)</li>
<li>Hash 索引(Hash Indexes)</li>
<li>通配符索引(Wildcard Index)</li>
<li>2dsphere索引(2dsphere Indexes)</li>
</ul>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 批量更新 click, favorite, love, notlove</span></span><br><span class="line">db.getCollection(<span class="string">&quot;post&quot;</span>).updateMany(&#123; <span class="variable">$set</span>: &#123;</span><br><span class="line">        click: 0,</span><br><span class="line">        favorite: 0,</span><br><span class="line">        love: 0,</span><br><span class="line">        notlove:0</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询age字段不存在并且批量更新为1</span></span><br><span class="line">db.getCollection(<span class="string">&quot;users&quot;</span>).updateMany(</span><br><span class="line">    &#123; age: &#123; <span class="variable">$exists</span>: <span class="literal">false</span> &#125; &#125;, </span><br><span class="line">    &#123; <span class="variable">$set</span>: &#123; age: 18 &#125; &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h3><ul>
<li>导入 - 多集合</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置部分</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span> </span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span> </span><br><span class="line">DATABASE=<span class="string">&quot;&quot;</span> </span><br><span class="line">FOLDER_PATH=<span class="string">&quot;/data/db/backup_dev_20250115&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历文件夹 </span></span><br><span class="line"><span class="keyword">for</span> DIR <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$FOLDER_PATH</span>&quot;</span>/*/; <span class="keyword">do</span> </span><br><span class="line">	COLLECTION_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$DIR</span>&quot;</span>) </span><br><span class="line">	mongorestore --db <span class="variable">$COLLECTION_NAME</span> <span class="variable">$DIR</span>  -j 100</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有文件导入完成！&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>备份-多集合</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置部分</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/data/db/dbback&quot;</span>        <span class="comment"># 备份存储目录</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span>           <span class="comment"># MongoDB 主机</span></span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span>               <span class="comment"># MongoDB 端口</span></span><br><span class="line">PJ=<span class="string">&quot;dev&quot;</span>                        <span class="comment"># 项目名称</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d)             <span class="comment"># 当前日期，格式为 YYYYMMDD</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_.log&quot;</span>  <span class="comment"># 日志文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要排除的集合（可以根据需要修改）</span></span><br><span class="line">EXCLUDE_COLLECTIONS=(<span class="string">&quot;app_log&quot;</span> <span class="string">&quot;comics_history&quot;</span> <span class="string">&quot;movie_history&quot;</span> <span class="string">&quot;novel_history&quot;</span> <span class="string">&quot;post_history&quot;</span>)  <span class="comment"># 这里列出所有需要排除的集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接排除集合的参数</span></span><br><span class="line">EXCLUDE_PARAMS=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> collection <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;EXCLUDE_COLLECTIONS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    EXCLUDE_PARAMS=<span class="string">&quot;<span class="variable">$EXCLUDE_PARAMS</span> --excludeCollection=<span class="variable">$collection</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有数据库的列表，并排除 local 数据库</span></span><br><span class="line">DATABASES=“”</span><br><span class="line"><span class="comment"># 检查mongo命令是否存在并获取版本信息 </span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v mongo &amp;&gt; /dev/null; <span class="keyword">then</span> </span><br><span class="line">    DATABASES=$(mongo --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> --quiet --<span class="built_in">eval</span> <span class="string">&quot;db.adminCommand(&#x27;listDatabases&#x27;).databases.map(function(d) &#123; return d.name; &#125;).filter(function(name) &#123; return name != &#x27;local&#x27;; &#125;).join(&#x27; &#x27;);&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v mongosh &amp;&gt; /dev/null; <span class="keyword">then</span> </span><br><span class="line">    DATABASES=$(mongosh --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> --quiet --<span class="built_in">eval</span> <span class="string">&quot;db.adminCommand(&#x27;listDatabases&#x27;).databases.map(function(d) &#123; return d.name; &#125;).filter(function(name) &#123; return name != &#x27;local&#x27;; &#125;).join(&#x27; &#x27;);&quot;</span>)</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MongoDB未安装或未在PATH中找到。&quot;</span> </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份目标文件夹</span></span><br><span class="line">BACKUP_PATH=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志记录函数</span></span><br><span class="line"><span class="function"><span class="title">log_msg</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$1</span>&quot;</span> | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有数据库进行备份</span></span><br><span class="line"><span class="keyword">for</span> DB_NAME <span class="keyword">in</span> <span class="variable">$DATABASES</span>; <span class="keyword">do</span></span><br><span class="line">    log_msg <span class="string">&quot;开始备份数据库 <span class="variable">$DB_NAME</span>...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行备份</span></span><br><span class="line">    mongodump --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> --db <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span> --out <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span> <span class="variable">$EXCLUDE_PARAMS</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        log_msg <span class="string">&quot;数据库 <span class="variable">$DB_NAME</span> 备份成功！&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        log_msg <span class="string">&quot;数据库 <span class="variable">$DB_NAME</span> 备份失败！&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建压缩包并删除备份文件夹</span></span><br><span class="line">log_msg <span class="string">&quot;开始创建压缩包...&quot;</span></span><br><span class="line">tar -zcvf <span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.tar.gz&quot;</span> -C <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除7天前的备份</span></span><br><span class="line">log_msg <span class="string">&quot;删除超过7天的旧备份...&quot;</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -<span class="built_in">type</span> f -name <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_*.tar.gz&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \; &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -<span class="built_in">type</span> d -name <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \; &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">log_msg <span class="string">&quot;备份完成，过期备份清理完成！&quot;</span></span><br></pre></td></tr></table></figure>

<p>聚合</p>
<p>mongodb 副本集的主的选举–优先级设置</p>
<p>分片<br>复制集</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904186300071943">https://juejin.cn/post/6844904186300071943</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2025/05/29/mysql-MyISAM-InnoDB/">
                Mysql-MyISAM与InnoDB对比及用法
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-05-29</span>
            
            
            
                <span class="category">
                    <a href="/categories/数据库/">数据库</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <ul>
<li><a href="#1">MyISAM 和 InnoDB区别</a></li>
<li><a href="#2">事务的四大特征 (ACID)</a></li>
<li><a href="#3">锁的重要性</a></li>
</ul>
<h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2><h3 id="1">MyISAM 与 InnoDB 对比</h3>

<table>
<thead>
<tr>
<th>特性</th>
<th>InnoDB</th>
<th>MyISAM</th>
</tr>
</thead>
<tbody><tr>
<td>事务支持</td>
<td>支持事务，ACID 兼容</td>
<td>不支持事务</td>
</tr>
<tr>
<td>锁机制</td>
<td>行级锁，高并发性能优越</td>
<td>表级锁，低并发性能</td>
</tr>
<tr>
<td>数据完整性</td>
<td>支持外键和崩溃恢复</td>
<td>不支持外键和崩溃恢复</td>
</tr>
<tr>
<td>读写性能</td>
<td>适合高并发写操作，性能稳定</td>
<td>适合读密集操作，性能高</td>
</tr>
<tr>
<td>全文索引</td>
<td>支持（MySQL 5.6+）</td>
<td>原生支持</td>
</tr>
<tr>
<td>恢复机制</td>
<td>崩溃后自动恢复数据</td>
<td>需要手动修复</td>
</tr>
<tr>
<td>磁盘空间使用</td>
<td>相对占用更多内存和磁盘空间</td>
<td>占用较少内存和磁盘空间</td>
</tr>
<tr>
<td>适用场景</td>
<td>高并发、事务处理、数据安全性高的应用</td>
<td>读多写少的应用，数据分析和归档</td>
</tr>
</tbody></table>
<h3 id="关于数据插入错误时进行数据回滚-配合后端try-catch"><a href="#关于数据插入错误时进行数据回滚-配合后端try-catch" class="headerlink" title="关于数据插入错误时进行数据回滚 - 配合后端try catch"></a>关于数据插入错误时进行数据回滚 - 配合后端try catch</h3><h5 id="1-mysql-默认为把需要的table-转成InnoDB"><a href="#1-mysql-默认为把需要的table-转成InnoDB" class="headerlink" title="1.mysql 默认为把需要的table 转成InnoDB"></a>1.mysql 默认为把需要的table 转成InnoDB</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tag engine=innodb;</span><br></pre></td></tr></table></figure>

<h5 id="2-查看事务"><a href="#2-查看事务" class="headerlink" title="2.查看事务"></a>2.查看事务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from information_schema.innodb_trx\G;</span><br></pre></td></tr></table></figure>

<h5 id="3-mysql事务基本逻辑"><a href="#3-mysql事务基本逻辑" class="headerlink" title="3.mysql事务基本逻辑"></a>3.mysql事务基本逻辑</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 开启事务</span><br><span class="line">begin;  <span class="comment"># 或者下面的语句  </span></span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line">-- 写需求逻辑</span><br><span class="line"></span><br><span class="line">-- 事务回滚(回滚到之前的状态,并关闭事务)</span><br><span class="line">rollback;  <span class="comment"># 回滚 + 关闭</span></span><br><span class="line"></span><br><span class="line">-- 事务提交(将修改提交,并关闭事务)</span><br><span class="line">commit;    <span class="comment"># 提交 + 关闭</span></span><br></pre></td></tr></table></figure>

<h5 id="4-配合mysql事务"><a href="#4-配合mysql事务" class="headerlink" title="4.配合mysql事务"></a>4.配合mysql事务</h5><p>例子与thinkphp为例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 启动事务</span><br><span class="line">Db::startTrans();</span><br><span class="line">try &#123;</span><br><span class="line">    Db::table(<span class="string">&#x27;think_user&#x27;</span>)-&gt;find(1);</span><br><span class="line">    Db::table(<span class="string">&#x27;think_user&#x27;</span>)-&gt;delete(1);</span><br><span class="line">    // 提交事务</span><br><span class="line">    Db::commit();</span><br><span class="line">&#125; catch (\Exception <span class="variable">$e</span>) &#123;</span><br><span class="line">    // 回滚事务</span><br><span class="line">    Db::rollback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2">事务隔离级别</h3>

<h4 id="ACID四种隔离界别："><a href="#ACID四种隔离界别：" class="headerlink" title="ACID四种隔离界别："></a>ACID四种隔离界别：</h4><ul>
<li>Read Uncommit (读取未提交内容)</li>
<li>Read Commit (读取提交内容)</li>
<li>Repeatable Read (可重复读)</li>
<li>Serializable (可串行化)</li>
</ul>
<h5 id="1-查看数据库版本"><a href="#1-查看数据库版本" class="headerlink" title="1.查看数据库版本"></a>1.查看数据库版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();</span><br></pre></td></tr></table></figure>

<h5 id="2-查看隔离级别"><a href="#2-查看隔离级别" class="headerlink" title="2.查看隔离级别"></a>2.查看隔离级别</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- MySQL8.0+：</span><br><span class="line">-- 查看当前会话隔离级别</span><br><span class="line"><span class="keyword">select</span> @@transaction_isolation;</span><br><span class="line">-- 查看系统当前隔离级别</span><br><span class="line"><span class="keyword">select</span> @@global.transaction_isolation;</span><br><span class="line"> </span><br><span class="line">-- MySQL5.0+：</span><br><span class="line">-- 查看当前会话隔离级别</span><br><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br><span class="line">-- 查看系统当前隔离级别</span><br><span class="line"><span class="keyword">select</span> @@global.tx_isolation;</span><br></pre></td></tr></table></figure>


<h3 id="锁奥义"><a href="#锁奥义" class="headerlink" title="锁奥义"></a><h3 id="3">锁奥义</h3></h3><blockquote>
<p>查看当前出现的锁</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from information_schema.innodb_locks\G;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like <span class="string">&#x27;innodb_row_lock_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="1-互斥锁与自旋锁"><a href="#1-互斥锁与自旋锁" class="headerlink" title="1.互斥锁与自旋锁"></a>1.互斥锁与自旋锁</h5><ul>
<li><p><code>互斥锁</code>加锁失败后，线程会释放 CPU ，给其他线程；</p>
<p>  互斥锁是一种「独占锁」，比如当线程 A 加锁成功后，此时互斥锁已经被线程 A 独占了，只要线程 A 没有释放手中的锁，线程 B 加锁就会失败，于是就会释放 CPU 让给其他线程，既然线程 B 释放掉了 CPU，自然线程 B 加锁的代码就会被阻塞。</p>
</li>
</ul>
<p><img src="/images/%E4%BA%92%E6%96%A5%E9%94%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="互斥锁"></p>
<ul>
<li><p><code>自旋锁</code>加锁失败后，线程会忙等待，直到它拿到锁；</p>
<p>  自旋锁是通过 CPU 提供的 CAS 函数（Compare And Swap），在「用户态」完成加锁和解锁操作，不会主动产生线程上下文切换，所以相比互斥锁来说，会快一些，开销也小一些。</p>
<p>  一般加锁的过程，包含两个步骤：</p>
<p>  第一步，查看锁的状态，如果锁是空闲的，则执行第二步；<br>  第二步，将锁设置为当前线程持有；</p>
<p>  CAS 函数就把这两个步骤合并成一条硬件级指令，形成原子指令，这样就保证了这两个步骤是不可分割的，要么一次性执行完两个步骤，要么两个步骤都不执行</p>
<p>  使用自旋锁的时候，当发生多线程竞争锁的情况，加锁失败的线程会「忙等待」，直到它拿到锁。这里的「忙等待」可以用 while 循环等待实现，不过最好是使用 CPU 提供的 PAUSE 指令来实现「忙等待」，因为可以减少循环等待时的耗电量</p>
<p>  自旋锁是最比较简单的一种锁，一直自旋，利用 CPU 周期，直到锁可用。需要注意，在单核 CPU 上，需要抢占式的调度器（即不断通过时钟中断一个线程，运行其他线程）。否则，自旋锁在单 CPU 上无法使用，因为一个自旋的线程永远不会放弃 CPU。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>特性</th>
<th>互斥锁</th>
<th>自旋锁</th>
</tr>
</thead>
<tbody><tr>
<td>性能开销成本</td>
<td>当两个线程是属于同一个进程，因为虚拟内存是共享的，所以在切换时，虚拟内存这些资源就保持不动，只需要切换线程的私有数据、寄存器等不共享的数据</td>
<td>需要注意，在单核 CPU 上，需要抢占式的调度器（即不断通过时钟中断一个线程，运行其他线程）。否则，自旋锁在单 CPU 上无法使用，因为一个自旋的线程永远不会放弃 CPU</td>
</tr>
</tbody></table>
<h5 id="2-读写锁：读和写还有优先级区分"><a href="#2-读写锁：读和写还有优先级区分" class="headerlink" title="2.读写锁：读和写还有优先级区分"></a>2.读写锁：读和写还有优先级区分</h5><p>由「读锁」和「写锁」两部分构成，如果只读取共享资源用「读锁」加锁，如果要修改共享资源则用「写锁」加锁</p>
<p>工作原理：<br>当写锁没有被线程持有时，多个线程可以并发地持有读锁，但是当写锁被线程持有后，其他线程获取读锁和写锁的操作都会阻塞</p>
<blockquote>
<p><code>读优先锁</code></p>
</blockquote>
<p><img src="/images/%E8%AF%BB%E4%BC%98%E5%85%88%E9%94%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="读优先锁"></p>
<blockquote>
<p><code>写优先锁</code></p>
</blockquote>
<p><img src="/images/%E5%86%99%E4%BC%98%E5%85%88%E9%94%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="写优先锁"></p>
<blockquote>
<p>但是这两种都会造成线程“饥饿”的问题，比如</p>
<ul>
<li>读优先锁：一直有读线程获取读锁，那么写线程将永远获取不到，造成写线程“饥饿”。 </li>
<li>写优先锁：如果⼀直有写线程获取写锁，读线程也会被「饿死」。</li>
</ul>
</blockquote>
<p>所以我们可以搞一个公平读写锁<br>公平读写锁⽐较简单的⼀种⽅式是：⽤队列把获取锁的线程排队，不管是写线程还是读线程都按照先进先出的原则加锁即可，这样读线程仍然可以并发，也不会出现「饥饿」的现象。</p>
<h5 id="3-乐观锁与悲观锁"><a href="#3-乐观锁与悲观锁" class="headerlink" title="3.乐观锁与悲观锁"></a>3.乐观锁与悲观锁</h5><p>前面提到的互斥锁、自旋锁、读写锁，都是属于悲观锁。</p>
<blockquote>
<ul>
<li><p>悲观锁：认为多线程同时修改共享资源的概率⽐较⾼，于是很容易出现冲突，所以访问共享资源前，先要上锁。</p>
</li>
<li><p>前⾯提到的互斥锁、⾃旋锁、读写锁，都是属于悲观锁。</p>
</li>
<li><p>乐观锁：假定冲突的概率很低，它的⼯作⽅式是：先修改完共享资源，再验证这段时间内有没有发⽣冲突，如果没有其他线程在修改资源，那么操作完成，如果发现有其他线程已经修改过这个资源，就放弃本次操作。另外虽然叫锁，但是乐观锁全程并没有加锁，所以它也叫⽆锁编程。</p>
</li>
</ul>
</blockquote>
<p>一般会使用版本号机制或CAS算法实现</p>
<h5 id="4-解决死锁问题"><a href="#4-解决死锁问题" class="headerlink" title="4.解决死锁问题"></a>4.解决死锁问题</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show processlist; <span class="comment"># 只列出前100条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果是root帐号，你能看到所有用户的当前连接。如果是其它普通帐号，只能看到自己占用的连接</span></span><br><span class="line">show full processlist</span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> [<span class="built_in">id</span>] <span class="comment"># 杀进程</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">show status; <span class="comment"># 查看状态</span></span><br><span class="line"></span><br><span class="line">show status like <span class="string">&#x27;%下面变量%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Aborted_clients <span class="comment"># 由于客户没有正确关闭连接已经死掉，已经放弃的连接数量。</span></span><br><span class="line">Aborted_connects <span class="comment"># 尝试已经失败的MySQL服务器的连接的次数。</span></span><br><span class="line">Connections <span class="comment"># 试图连接MySQL服务器的次数。</span></span><br><span class="line">Created_tmp_tables <span class="comment"># 当执行语句时，已经被创造了的隐含临时表的数量。</span></span><br><span class="line">Delayed_insert_threads <span class="comment"># 正在使用的延迟插入处理器线程的数量。</span></span><br><span class="line">Delayed_writes <span class="comment"># 用INSERT DELAYED写入的行数。</span></span><br><span class="line">Delayed_errors <span class="comment"># 用INSERT DELAYED写入的发生某些错误(可能重复键值)的行数。</span></span><br><span class="line">Flush_commands <span class="comment"># 执行FLUSH命令的次数。</span></span><br><span class="line">Handler_delete <span class="comment"># 请求从一张表中删除行的次数。</span></span><br><span class="line">Handler_read_first <span class="comment"># 请求读入表中第一行的次数。</span></span><br><span class="line">Handler_read_key <span class="comment"># 请求数字基于键读行。</span></span><br><span class="line">Handler_read_next <span class="comment"># 请求读入基于一个键的一行的次数。</span></span><br><span class="line">Handler_read_rnd <span class="comment"># 请求读入基于一个固定位置的一行的次数。</span></span><br><span class="line">Handler_update <span class="comment"># 请求更新表中一行的次数。</span></span><br><span class="line">Handler_write <span class="comment"># 请求向表中插入一行的次数。&lt;</span></span><br><span class="line">Key_blocks_used <span class="comment"># 用于关键字缓存的块的数量。</span></span><br><span class="line">Key_read_requests <span class="comment"># 请求从缓存读入一个键值的次数。</span></span><br><span class="line">Key_reads <span class="comment"># 从磁盘物理读入一个键值的次数。</span></span><br><span class="line">Key_write_requests <span class="comment"># 请求将一个关键字块写入缓存次数。</span></span><br><span class="line">Key_writes <span class="comment"># 将一个键值块物理写入磁盘的次数。</span></span><br><span class="line">Max_used_connections <span class="comment"># 同时使用的连接的最大数目。</span></span><br><span class="line">Not_flushed_key_blocks <span class="comment"># 在键缓存中已经改变但是还没被清空到磁盘上的键块</span></span><br><span class="line">Not_flushed_delayed_rows <span class="comment"># 在INSERT DELAY队列中等待写入的行的数量。</span></span><br><span class="line">Open_tables <span class="comment"># 打开表的数量。</span></span><br><span class="line">Open_files <span class="comment"># 打开文件的数量。</span></span><br><span class="line">Open_streams <span class="comment"># 打开流的数量(主要用于日志记载）</span></span><br><span class="line">Opened_tables <span class="comment"># 已经打开的表的数量。</span></span><br><span class="line">Questions <span class="comment"># 发往服务器的查询的数量。</span></span><br><span class="line">Slow_queries <span class="comment"># 要花超过long_query_time时间的查询数量。</span></span><br><span class="line">Threads_connected <span class="comment"># 当前打开的连接的数量。</span></span><br><span class="line">Threads_running <span class="comment"># 不在睡眠的线程数量。</span></span><br><span class="line">Uptime <span class="comment"># 服务器工作了多少秒。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/5/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    Respect All Fear None. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2025/05/29/seo/">SEO</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/05/29/shell/">Shell</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/05/29/social-engineering/">社工库工具</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/05/29/software-structure/">软件架构演变</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/Blog/">Blog</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/DIY/">DIY</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E7%9F%A5/">知</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E8%AF%AD%E8%A8%80/">语言</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @4ck. All right reserved | Design & Hexo 0rz33
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Searching -->
<!-- <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> -->

<script src="/js/search.js"></script>


<!-- Mermaid -->
<script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
<script>
  if (window.mermaid) {
    mermaid.initialize({theme: 'dark'});
  }
</script>

<!-- Disqus Comments -->



</body>

</html>