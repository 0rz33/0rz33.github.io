<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="åŸºç¡€
MySQLå’Œmongodbçš„åŒºåˆ«
CRUD
èšåˆæŸ¥è¯¢
é«˜çº§æŸ¥è¯¢ lookup
é«˜çº§æŸ¥è¯¢ lookup + pipeline




æ•°æ®è¿ç§»  

éå…³ç³»å‹æ•°æ®åº“ -&amp;gt; æ–‡æ¡£æ•°æ®åº“å¯æä¾›é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨æ€§å’Œæ˜“æ‰©å±•æ€§ã€‚æ•°æ®æ¨¡å‹å®ç°ï¼Œæ¥å£ï¼Œå¯¹æƒ³å­˜å‚¨ä»¥åŠå¤åˆ¶æ–¹æ³•
GridFSæ˜¯ä¸€ç§å°†å¤§å‹æ–‡ä»¶å­˜å‚¨">
    

    <!--Author-->
    
        <meta name="author" content="4ckU">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="MongoDB"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="0rz33"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>MongoDB - 0rz33</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Searching-->
<div class="search-bg">
    <div class="search-container">
            <div class="alpha-search">
                <form class="site-search-form">
                    <input type="text" id="local-search-input" class="st-search-input" />
                </form>
                <div id="local-search-result">
                </div>
            </div>
        </div>
    </div>
</div> 

<!--Hamburger Icon-->
<search>
    <a href="#search"></a>
</search>
<nav>
    <a href="#menu"></a>
</nav>

<!-- æ‰§è¡Œæœ¬åœ°æœç´¢è„šæœ¬ -->
<script>
    var inputArea = document.querySelector("#local-search-input");
    var getSearchFile = function(){
        var path = "/search.xml";
        searchFunc(path, 'local-search-input', 'local-search-result');
    }
    inputArea.onfocus = function(){ getSearchFile() }
    inputArea.onkeydown = function(){ if(event.keyCode==13) return false}
</script>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2025/11/27/mongodb/">
                MongoDB
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2025-11-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/æ•°æ®åº“/">æ•°æ®åº“</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <ul>
<li><a href="#%E5%9F%BA%E7%A1%80">åŸºç¡€</a><ul>
<li><a href="#MySQL%E5%92%8Cmongodb%E7%9A%84%E5%8C%BA%E5%88%AB">MySQLå’Œmongodbçš„åŒºåˆ«</a></li>
<li><a href="#CRUD">CRUD</a></li>
<li><a href="#%E8%81%9A%E5%90%88">èšåˆæŸ¥è¯¢</a><ul>
<li><a href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2-lookup">é«˜çº§æŸ¥è¯¢ lookup</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2-lookup-+-pipeline">é«˜çº§æŸ¥è¯¢ lookup + pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">æ•°æ®è¿ç§»</a>  <!-- * [åˆ†æå™¨åœ¨MongoDBä¸­çš„ä½œç”¨](#1.1)
  * [åå­—ç©ºé—´(namespace)æ˜¯](#1.1)
  * [å¦‚æœç”¨æˆ·ç§»é™¤å¯¹è±¡çš„å±æ€§ï¼Œè¯¥å±æ€§æ˜¯å¦ä»å­˜å‚¨å±‚ä¸­åˆ é™¤](#1.1)
  * [å…è®¸ç©ºå€¼nullå—](#1.1)
  * [æ›´æ–°æ“ä½œç«‹åˆ»fsyncåˆ°ç£ç›˜](#1.1)
  * [å¦‚ä½•æ‰§è¡Œäº‹åŠ¡/åŠ é”](#1.1)
  * [æ•°æ®æ–‡ä»¶å¦‚æ­¤åºå¤§](#1.1)
  * [å¯ç”¨å¤‡ä»½æ•…éšœæ¢å¤éœ€è¦å¤šä¹…](#1.1)
  * [ä»€ä¹ˆæ˜¯masteræˆ–primary](#1.1)
  * [ä»€ä¹ˆæ˜¯secondaryæˆ–slave](#1.1)
  * [æˆ‘å¿…é¡»è°ƒç”¨getLastErroræ¥ç¡®ä¿å†™æ“ä½œç”Ÿæ•ˆäº†ä¹ˆ](#1.1)
  * [åˆ†ç‰‡(sharding)å’Œå¤åˆ¶(replication)æ˜¯æ€æ ·å·¥ä½œçš„](#1.1)
  * [æ•°æ®åœ¨ä»€ä¹ˆæ—¶å€™æ‰ä¼šæ‰©å±•åˆ°å¤šä¸ªåˆ†ç‰‡(shard)é‡Œ](#1.1) --></li>
</ul>
<p>éå…³ç³»å‹æ•°æ®åº“ -&gt; æ–‡æ¡£æ•°æ®åº“<br>å¯æä¾›é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨æ€§å’Œæ˜“æ‰©å±•æ€§ã€‚<br>æ•°æ®æ¨¡å‹å®ç°ï¼Œæ¥å£ï¼Œå¯¹æƒ³å­˜å‚¨ä»¥åŠå¤åˆ¶æ–¹æ³•</p>
<p>GridFSæ˜¯ä¸€ç§å°†å¤§å‹æ–‡ä»¶å­˜å‚¨åœ¨MongoDBçš„æ–‡ä»¶è§„èŒƒã€‚ æ‰€æœ‰å®˜æ–¹æ”¯æŒçš„é©±åŠ¨å‡å®ç°äº†GridFSè§„èŒƒã€‚ GridFSæ˜¯MongoDBä¸­çš„ä¸€ä¸ªå†…ç½®åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºå­˜æ”¾æ–‡ä»¶ã€‚ æ•°æ®åº“æ”¯æŒä»¥(BSONæ ¼å¼<code>Binary JSON</code>)ä¿å­˜äºŒè¿›åˆ¶å¯¹è±¡ã€‚</p>
<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><table>
<thead>
<tr>
<th>SQLæœ¯è¯­&#x2F;æ¦‚å¿µ</th>
<th>MongoDB æœ¯è¯­&#x2F;æ¦‚å¿µ</th>
<th>è§£é‡Š&#x2F;è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>æ•°æ®åº“</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>æ•°æ®åº“è¡¨&#x2F;é›†åˆ</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>æ•°æ®è®°å½•è¡Œ&#x2F;æ–‡æ¡£</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>æ•°æ®å­—æ®µ&#x2F;åŸŸ</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>ç´¢å¼•</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>è¡¨è¿æ¥,MongoDBä¸æ”¯æŒ</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>ä¸»é”®,MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”®</td>
</tr>
</tbody></table>
<h2 id="MySQLå’Œmongodbçš„åŒºåˆ«"><a href="#MySQLå’Œmongodbçš„åŒºåˆ«" class="headerlink" title="MySQLå’Œmongodbçš„åŒºåˆ«"></a>MySQLå’Œmongodbçš„åŒºåˆ«</h2><table>
<thead>
<tr>
<th>å½¢å¼</th>
<th>MongoDB</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®åº“æ¨¡å‹</td>
<td>éå…³ç³»å‹</td>
<td>å…³ç³»å‹</td>
</tr>
<tr>
<td>å­˜å‚¨æ–¹å¼</td>
<td></td>
<td>è™šæ‹Ÿå†…å­˜+æŒä¹…åŒ–</td>
</tr>
<tr>
<td>æŸ¥è¯¢è¯­å¥</td>
<td>ç‹¬ç‰¹çš„MongoDBæŸ¥è¯¢æ–¹å¼</td>
<td>ä¼ ç»ŸSQLè¯­å¥</td>
</tr>
<tr>
<td>æ¶æ„ç‰¹ç‚¹</td>
<td>å‰¯æœ¬é›†ä»¥åŠåˆ†ç‰‡</td>
<td>å¸¸è§å•ç‚¹ã€M-Sã€MHAã€MMMç­‰æ¶æ„æ–¹å¼</td>
</tr>
<tr>
<td>æ•°æ®å¤„ç†æ–¹å¼</td>
<td>åŸºäºå†…å­˜ï¼Œå°†çƒ­æ•°æ®å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œä»è€Œè¾¾åˆ°é«˜é€Ÿè¯»å†™</td>
<td>ä¸åŒçš„å¼•æ“æ‹¥æœ‰è‡ªå·±çš„ç‰¹ç‚¹</td>
</tr>
<tr>
<td>ä½¿ç”¨åœºæ™¯</td>
<td>äº‹ä»¶çš„è®°å½•ï¼Œå†…å®¹ç®¡ç†æˆ–è€…åšå®¢å¹³å°ç­‰æ•°æ®å¤§ä¸”éç»“æ„åŒ–æ•°æ®çš„åœºæ™¯</td>
<td>é€‚ç”¨äºæ•°æ®é‡å°‘ä¸”å¾ˆå¤šç»“æ„åŒ–æ•°æ®</td>
</tr>
</tbody></table>
<p>ç´¢å¼•ç±»å‹</p>
<ul>
<li>å•å­—æ®µç´¢å¼•(Single Field Indexes)</li>
<li>å¤åˆç´¢å¼•(Compound Indexes)</li>
<li>å¤šé”®ç´¢å¼•(Multikey Indexes)</li>
<li>å…¨æ–‡ç´¢å¼•(text Indexes)</li>
<li>Hash ç´¢å¼•(Hash Indexes)</li>
<li>é€šé…ç¬¦ç´¢å¼•(Wildcard Index)</li>
<li>2dsphereç´¢å¼•(2dsphere Indexes)</li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## æ‰¹é‡æ›´æ–° click, favorite, love, notlove</span></span><br><span class="line">db.getCollection(<span class="string">&quot;post&quot;</span>).updateMany(&#123; <span class="variable">$set</span>: &#123;</span><br><span class="line">        click: 0,</span><br><span class="line">        favorite: 0,</span><br><span class="line">        love: 0,</span><br><span class="line">        notlove:0</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥è¯¢ageå­—æ®µä¸å­˜åœ¨å¹¶ä¸”æ‰¹é‡æ›´æ–°ä¸º1</span></span><br><span class="line">db.getCollection(<span class="string">&quot;users&quot;</span>).updateMany(</span><br><span class="line">    &#123; age: &#123; <span class="variable">$exists</span>: <span class="literal">false</span> &#125; &#125;, </span><br><span class="line">    &#123; <span class="variable">$set</span>: &#123; age: 18 &#125; &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><h3 id="Create-æ–°å¢"><a href="#Create-æ–°å¢" class="headerlink" title="Create æ–°å¢"></a>Create æ–°å¢</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">insertOne</span>(&#123;</span><br><span class="line">  <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span>,</span><br><span class="line">  <span class="attr">order_sn</span>: <span class="string">&quot;aaaa&quot;</span>,</span><br><span class="line">  <span class="attr">user_id</span>: <span class="number">4568</span>,</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;0KLd&quot;</span>,</span><br><span class="line">  <span class="attr">object_id</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">object_type</span>: <span class="string">&quot;face1&quot;</span>,</span><br><span class="line">  <span class="attr">object_money_old</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">register_at</span>: <span class="number">1750145943</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Delete-åˆ é™¤"><a href="#Delete-åˆ é™¤" class="headerlink" title="Delete åˆ é™¤"></a>Delete åˆ é™¤</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">deleteOne</span>(&#123;</span><br><span class="line">  <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Update-æ›´æ–°"><a href="#Update-æ›´æ–°" class="headerlink" title="Update æ›´æ–°"></a>Update æ›´æ–°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">updateOne</span>(</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;5d168c26ba27e53ccab8b743a1492d23&quot;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$set</span>: &#123;</span><br><span class="line">      <span class="attr">out_data</span>: [</span><br><span class="line">        <span class="string">&quot;/md-204/m3u8-download/aå—·å—·aa.m3u8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/md-204/ai-out-files/5a.zip&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Read-æŸ¥è¯¢"><a href="#Read-æŸ¥è¯¢" class="headerlink" title="Read æŸ¥è¯¢"></a>Read æŸ¥è¯¢</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">user</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;)</span><br></pre></td></tr></table></figure>


<h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h2><h3 id="é«˜çº§æŸ¥è¯¢-lookup"><a href="#é«˜çº§æŸ¥è¯¢-lookup" class="headerlink" title="é«˜çº§æŸ¥è¯¢ lookup"></a>é«˜çº§æŸ¥è¯¢ lookup</h3><p><code>$lookup</code> æ˜¯ MongoDB èšåˆæ¡†æ¶ä¸­çš„ä¸€ä¸ªé˜¶æ®µï¼Œç”¨æ¥åœ¨ä¸¤ä¸ªé›†åˆä¹‹é—´è¿›è¡Œè”è¡¨æŸ¥è¯¢ï¼ˆç±»ä¼¼ SQL çš„ JOINï¼‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">orders</span>.<span class="title function_">aggregate</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$lookup</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&quot;users&quot;</span>,           <span class="comment">// è¦è¿æ¥çš„é›†åˆå</span></span><br><span class="line">      <span class="attr">localField</span>: <span class="string">&quot;user_id&quot;</span>,   <span class="comment">// orders ä¸­çš„å­—æ®µ</span></span><br><span class="line">      <span class="attr">foreignField</span>: <span class="string">&quot;_id&quot;</span>,     <span class="comment">// users ä¸­çš„å­—æ®µ</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;user_info&quot;</span>          <span class="comment">// è¾“å‡ºçš„æ–°å­—æ®µï¼ˆæ•°ç»„ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="é«˜çº§æŸ¥è¯¢-lookup-pipeline"><a href="#é«˜çº§æŸ¥è¯¢-lookup-pipeline" class="headerlink" title="é«˜çº§æŸ¥è¯¢ lookup + pipeline"></a>é«˜çº§æŸ¥è¯¢ lookup + pipeline</h3><p>pipelineé«˜çº§æ–¹å¼ï¼Œæ”¯æŒè¡¨è¾¾å¼å’Œå­æŸ¥è¯¢</p>
<p>ğŸ“˜ åœºæ™¯è®¾å®š<br>orders é›†åˆï¼ˆè®¢å•ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>users é›†åˆï¼ˆç”¨æˆ·ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ğŸ¯ ç›®æ ‡<br>æƒ³æŸ¥å‡º ordersï¼Œå¹¶åªè”è¡¨å…³è”<strong>is_active &#x3D; true</strong> çš„ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">orders</span>.<span class="title function_">aggregate</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">$lookup</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">      <span class="attr">let</span>: &#123; <span class="attr">uid</span>: <span class="string">&quot;$user_id&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">pipeline</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">$match</span>: &#123;</span><br><span class="line">            <span class="attr">$expr</span>: &#123; <span class="attr">$eq</span>: [<span class="string">&quot;$_id&quot;</span>, <span class="string">&quot;$$uid&quot;</span>] &#125;,   <span class="comment">// æ¡ä»¶ï¼šuser._id == orders.user_id</span></span><br><span class="line">            <span class="attr">is_active</span>: <span class="literal">true</span>                      <span class="comment">// åªå…³è”æ¿€æ´»ç”¨æˆ·</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">$project</span>: &#123; <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">_id</span>: <span class="number">0</span> &#125;           <span class="comment">// å¯é€‰ï¼šæ§åˆ¶è¾“å‡ºå­—æ®µ</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;user_info&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">$unwind</span>: <span class="string">&quot;$user_info&quot;</span> &#125; <span class="comment">// å¦‚æœä½ åªè¦ä¸€ä¸ªç”¨æˆ·å¯¹è±¡è€Œä¸æ˜¯æ•°ç»„</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>âœ… æŸ¥è¯¢ç»“æœ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> ObjectId(<span class="string">&quot;665fa1f1e2c9a3701fabc123&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Laptop&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Alice&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  &#x27;$group&#x27; =&gt; <span class="punctuation">[</span></span><br><span class="line">    &#x27;_id&#x27;         =&gt; &#x27;$object_type&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;total_count&#x27; =&gt; <span class="punctuation">[</span>&#x27;$sum&#x27; =&gt; <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    &#x27;total_money&#x27; =&gt; <span class="punctuation">[</span>&#x27;$sum&#x27; =&gt; &#x27;$object_money&#x27;<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>ğŸ’¡ è¯´æ˜</p>
<table>
<thead>
<tr>
<th>å…³é”®ç‚¹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>let: &#123; uid: &quot;$user_id&quot; &#125;</code></td>
<td>æŠŠå¤–éƒ¨å˜é‡ä¼ å…¥å†…éƒ¨ pipeline</td>
</tr>
<tr>
<td><code>$expr</code> + <code>$eq</code></td>
<td>å…è®¸å­—æ®µä¸å­—æ®µå¯¹æ¯”ï¼ˆè€Œä¸æ˜¯å›ºå®šå€¼ï¼‰</td>
</tr>
<tr>
<td><code>is_active: true</code></td>
<td>å¢åŠ è‡ªå®šä¹‰çš„è¿‡æ»¤é€»è¾‘</td>
</tr>
<tr>
<td><code>$project</code></td>
<td>æ§åˆ¶æœ€ç»ˆå…³è”çš„å­—æ®µ</td>
</tr>
<tr>
<td><code>$unwind</code></td>
<td>æŠŠæ•°ç»„å˜æˆå¯¹è±¡ï¼Œå¸¸ç”¨äºä¸€å¯¹ä¸€å…³ç³»</td>
</tr>
</tbody></table>
<h1 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h1><ul>
<li>å¯¼å…¥ - å¤šé›†åˆ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®éƒ¨åˆ†</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span> </span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span> </span><br><span class="line">DATABASE=<span class="string">&quot;&quot;</span> </span><br><span class="line">FOLDER_PATH=<span class="string">&quot;/data/db/backup_dev_20250115&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ–‡ä»¶å¤¹ </span></span><br><span class="line"><span class="keyword">for</span> DIR <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$FOLDER_PATH</span>&quot;</span>/*/; <span class="keyword">do</span> </span><br><span class="line">	COLLECTION_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$DIR</span>&quot;</span>) </span><br><span class="line">	mongorestore --db <span class="variable">$COLLECTION_NAME</span> <span class="variable">$DIR</span>  -j 100</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ‰€æœ‰æ–‡ä»¶å¯¼å…¥å®Œæˆï¼&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤‡ä»½-å¤šé›†åˆ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === åŸºç¡€é…ç½® ===</span></span><br><span class="line">MONGO_HOST=<span class="string">&quot;localhost&quot;</span></span><br><span class="line">MONGO_PORT=<span class="string">&quot;27017&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/data/db/dbback&quot;</span></span><br><span class="line">PJ=<span class="string">&quot;dev&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d)</span><br><span class="line">LOG_FILE=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>.log&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === æ—¥å¿—å‡½æ•° ===</span></span><br><span class="line"><span class="function"><span class="title">log_msg</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$1</span>&quot;</span> | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># === è·å–é›†åˆå ===</span></span><br><span class="line"><span class="function"><span class="title">get_all_collections</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> db=<span class="variable">$1</span></span><br><span class="line">    mongo --quiet --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> --<span class="built_in">eval</span> <span class="string">&quot;db.getSiblingDB(&#x27;<span class="variable">$db</span>&#x27;).getCollectionNames().join(&#x27; &#x27;)&quot;</span> 2&gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># === äº¤äº’ ===</span></span><br><span class="line"><span class="built_in">declare</span> -A FULL_COLLECTIONS_MAP</span><br><span class="line"><span class="built_in">declare</span> -A STRUCT_ONLY_COLLECTIONS_MAP</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥éœ€è¦å¤‡ä»½çš„æ•°æ®åº“æ•°é‡: &quot;</span> DB_COUNT</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=DB_COUNT; i++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥ç¬¬ <span class="variable">$i</span> ä¸ªæ•°æ®åº“å: &quot;</span> DB_NAME</span><br><span class="line"></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;æ•°æ®åº“ <span class="variable">$DB_NAME</span> ä¸­ã€å®Œæ•´å¤‡ä»½ï¼ˆå«æ•°æ®ï¼‰ã€‘çš„é›†åˆï¼ˆæ”¯æŒ all / exclude xxx / æŒ‡å®šï¼‰: &quot;</span> full_input</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;æ•°æ®åº“ <span class="variable">$DB_NAME</span> ä¸­ã€åªå¤‡ç»“æ„ã€‘çš„é›†åˆï¼ˆæ”¯æŒ all / æŒ‡å®šï¼‰: &quot;</span> struct_input</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†å«æ•°æ®é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$full_input</span>&quot;</span> == <span class="string">&quot;all&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="subst">$(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$full_input</span>&quot;</span> =~ ^exclude ]]; <span class="keyword">then</span></span><br><span class="line">        all_cols=($(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>))</span><br><span class="line">        exclude_cols=(<span class="variable">$&#123;full_input[@]:1&#125;</span>)</span><br><span class="line">        keep_cols=()</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;all_cols[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> [[ ! <span class="string">&quot; <span class="variable">$&#123;exclude_cols[*]&#125;</span> &quot;</span> =~ <span class="string">&quot; <span class="variable">$col</span> &quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                keep_cols+=(<span class="string">&quot;<span class="variable">$col</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$&#123;keep_cols[*]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        FULL_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$full_input</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†åªç»“æ„é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$struct_input</span>&quot;</span> == <span class="string">&quot;all&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        STRUCT_ONLY_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="subst">$(get_all_collections <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        STRUCT_ONLY_COLLECTIONS_MAP[<span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$struct_input</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === å¤‡ä»½é€»è¾‘ ===</span></span><br><span class="line"><span class="keyword">for</span> DB_NAME <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!FULL_COLLECTIONS_MAP[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    BACKUP_PATH=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    log_msg <span class="string">&quot;ğŸ“¦ æ­£åœ¨å¤‡ä»½æ•°æ®åº“ <span class="variable">$DB_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> COLLECTION <span class="keyword">in</span> <span class="variable">$&#123;FULL_COLLECTIONS_MAP[$DB_NAME]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        log_msg <span class="string">&quot;ğŸ“¥ å¤‡ä»½é›†åˆ <span class="variable">$DB_NAME</span>.<span class="variable">$COLLECTION</span>ï¼ˆå«æ•°æ®ï¼‰&quot;</span></span><br><span class="line">        mongodump --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> \</span><br><span class="line">                  --db <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span> --collection <span class="string">&quot;<span class="variable">$COLLECTION</span>&quot;</span> \</span><br><span class="line">                  --out <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> COLLECTION <span class="keyword">in</span> <span class="variable">$&#123;STRUCT_ONLY_COLLECTIONS_MAP[$DB_NAME]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        log_msg <span class="string">&quot;ğŸ§± å¤‡ä»½é›†åˆ <span class="variable">$DB_NAME</span>.<span class="variable">$COLLECTION</span>ï¼ˆä»…ç»“æ„ï¼‰&quot;</span></span><br><span class="line">        mongodump --host <span class="string">&quot;<span class="variable">$MONGO_HOST</span>&quot;</span> --port <span class="string">&quot;<span class="variable">$MONGO_PORT</span>&quot;</span> \</span><br><span class="line">                  --db <span class="string">&quot;<span class="variable">$DB_NAME</span>&quot;</span> --collection <span class="string">&quot;<span class="variable">$COLLECTION</span>&quot;</span> \</span><br><span class="line">                  --query <span class="string">&#x27;&#123;&#125;&#x27;</span> --<span class="built_in">limit</span> 0 \</span><br><span class="line">                  --out <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    TAR_NAME=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.tar.gz&quot;</span></span><br><span class="line">    log_msg <span class="string">&quot;ğŸ—œï¸ å‹ç¼© <span class="variable">$DB_NAME</span> åˆ° <span class="variable">$TAR_NAME</span>&quot;</span></span><br><span class="line">    tar -zcf <span class="string">&quot;<span class="variable">$TAR_NAME</span>&quot;</span> -C <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>&quot;</span> &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$BACKUP_PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">log_msg <span class="string">&quot;ğŸ§¹ åˆ é™¤7å¤©å‰çš„æ—§å¤‡ä»½...&quot;</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -<span class="built_in">type</span> f -name <span class="string">&quot;backup_<span class="variable">$&#123;PJ&#125;</span>_*.tar.gz&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \; &amp;&gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">log_msg <span class="string">&quot;âœ… æ‰€æœ‰å¤‡ä»½ä»»åŠ¡å®Œæˆï¼&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚ä½•ä½¿ç”¨è„šæœ¬</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥éœ€è¦å¤‡ä»½çš„æ•°æ®åº“æ•°é‡: 2</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥ç¬¬ 1 ä¸ªæ•°æ®åº“å: userdb</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥æ•°æ®åº“ userdb ä¸­è¦ã€å®Œæ•´å¤‡ä»½ï¼ˆå«æ•°æ®ï¼‰ã€‘çš„é›†åˆï¼ˆç©ºæ ¼åˆ†éš”ï¼Œæ”¯æŒ all / exclude xxxï¼‰: all</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥æ•°æ®åº“ userdb ä¸­è¦ã€åªå¤‡ç»“æ„ã€‘çš„é›†åˆï¼ˆç©ºæ ¼åˆ†éš”ï¼Œæ”¯æŒ allï¼‰: app_log post_log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥ç¬¬ 2 ä¸ªæ•°æ®åº“å: productdb</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥æ•°æ®åº“ productdb ä¸­è¦ã€å®Œæ•´å¤‡ä»½ï¼ˆå«æ•°æ®ï¼‰ã€‘çš„é›†åˆï¼ˆç©ºæ ¼åˆ†éš”ï¼Œæ”¯æŒ all / exclude xxxï¼‰: exclude items post_log</span></span><br><span class="line"><span class="comment"># è¯·è¾“å…¥æ•°æ®åº“ productdb ä¸­è¦ã€åªå¤‡ç»“æ„ã€‘çš„é›†åˆï¼ˆç©ºæ ¼åˆ†éš”ï¼Œæ”¯æŒ allï¼‰: app_log </span></span><br></pre></td></tr></table></figure>


<p>mongodb å‰¯æœ¬é›†çš„ä¸»çš„é€‰ä¸¾â€“ä¼˜å…ˆçº§è®¾ç½®</p>
<p>åˆ†ç‰‡<br>å¤åˆ¶é›†</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904186300071943">https://juejin.cn/post/6844904186300071943</a></p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/MongoDB/">#MongoDB</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    Respect All Fear None. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2025/11/27/vue2vsvue3/">vue2 å¯¹æ¯” vue3</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/vue-big-file-upload/">vue2 å¤§æ–‡ä»¶ä¸Šä¼ component(åšæˆç»„ä»¶)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/wireshark/">Wireshark</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2025/11/27/xss/">XSSè·¨ç«™è„šæœ¬æ”»å‡»</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/%E5%88%9B%E4%B8%9A/">åˆ›ä¸š</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">æ•°æ®åˆ†æ</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Blog/">Blog</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/%E7%9F%A5/">çŸ¥</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @4ck. All right reserved | Design & Hexo 0rz33
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Searching -->
<!-- <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> -->

<script src="/js/search.js"></script>


<!-- Mermaid -->
<script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
<script>
  if (window.mermaid) {
    mermaid.initialize({theme: 'dark'});
  }
</script>

<!-- Disqus Comments -->



</body>

</html>